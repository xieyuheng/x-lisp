;;; Input

(define (swap f x y) (f y x))

(define (drop f) (lambda (dropped) (lambda (x) (f x))))

(define (dup f) (lambda (x) (f x x)))

(define (identity x) x)

(define (main)
  (= f identity)
  (= g (dup identity))
  (println (g f f)))

;;; ShrinkPass

(define (swap f x y) (f y x))

(define (drop f) (lambda (dropped) (lambda (x) (f x))))

(define (dup f) (lambda (x) (f x x)))

(define (identity x) x)

(define (main)
  (let ((f identity))
    (let ((g (dup identity))) (println (g f f)))))

;;; UniquifyPass

(define (swap f x y) (f y x))

(define (drop f) (lambda (dropped₁) (lambda (x₁) (f x₁))))

(define (dup f) (lambda (x₁) (f x₁ x₁)))

(define (identity x) x)

(define (main)
  (let ((f₁ identity))
    (let ((g₁ (dup identity))) (println (g₁ f₁ f₁)))))

;;; RevealGlobalPass

(define (swap f x y) (f y x))

(define (drop f) (lambda (dropped₁) (lambda (x₁) (f x₁))))

(define (dup f) (lambda (x₁) (f x₁ x₁)))

(define (identity x) x)

(define (main)
  (let ((f₁ (@function identity 1)))
    (let ((g₁ ((@function dup 1) (@function identity 1))))
      ((@primitive println 1) (g₁ f₁ f₁)))))

;;; LiftLambdaPass

(define (swap f x y) (f y x))

(define (drop f) ((@function drop©λ₁ 2) f))

(define (drop©λ₁ f dropped₁) ((@function drop©λ₁©λ₁ 2) f))

(define (drop©λ₁©λ₁ f x₁) (f x₁))

(define (dup f) ((@function dup©λ₁ 2) f))

(define (dup©λ₁ f x₁) (f x₁ x₁))

(define (identity x) x)

(define (main)
  (let ((f₁ (@function identity 1)))
    (let ((g₁ ((@function dup 1) (@function identity 1))))
      ((@primitive println 1) (g₁ f₁ f₁)))))

;;; UnnestOperandPass

(define (swap f x y) (f y x))

(define (drop f) ((@function drop©λ₁ 2) f))

(define (drop©λ₁ f dropped₁) ((@function drop©λ₁©λ₁ 2) f))

(define (drop©λ₁©λ₁ f x₁) (f x₁))

(define (dup f) ((@function dup©λ₁ 2) f))

(define (dup©λ₁ f x₁) (f x₁ x₁))

(define (identity x) x)

(define (main)
  (let ((f₁ (@function identity 1)))
    (let ((g₁ ((@function dup 1) (@function identity 1))))
      (let ((_₁ (g₁ f₁ f₁))) ((@primitive println 1) _₁)))))

