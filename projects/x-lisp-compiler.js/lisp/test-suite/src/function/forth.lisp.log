;;; Input

(define (swap f x y) (f y x))

(define (drop f) (lambda (dropped) (lambda (x) (f x))))

(define (dup f) (lambda (x) (f x x)))

(define (identity x) x)

(define (main)
  (= f identity)
  (= g (dup identity))
  (println (g f f)))

;;; ShrinkPass

(define (swap f x y) ((f y) x))

(define (drop f) (lambda (dropped) (lambda (x) (f x))))

(define (dup f) (lambda (x) ((f x) x)))

(define (identity x) x)

(define (main)
  (@let1 f identity
    (@let1 g (dup identity) (println ((g f) f)))))

;;; UniquifyPass

(define (swap f x y) ((f y) x))

(define (drop f) (lambda (dropped₁) (lambda (x₁) (f x₁))))

(define (dup f) (lambda (x₁) ((f x₁) x₁)))

(define (identity x) x)

(define (main)
  (@let1 f₁ identity
    (@let1 g₁ (dup identity) (println ((g₁ f₁) f₁)))))

;;; RevealGlobalPass

(define (swap f x y) ((f y) x))

(define (drop f) (lambda (dropped₁) (lambda (x₁) (f x₁))))

(define (dup f) (lambda (x₁) ((f x₁) x₁)))

(define (identity x) x)

(define (main)
  (@let1 f₁ (@function-ref identity 1)
    (@let1 g₁
        ((@function-ref dup 1) (@function-ref identity 1))
      ((@builtin-function-ref println 1) ((g₁ f₁) f₁)))))

;;; LiftLambdaPass

(define (swap f x y) ((f y) x))

(define (drop f)
  ((((@builtin-function-ref curry-put! 3) 0) f)
   ((((@builtin-function-ref make-curry 3)
      (@function-ref drop©λ₁ 2))
     2)
    1)))

(define (drop©λ₁ f dropped₁)
  ((((@builtin-function-ref curry-put! 3) 0) f)
   ((((@builtin-function-ref make-curry 3)
      (@function-ref drop©λ₁©λ₁ 2))
     2)
    1)))

(define (drop©λ₁©λ₁ f x₁) (f x₁))

(define (dup f)
  ((((@builtin-function-ref curry-put! 3) 0) f)
   ((((@builtin-function-ref make-curry 3)
      (@function-ref dup©λ₁ 2))
     2)
    1)))

(define (dup©λ₁ f x₁) ((f x₁) x₁))

(define (identity x) x)

(define (main)
  (@let1 f₁ (@function-ref identity 1)
    (@let1 g₁
        ((@function-ref dup 1) (@function-ref identity 1))
      ((@builtin-function-ref println 1) ((g₁ f₁) f₁)))))

