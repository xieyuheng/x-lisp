;;; Input

(define (main)
  (assert-equal iadd iadd)
  (assert-equal (iadd 1) (iadd 1))
  (assert-not-equal (iadd 1) (iadd 2))
  (assert-equal ((iadd 1) 2) (iadd 1 2))
  (assert-equal 1 ((isub 2) 1))
  (assert-equal 1 (isub 2 1)))

;;; ShrinkPass

(define (main)
  (@begin1 (assert-equal iadd iadd)
    (@begin1 (assert-equal (iadd 1) (iadd 1))
      (@begin1 (assert-not-equal (iadd 1) (iadd 2))
        (@begin1 (assert-equal ((iadd 1) 2) (iadd 1 2))
          (@begin1 (assert-equal 1 ((isub 2) 1)) (assert-equal 1 (isub 2 1))))))))

;;; UniquifyPass

(define (main)
  (@begin1 (assert-equal iadd iadd)
    (@begin1 (assert-equal (iadd 1) (iadd 1))
      (@begin1 (assert-not-equal (iadd 1) (iadd 2))
        (@begin1 (assert-equal ((iadd 1) 2) (iadd 1 2))
          (@begin1 (assert-equal 1 ((isub 2) 1)) (assert-equal 1 (isub 2 1))))))))

;;; RevealGlobalPass

(define (main)
  (@begin1
      ((@primitive-function-ref assert-equal 2)
       (@primitive-function-ref iadd 2)
       (@primitive-function-ref iadd 2))
    (@begin1
        ((@primitive-function-ref assert-equal 2)
         ((@primitive-function-ref iadd 2) 1)
         ((@primitive-function-ref iadd 2) 1))
      (@begin1
          ((@primitive-function-ref assert-not-equal 2)
           ((@primitive-function-ref iadd 2) 1)
           ((@primitive-function-ref iadd 2) 2))
        (@begin1
            ((@primitive-function-ref assert-equal 2)
             (((@primitive-function-ref iadd 2) 1) 2)
             ((@primitive-function-ref iadd 2) 1 2))
          (@begin1
              ((@primitive-function-ref assert-equal 2)
               1
               (((@primitive-function-ref isub 2) 2) 1))
            ((@primitive-function-ref assert-equal 2)
             1
             ((@primitive-function-ref isub 2) 2 1))))))))

;;; LiftLambdaPass

(define (main)
  (@begin1
      ((@primitive-function-ref assert-equal 2)
       (@primitive-function-ref iadd 2)
       (@primitive-function-ref iadd 2))
    (@begin1
        ((@primitive-function-ref assert-equal 2)
         ((@primitive-function-ref iadd 2) 1)
         ((@primitive-function-ref iadd 2) 1))
      (@begin1
          ((@primitive-function-ref assert-not-equal 2)
           ((@primitive-function-ref iadd 2) 1)
           ((@primitive-function-ref iadd 2) 2))
        (@begin1
            ((@primitive-function-ref assert-equal 2)
             (((@primitive-function-ref iadd 2) 1) 2)
             ((@primitive-function-ref iadd 2) 1 2))
          (@begin1
              ((@primitive-function-ref assert-equal 2)
               1
               (((@primitive-function-ref isub 2) 2) 1))
            ((@primitive-function-ref assert-equal 2)
             1
             ((@primitive-function-ref isub 2) 2 1))))))))

;;; UnnestOperandPass

(define (main)
  (@begin1
      ((@primitive-function-ref assert-equal 2)
       (@primitive-function-ref iadd 2)
       (@primitive-function-ref iadd 2))
    (@begin1
        (@let1 _₁ ((@primitive-function-ref iadd 2) 1)
          (@let1 _₂ ((@primitive-function-ref iadd 2) 1)
            ((@primitive-function-ref assert-equal 2) _₁ _₂)))
      (@begin1
          (@let1 _₃ ((@primitive-function-ref iadd 2) 1)
            (@let1 _₄ ((@primitive-function-ref iadd 2) 2)
              ((@primitive-function-ref assert-not-equal 2) _₃ _₄)))
        (@begin1
            (@let1 _₅ ((@primitive-function-ref iadd 2) 1)
              (@let1 _₆ (_₅ 2)
                (@let1 _₇ ((@primitive-function-ref iadd 2) 1 2)
                  ((@primitive-function-ref assert-equal 2) _₆ _₇))))
          (@begin1
              (@let1 _₈ ((@primitive-function-ref isub 2) 2)
                (@let1 _₉ (_₈ 1)
                  ((@primitive-function-ref assert-equal 2) 1 _₉)))
            (@let1 _₁₀ ((@primitive-function-ref isub 2) 2 1)
              ((@primitive-function-ref assert-equal 2) 1 _₁₀))))))))

