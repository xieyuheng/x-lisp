;;; Input

(define (main) (println {1 2 3}) (println {1 2 3}))

;;; ShrinkPass

(define (main)
  (@begin1
      (println
       (@let1 set (make-set)
         (@begin1 (set-add! 1 set)
           (@begin1 (set-add! 2 set) (@begin1 (set-add! 3 set) set)))))
    (println
     (@let1 set (make-set)
       (@begin1 (set-add! 1 set)
         (@begin1 (set-add! 2 set) (@begin1 (set-add! 3 set) set)))))))

;;; UniquifyPass

(define (main)
  (@begin1
      (println
       (@let1 set₁ (make-set)
         (@begin1 (set-add! 1 set₁)
           (@begin1 (set-add! 2 set₁) (@begin1 (set-add! 3 set₁) set₁)))))
    (println
     (@let1 set₁ (make-set)
       (@begin1 (set-add! 1 set₁)
         (@begin1 (set-add! 2 set₁) (@begin1 (set-add! 3 set₁) set₁)))))))

;;; RevealGlobalPass

(define (main)
  (@begin1
      ((@primitive-function-ref println 1)
       (@let1 set₁ ((@primitive-function-ref make-set 0))
         (@begin1 ((@primitive-function-ref set-add! 2) 1 set₁)
           (@begin1 ((@primitive-function-ref set-add! 2) 2 set₁)
             (@begin1 ((@primitive-function-ref set-add! 2) 3 set₁) set₁)))))
    ((@primitive-function-ref println 1)
     (@let1 set₁ ((@primitive-function-ref make-set 0))
       (@begin1 ((@primitive-function-ref set-add! 2) 1 set₁)
         (@begin1 ((@primitive-function-ref set-add! 2) 2 set₁)
           (@begin1 ((@primitive-function-ref set-add! 2) 3 set₁) set₁)))))))

;;; LiftLambdaPass

(define (main)
  (@begin1
      ((@primitive-function-ref println 1)
       (@let1 set₁ ((@primitive-function-ref make-set 0))
         (@begin1 ((@primitive-function-ref set-add! 2) 1 set₁)
           (@begin1 ((@primitive-function-ref set-add! 2) 2 set₁)
             (@begin1 ((@primitive-function-ref set-add! 2) 3 set₁) set₁)))))
    ((@primitive-function-ref println 1)
     (@let1 set₁ ((@primitive-function-ref make-set 0))
       (@begin1 ((@primitive-function-ref set-add! 2) 1 set₁)
         (@begin1 ((@primitive-function-ref set-add! 2) 2 set₁)
           (@begin1 ((@primitive-function-ref set-add! 2) 3 set₁) set₁)))))))

;;; UnnestOperandPass

(define (main)
  (@begin1
      (@let1 set₁ ((@primitive-function-ref make-set 0))
        (@begin1 ((@primitive-function-ref set-add! 2) 1 set₁)
          (@begin1 ((@primitive-function-ref set-add! 2) 2 set₁)
            (@begin1 ((@primitive-function-ref set-add! 2) 3 set₁)
              ((@primitive-function-ref println 1) set₁)))))
    (@let1 set₁ ((@primitive-function-ref make-set 0))
      (@begin1 ((@primitive-function-ref set-add! 2) 1 set₁)
        (@begin1 ((@primitive-function-ref set-add! 2) 2 set₁)
          (@begin1 ((@primitive-function-ref set-add! 2) 3 set₁)
            ((@primitive-function-ref println 1) set₁)))))))

