;;; Input

(define (main) (println {1 2 3}) (println {1 2 3}))

;;; ShrinkPass

(define (main)
  (begin
    (println
     (let ((set (make-set)))
       (begin
         (set-add! 1 set)
         (begin (set-add! 2 set) (begin (set-add! 3 set) set)))))
    (println
     (let ((set (make-set)))
       (begin
         (set-add! 1 set)
         (begin (set-add! 2 set) (begin (set-add! 3 set) set)))))))

;;; UniquifyPass

(define (main)
  (begin
    (println
     (let ((set₁ (make-set)))
       (begin
         (set-add! 1 set₁)
         (begin
           (set-add! 2 set₁)
           (begin (set-add! 3 set₁) set₁)))))
    (println
     (let ((set₁ (make-set)))
       (begin
         (set-add! 1 set₁)
         (begin
           (set-add! 2 set₁)
           (begin (set-add! 3 set₁) set₁)))))))

;;; RevealGlobalPass

(define (main)
  (begin
    ((@primitive println 1)
     (let ((set₁ ((@primitive make-set 0))))
       (begin
         ((@primitive set-add! 2) 1 set₁)
         (begin
           ((@primitive set-add! 2) 2 set₁)
           (begin ((@primitive set-add! 2) 3 set₁) set₁)))))
    ((@primitive println 1)
     (let ((set₁ ((@primitive make-set 0))))
       (begin
         ((@primitive set-add! 2) 1 set₁)
         (begin
           ((@primitive set-add! 2) 2 set₁)
           (begin ((@primitive set-add! 2) 3 set₁) set₁)))))))

;;; LiftLambdaPass

(define (main)
  (begin
    ((@primitive println 1)
     (let ((set₁ ((@primitive make-set 0))))
       (begin
         ((@primitive set-add! 2) 1 set₁)
         (begin
           ((@primitive set-add! 2) 2 set₁)
           (begin ((@primitive set-add! 2) 3 set₁) set₁)))))
    ((@primitive println 1)
     (let ((set₁ ((@primitive make-set 0))))
       (begin
         ((@primitive set-add! 2) 1 set₁)
         (begin
           ((@primitive set-add! 2) 2 set₁)
           (begin ((@primitive set-add! 2) 3 set₁) set₁)))))))

;;; UnnestOperandPass

(define (main)
  (begin
    (let ((set₁ ((@primitive make-set 0))))
      (begin
        ((@primitive set-add! 2) 1 set₁)
        (begin
          ((@primitive set-add! 2) 2 set₁)
          (begin
            ((@primitive set-add! 2) 3 set₁)
            ((@primitive println 1) set₁)))))
    (let ((set₁ ((@primitive make-set 0))))
      (begin
        ((@primitive set-add! 2) 1 set₁)
        (begin
          ((@primitive set-add! 2) 2 set₁)
          (begin
            ((@primitive set-add! 2) 3 set₁)
            ((@primitive println 1) set₁)))))))

