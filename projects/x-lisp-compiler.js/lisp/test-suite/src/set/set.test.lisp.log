;;; Input

(define (main) (assert-equal {1 2 3} {1 2 3}))

;;; ShrinkPass

(define (main)
  (assert-equal
    (let ((set (make-set)))
      (begin
        (set-add! 1 set)
        (begin (set-add! 2 set) (begin (set-add! 3 set) set))))
    (let ((set (make-set)))
      (begin
        (set-add! 1 set)
        (begin (set-add! 2 set) (begin (set-add! 3 set) set))))))

;;; UniquifyPass

(define (main)
  (assert-equal
    (let ((set₁ (make-set)))
      (begin
        (set-add! 1 set₁)
        (begin (set-add! 2 set₁) (begin (set-add! 3 set₁) set₁))))
    (let ((set₁ (make-set)))
      (begin
        (set-add! 1 set₁)
        (begin (set-add! 2 set₁) (begin (set-add! 3 set₁) set₁))))))

;;; RevealGlobalPass

(define (main)
  ((@primitive assert-equal 2)
   (let ((set₁ ((@primitive make-set 0))))
     (begin
       ((@primitive set-add! 2) 1 set₁)
       (begin
         ((@primitive set-add! 2) 2 set₁)
         (begin ((@primitive set-add! 2) 3 set₁) set₁))))
   (let ((set₁ ((@primitive make-set 0))))
     (begin
       ((@primitive set-add! 2) 1 set₁)
       (begin
         ((@primitive set-add! 2) 2 set₁)
         (begin ((@primitive set-add! 2) 3 set₁) set₁))))))

;;; LiftLambdaPass

(define (main)
  ((@primitive assert-equal 2)
   (let ((set₁ ((@primitive make-set 0))))
     (begin
       ((@primitive set-add! 2) 1 set₁)
       (begin
         ((@primitive set-add! 2) 2 set₁)
         (begin ((@primitive set-add! 2) 3 set₁) set₁))))
   (let ((set₁ ((@primitive make-set 0))))
     (begin
       ((@primitive set-add! 2) 1 set₁)
       (begin
         ((@primitive set-add! 2) 2 set₁)
         (begin ((@primitive set-add! 2) 3 set₁) set₁))))))

;;; UnnestOperandPass

(define (main)
  (let ((set₁ ((@primitive make-set 0))))
    (begin
      ((@primitive set-add! 2) 1 set₁)
      (begin
        ((@primitive set-add! 2) 2 set₁)
        (begin
          ((@primitive set-add! 2) 3 set₁)
          (let ((set₁ ((@primitive make-set 0))))
            (begin
              ((@primitive set-add! 2) 1 set₁)
              (begin
                ((@primitive set-add! 2) 2 set₁)
                (begin
                  ((@primitive set-add! 2) 3 set₁)
                  ((@primitive assert-equal 2) set₁ set₁))))))))))

