;;; Input

(define (main) (assert-equal {1 2 3} {1 2 3}))

;;; ShrinkPass

(define (main)
  (assert-equal
    (@let1 set (make-set)
      (@begin1 (set-add! 1 set)
        (@begin1 (set-add! 2 set) (@begin1 (set-add! 3 set) set))))
    (@let1 set (make-set)
      (@begin1 (set-add! 1 set)
        (@begin1 (set-add! 2 set) (@begin1 (set-add! 3 set) set))))))

;;; UniquifyPass

(define (main)
  (assert-equal
    (@let1 set₁ (make-set)
      (@begin1 (set-add! 1 set₁)
        (@begin1 (set-add! 2 set₁) (@begin1 (set-add! 3 set₁) set₁))))
    (@let1 set₁ (make-set)
      (@begin1 (set-add! 1 set₁)
        (@begin1 (set-add! 2 set₁) (@begin1 (set-add! 3 set₁) set₁))))))

;;; RevealGlobalPass

(define (main)
  ((@primitive-function-ref assert-equal 2)
   (@let1 set₁ ((@primitive-function-ref make-set 0))
     (@begin1 ((@primitive-function-ref set-add! 2) 1 set₁)
       (@begin1 ((@primitive-function-ref set-add! 2) 2 set₁)
         (@begin1 ((@primitive-function-ref set-add! 2) 3 set₁) set₁))))
   (@let1 set₁ ((@primitive-function-ref make-set 0))
     (@begin1 ((@primitive-function-ref set-add! 2) 1 set₁)
       (@begin1 ((@primitive-function-ref set-add! 2) 2 set₁)
         (@begin1 ((@primitive-function-ref set-add! 2) 3 set₁) set₁))))))

;;; LiftLambdaPass

(define (main)
  ((@primitive-function-ref assert-equal 2)
   (@let1 set₁ ((@primitive-function-ref make-set 0))
     (@begin1 ((@primitive-function-ref set-add! 2) 1 set₁)
       (@begin1 ((@primitive-function-ref set-add! 2) 2 set₁)
         (@begin1 ((@primitive-function-ref set-add! 2) 3 set₁) set₁))))
   (@let1 set₁ ((@primitive-function-ref make-set 0))
     (@begin1 ((@primitive-function-ref set-add! 2) 1 set₁)
       (@begin1 ((@primitive-function-ref set-add! 2) 2 set₁)
         (@begin1 ((@primitive-function-ref set-add! 2) 3 set₁) set₁))))))

;;; UnnestOperandPass

(define (main)
  (@let1 set₁ ((@primitive-function-ref make-set 0))
    (@begin1 ((@primitive-function-ref set-add! 2) 1 set₁)
      (@begin1 ((@primitive-function-ref set-add! 2) 2 set₁)
        (@begin1 ((@primitive-function-ref set-add! 2) 3 set₁)
          (@let1 set₁ ((@primitive-function-ref make-set 0))
            (@begin1 ((@primitive-function-ref set-add! 2) 1 set₁)
              (@begin1 ((@primitive-function-ref set-add! 2) 2 set₁)
                (@begin1 ((@primitive-function-ref set-add! 2) 3 set₁)
                  ((@primitive-function-ref assert-equal 2) set₁ set₁))))))))))

