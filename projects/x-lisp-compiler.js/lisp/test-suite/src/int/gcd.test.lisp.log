;;; Input

(define (gcd a b) (if (equal? b 0) a (gcd b (imod a b))))

(define (main)
  (assert-equal 1 (gcd 13 7))
  (assert-equal 4 (gcd 12 8)))

;;; ShrinkPass

(define (gcd a b) (if (equal? b 0) a (gcd b (imod a b))))

(define (main)
  (begin
    (assert-equal 1 (gcd 13 7))
    (assert-equal 4 (gcd 12 8))))

;;; UniquifyPass

(define (gcd a b) (if (equal? b 0) a (gcd b (imod a b))))

(define (main)
  (begin
    (assert-equal 1 (gcd 13 7))
    (assert-equal 4 (gcd 12 8))))

;;; RevealGlobalPass

(define (gcd a b)
  (if ((@primitive equal? 2) b 0)
    a
    ((@function gcd 2) b ((@primitive imod 2) a b))))

(define (main)
  (begin
    ((@primitive assert-equal 2) 1 ((@function gcd 2) 13 7))
    ((@primitive assert-equal 2) 4 ((@function gcd 2) 12 8))))

;;; LiftLambdaPass

(define (gcd a b)
  (if ((@primitive equal? 2) b 0)
    a
    ((@function gcd 2) b ((@primitive imod 2) a b))))

(define (main)
  (begin
    ((@primitive assert-equal 2) 1 ((@function gcd 2) 13 7))
    ((@primitive assert-equal 2) 4 ((@function gcd 2) 12 8))))

;;; UnnestOperandPass

(define (gcd a b)
  (if ((@primitive equal? 2) b 0)
    a
    (let ((_₁ ((@primitive imod 2) a b)))
      ((@function gcd 2) b _₁))))

(define (main)
  (begin
    (let ((_₁ ((@function gcd 2) 13 7)))
      ((@primitive assert-equal 2) 1 _₁))
    (let ((_₂ ((@function gcd 2) 12 8)))
      ((@primitive assert-equal 2) 4 _₂))))

