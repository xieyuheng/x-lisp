;;; Input

(define (main)
  (= x 1)
  (println
   (iadd
    x
    (begin (= x (begin (= y 5) (iadd y x))) (iadd x 100)))))

;;; ShrinkPass

(define (main)
  (@let1 x 1
    (println
     (iadd x (@let1 x (@let1 y 5 (iadd y x)) (iadd x 100))))))

;;; UniquifyPass

(define (main)
  (@let1 x₁ 1
    (println
     (iadd
      x₁
      (@let1 x₂ (@let1 y₁ 5 (iadd y₁ x₁)) (iadd x₂ 100))))))

;;; RevealGlobalPass

(define (main)
  (@let1 x₁ 1
    ((@primitive-function-ref println 1)
     ((@primitive-function-ref iadd 2)
      x₁
      (@let1 x₂
          (@let1 y₁ 5
            ((@primitive-function-ref iadd 2) y₁ x₁))
        ((@primitive-function-ref iadd 2) x₂ 100))))))

;;; LiftLambdaPass

(define (main)
  (@let1 x₁ 1
    ((@primitive-function-ref println 1)
     ((@primitive-function-ref iadd 2)
      x₁
      (@let1 x₂
          (@let1 y₁ 5
            ((@primitive-function-ref iadd 2) y₁ x₁))
        ((@primitive-function-ref iadd 2) x₂ 100))))))

;;; UnnestOperandPass

(define (main)
  (@let1 x₁ 1
    (@let1 x₂
        (@let1 y₁ 5
          ((@primitive-function-ref iadd 2) y₁ x₁))
      (@let1 _₁ ((@primitive-function-ref iadd 2) x₂ 100)
        (@let1 _₂ ((@primitive-function-ref iadd 2) x₁ _₁)
          ((@primitive-function-ref println 1) _₂))))))

