;;; Input

(define (main)
  (= x 1)
  (println
   (iadd x (begin (= x (begin (= x 5) (iadd x x))) (iadd x 100)))))

;;; ShrinkPass

(define (main)
  (let ((x 1))
    (println
     (iadd x (let ((x (let ((x 5)) (iadd x x)))) (iadd x 100))))))

;;; UniquifyPass

(define (main)
  (let ((x₁ 1))
    (println
     (iadd
      x₁
      (let ((x₂ (let ((x₃ 5)) (iadd x₃ x₃)))) (iadd x₂ 100))))))

;;; RevealGlobalPass

(define (main)
  (let ((x₁ 1))
    ((@primitive println 1)
     ((@primitive iadd 2)
      x₁
      (let ((x₂ (let ((x₃ 5)) ((@primitive iadd 2) x₃ x₃))))
        ((@primitive iadd 2) x₂ 100))))))

;;; LiftLambdaPass

(define (main)
  (let ((x₁ 1))
    ((@primitive println 1)
     ((@primitive iadd 2)
      x₁
      (let ((x₂ (let ((x₃ 5)) ((@primitive iadd 2) x₃ x₃))))
        ((@primitive iadd 2) x₂ 100))))))

;;; UnnestOperandPass

(define (main)
  (let ((x₁ 1))
    (let ((x₂ (let ((x₃ 5)) ((@primitive iadd 2) x₃ x₃))))
      (let ((_₁ ((@primitive iadd 2) x₂ 100)))
        (let ((_₂ ((@primitive iadd 2) x₁ _₁)))
          ((@primitive println 1) _₂))))))

