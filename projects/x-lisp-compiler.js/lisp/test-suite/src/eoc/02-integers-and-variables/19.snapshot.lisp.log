;;; Input

(define (main)
  (= x 1)
  (println
   (iadd
    x
    (begin (= x (begin (= x 5) (iadd x x))) (iadd x 100)))))

;;; ShrinkPass

(define (main)
  (@let1 x 1
    (println
     ((iadd x)
      (@let1 x (@let1 x 5 ((iadd x) x)) ((iadd x) 100))))))

;;; UniquifyPass

(define (main)
  (@let1 x₁ 1
    (println
     ((iadd x₁)
      (@let1 x₂ (@let1 x₃ 5 ((iadd x₃) x₃)) ((iadd x₂) 100))))))

;;; RevealGlobalPass

(define (main)
  (@let1 x₁ 1
    ((@builtin-function-ref println 1)
     (((@builtin-function-ref iadd 2) x₁)
      (@let1 x₂
          (@let1 x₃ 5
            (((@builtin-function-ref iadd 2) x₃) x₃))
        (((@builtin-function-ref iadd 2) x₂) 100))))))

;;; LiftLambdaPass

(define (main)
  (@let1 x₁ 1
    ((@builtin-function-ref println 1)
     (((@builtin-function-ref iadd 2) x₁)
      (@let1 x₂
          (@let1 x₃ 5
            (((@builtin-function-ref iadd 2) x₃) x₃))
        (((@builtin-function-ref iadd 2) x₂) 100))))))

