;;; Input

(define (main)
  (= v 1)
  (= w 42)
  (= x (iadd v 7))
  (= y x)
  (= z (iadd x w))
  (println (iadd z (ineg y))))

;;; ShrinkPass

(define (main)
  (let ((v 1))
    (let ((w 42))
      (let ((x (iadd v 7)))
        (let ((y x))
          (let ((z (iadd x w))) (println (iadd z (ineg y)))))))))

;;; UniquifyPass

(define (main)
  (let ((v₁ 1))
    (let ((w₁ 42))
      (let ((x₁ (iadd v₁ 7)))
        (let ((y₁ x₁))
          (let ((z₁ (iadd x₁ w₁)))
            (println (iadd z₁ (ineg y₁)))))))))

;;; RevealGlobalPass

(define (main)
  (let ((v₁ 1))
    (let ((w₁ 42))
      (let ((x₁ ((@primitive iadd 2) v₁ 7)))
        (let ((y₁ x₁))
          (let ((z₁ ((@primitive iadd 2) x₁ w₁)))
            ((@primitive println 1)
             ((@primitive iadd 2) z₁ ((@primitive ineg 1) y₁)))))))))

;;; LiftLambdaPass

(define (main)
  (let ((v₁ 1))
    (let ((w₁ 42))
      (let ((x₁ ((@primitive iadd 2) v₁ 7)))
        (let ((y₁ x₁))
          (let ((z₁ ((@primitive iadd 2) x₁ w₁)))
            ((@primitive println 1)
             ((@primitive iadd 2) z₁ ((@primitive ineg 1) y₁)))))))))

;;; UnnestOperandPass

(define (main)
  (let ((v₁ 1))
    (let ((w₁ 42))
      (let ((x₁ ((@primitive iadd 2) v₁ 7)))
        (let ((y₁ x₁))
          (let ((z₁ ((@primitive iadd 2) x₁ w₁)))
            (let ((_₁ ((@primitive ineg 1) y₁)))
              (let ((_₂ ((@primitive iadd 2) z₁ _₁)))
                ((@primitive println 1) _₂)))))))))

