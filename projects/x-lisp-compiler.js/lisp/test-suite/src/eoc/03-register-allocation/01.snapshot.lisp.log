;;; Input

(define (main)
  (= v 1)
  (= w 42)
  (= x (iadd v 7))
  (= y x)
  (= z (iadd x w))
  (println (iadd z (ineg y))))

;;; ShrinkPass

(define (main)
  (@let1 v 1
    (@let1 w 42
      (@let1 x (iadd v 7)
        (@let1 y x
          (@let1 z (iadd x w) (println (iadd z (ineg y)))))))))

;;; UniquifyPass

(define (main)
  (@let1 v₁ 1
    (@let1 w₁ 42
      (@let1 x₁ (iadd v₁ 7)
        (@let1 y₁ x₁
          (@let1 z₁ (iadd x₁ w₁)
            (println (iadd z₁ (ineg y₁)))))))))

;;; RevealGlobalPass

(define (main)
  (@let1 v₁ 1
    (@let1 w₁ 42
      (@let1 x₁ ((@primitive-function-ref iadd 2) v₁ 7)
        (@let1 y₁ x₁
          (@let1 z₁ ((@primitive-function-ref iadd 2) x₁ w₁)
            ((@primitive-function-ref println 1)
             ((@primitive-function-ref iadd 2)
              z₁
              ((@primitive-function-ref ineg 1) y₁)))))))))

;;; LiftLambdaPass

(define (main)
  (@let1 v₁ 1
    (@let1 w₁ 42
      (@let1 x₁ ((@primitive-function-ref iadd 2) v₁ 7)
        (@let1 y₁ x₁
          (@let1 z₁ ((@primitive-function-ref iadd 2) x₁ w₁)
            ((@primitive-function-ref println 1)
             ((@primitive-function-ref iadd 2)
              z₁
              ((@primitive-function-ref ineg 1) y₁)))))))))

;;; UnnestOperandPass

(define (main)
  (@let1 v₁ 1
    (@let1 w₁ 42
      (@let1 x₁ ((@primitive-function-ref iadd 2) v₁ 7)
        (@let1 y₁ x₁
          (@let1 z₁ ((@primitive-function-ref iadd 2) x₁ w₁)
            (@let1 _₁ ((@primitive-function-ref ineg 1) y₁)
              (@let1 _₂
                  ((@primitive-function-ref iadd 2) z₁ _₁)
                ((@primitive-function-ref println 1) _₂)))))))))

