;;; Input

(define (main)
  (= x (begin (print 1) (newline) (print 2) (newline) (print 3) (newline) 6))
  (begin (print 4) (newline) (print 5) (newline) (print 6) (newline) (iadd x x)))

;;; ShrinkPass

(define (main)
  (@let1 x
      (@begin1 (print 1)
        (@begin1 (newline)
          (@begin1 (print 2)
            (@begin1 (newline) (@begin1 (print 3) (@begin1 (newline) 6))))))
    (@begin1 (print 4)
      (@begin1 (newline)
        (@begin1 (print 5)
          (@begin1 (newline) (@begin1 (print 6) (@begin1 (newline) (iadd x x)))))))))

;;; UniquifyPass

(define (main)
  (@let1 x₁
      (@begin1 (print 1)
        (@begin1 (newline)
          (@begin1 (print 2)
            (@begin1 (newline) (@begin1 (print 3) (@begin1 (newline) 6))))))
    (@begin1 (print 4)
      (@begin1 (newline)
        (@begin1 (print 5)
          (@begin1 (newline)
            (@begin1 (print 6) (@begin1 (newline) (iadd x₁ x₁)))))))))

;;; RevealGlobalPass

(define (main)
  (@let1 x₁
      (@begin1 ((@primitive-function-ref print 1) 1)
        (@begin1 ((@primitive-function-ref newline 0))
          (@begin1 ((@primitive-function-ref print 1) 2)
            (@begin1 ((@primitive-function-ref newline 0))
              (@begin1 ((@primitive-function-ref print 1) 3)
                (@begin1 ((@primitive-function-ref newline 0)) 6))))))
    (@begin1 ((@primitive-function-ref print 1) 4)
      (@begin1 ((@primitive-function-ref newline 0))
        (@begin1 ((@primitive-function-ref print 1) 5)
          (@begin1 ((@primitive-function-ref newline 0))
            (@begin1 ((@primitive-function-ref print 1) 6)
              (@begin1 ((@primitive-function-ref newline 0))
                ((@primitive-function-ref iadd 2) x₁ x₁)))))))))

;;; LiftLambdaPass

(define (main)
  (@let1 x₁
      (@begin1 ((@primitive-function-ref print 1) 1)
        (@begin1 ((@primitive-function-ref newline 0))
          (@begin1 ((@primitive-function-ref print 1) 2)
            (@begin1 ((@primitive-function-ref newline 0))
              (@begin1 ((@primitive-function-ref print 1) 3)
                (@begin1 ((@primitive-function-ref newline 0)) 6))))))
    (@begin1 ((@primitive-function-ref print 1) 4)
      (@begin1 ((@primitive-function-ref newline 0))
        (@begin1 ((@primitive-function-ref print 1) 5)
          (@begin1 ((@primitive-function-ref newline 0))
            (@begin1 ((@primitive-function-ref print 1) 6)
              (@begin1 ((@primitive-function-ref newline 0))
                ((@primitive-function-ref iadd 2) x₁ x₁)))))))))

;;; UnnestOperandPass

(define (main)
  (@let1 x₁
      (@begin1 ((@primitive-function-ref print 1) 1)
        (@begin1 ((@primitive-function-ref newline 0))
          (@begin1 ((@primitive-function-ref print 1) 2)
            (@begin1 ((@primitive-function-ref newline 0))
              (@begin1 ((@primitive-function-ref print 1) 3)
                (@begin1 ((@primitive-function-ref newline 0)) 6))))))
    (@begin1 ((@primitive-function-ref print 1) 4)
      (@begin1 ((@primitive-function-ref newline 0))
        (@begin1 ((@primitive-function-ref print 1) 5)
          (@begin1 ((@primitive-function-ref newline 0))
            (@begin1 ((@primitive-function-ref print 1) 6)
              (@begin1 ((@primitive-function-ref newline 0))
                ((@primitive-function-ref iadd 2) x₁ x₁)))))))))

