;;; Input

(define (main)
  (= list (make-list))
  (list-push! 1 list)
  (list-push! 2 list)
  (list-push! 3 list)
  (println list)
  (println [1 2 3])
  (println '(1 2 3))
  (println [1 2 3])
  (println [1 2 3])
  (println ['a 'b 'c])
  (println '(a b c)))

;;; ShrinkPass

(define (main)
  (@let1 list (make-list)
    (@begin1 (list-push! 1 list)
      (@begin1 (list-push! 2 list)
        (@begin1 (list-push! 3 list)
          (@begin1 (println list)
            (@begin1
                (println
                 (@let1 tael (make-list)
                   (@begin1 (list-push! 1 tael)
                     (@begin1 (list-push! 2 tael)
                       (@begin1 (list-push! 3 tael) tael)))))
              (@begin1
                  (println
                   (@let1 tael (make-list)
                     (@begin1 (list-push! 1 tael)
                       (@begin1 (list-push! 2 tael)
                         (@begin1 (list-push! 3 tael) tael)))))
                (@begin1
                    (println
                     (@let1 tael (make-list)
                       (@begin1 (list-push! 1 tael)
                         (@begin1 (list-push! 2 tael)
                           (@begin1 (list-push! 3 tael) tael)))))
                  (@begin1
                      (println
                       (@let1 tael (make-list)
                         (@begin1 (list-push! 1 tael)
                           (@begin1 (list-push! 2 tael)
                             (@begin1 (list-push! 3 tael) tael)))))
                    (@begin1
                        (println
                         (@let1 tael (make-list)
                           (@begin1 (list-push! 'a tael)
                             (@begin1 (list-push! 'b tael)
                               (@begin1 (list-push! 'c tael)
                                 tael)))))
                      (println
                       (@let1 tael (make-list)
                         (@begin1 (list-push! 'a tael)
                           (@begin1 (list-push! 'b tael)
                             (@begin1 (list-push! 'c tael) tael))))))))))))))))

;;; UniquifyPass

(define (main)
  (@let1 list₁ (make-list)
    (@begin1 (list-push! 1 list₁)
      (@begin1 (list-push! 2 list₁)
        (@begin1 (list-push! 3 list₁)
          (@begin1 (println list₁)
            (@begin1
                (println
                 (@let1 tael₁ (make-list)
                   (@begin1 (list-push! 1 tael₁)
                     (@begin1 (list-push! 2 tael₁)
                       (@begin1 (list-push! 3 tael₁) tael₁)))))
              (@begin1
                  (println
                   (@let1 tael₁ (make-list)
                     (@begin1 (list-push! 1 tael₁)
                       (@begin1 (list-push! 2 tael₁)
                         (@begin1 (list-push! 3 tael₁) tael₁)))))
                (@begin1
                    (println
                     (@let1 tael₁ (make-list)
                       (@begin1 (list-push! 1 tael₁)
                         (@begin1 (list-push! 2 tael₁)
                           (@begin1 (list-push! 3 tael₁) tael₁)))))
                  (@begin1
                      (println
                       (@let1 tael₁ (make-list)
                         (@begin1 (list-push! 1 tael₁)
                           (@begin1 (list-push! 2 tael₁)
                             (@begin1 (list-push! 3 tael₁)
                               tael₁)))))
                    (@begin1
                        (println
                         (@let1 tael₁ (make-list)
                           (@begin1 (list-push! 'a tael₁)
                             (@begin1 (list-push! 'b tael₁)
                               (@begin1 (list-push! 'c tael₁)
                                 tael₁)))))
                      (println
                       (@let1 tael₁ (make-list)
                         (@begin1 (list-push! 'a tael₁)
                           (@begin1 (list-push! 'b tael₁)
                             (@begin1 (list-push! 'c tael₁)
                               tael₁))))))))))))))))

;;; RevealGlobalPass

(define (main)
  (@let1 list₁ ((@primitive make-list 0))
    (@begin1 ((@primitive list-push! 2) 1 list₁)
      (@begin1 ((@primitive list-push! 2) 2 list₁)
        (@begin1 ((@primitive list-push! 2) 3 list₁)
          (@begin1 ((@primitive println 1) list₁)
            (@begin1
                ((@primitive println 1)
                 (@let1 tael₁ ((@primitive make-list 0))
                   (@begin1 ((@primitive list-push! 2) 1 tael₁)
                     (@begin1
                         ((@primitive list-push! 2) 2 tael₁)
                       (@begin1
                           ((@primitive list-push! 2) 3 tael₁)
                         tael₁)))))
              (@begin1
                  ((@primitive println 1)
                   (@let1 tael₁ ((@primitive make-list 0))
                     (@begin1
                         ((@primitive list-push! 2) 1 tael₁)
                       (@begin1
                           ((@primitive list-push! 2) 2 tael₁)
                         (@begin1
                             ((@primitive list-push! 2) 3 tael₁)
                           tael₁)))))
                (@begin1
                    ((@primitive println 1)
                     (@let1 tael₁ ((@primitive make-list 0))
                       (@begin1
                           ((@primitive list-push! 2) 1 tael₁)
                         (@begin1
                             ((@primitive list-push! 2) 2 tael₁)
                           (@begin1
                               ((@primitive list-push! 2)
                                3
                                tael₁)
                             tael₁)))))
                  (@begin1
                      ((@primitive println 1)
                       (@let1 tael₁ ((@primitive make-list 0))
                         (@begin1
                             ((@primitive list-push! 2) 1 tael₁)
                           (@begin1
                               ((@primitive list-push! 2)
                                2
                                tael₁)
                             (@begin1
                                 ((@primitive list-push! 2)
                                  3
                                  tael₁)
                               tael₁)))))
                    (@begin1
                        ((@primitive println 1)
                         (@let1 tael₁ ((@primitive make-list 0))
                           (@begin1
                               ((@primitive list-push! 2)
                                'a
                                tael₁)
                             (@begin1
                                 ((@primitive list-push! 2)
                                  'b
                                  tael₁)
                               (@begin1
                                   ((@primitive list-push! 2)
                                    'c
                                    tael₁)
                                 tael₁)))))
                      ((@primitive println 1)
                       (@let1 tael₁ ((@primitive make-list 0))
                         (@begin1
                             ((@primitive list-push! 2) 'a tael₁)
                           (@begin1
                               ((@primitive list-push! 2)
                                'b
                                tael₁)
                             (@begin1
                                 ((@primitive list-push! 2)
                                  'c
                                  tael₁)
                               tael₁))))))))))))))))

;;; LiftLambdaPass

(define (main)
  (@let1 list₁ ((@primitive make-list 0))
    (@begin1 ((@primitive list-push! 2) 1 list₁)
      (@begin1 ((@primitive list-push! 2) 2 list₁)
        (@begin1 ((@primitive list-push! 2) 3 list₁)
          (@begin1 ((@primitive println 1) list₁)
            (@begin1
                ((@primitive println 1)
                 (@let1 tael₁ ((@primitive make-list 0))
                   (@begin1 ((@primitive list-push! 2) 1 tael₁)
                     (@begin1
                         ((@primitive list-push! 2) 2 tael₁)
                       (@begin1
                           ((@primitive list-push! 2) 3 tael₁)
                         tael₁)))))
              (@begin1
                  ((@primitive println 1)
                   (@let1 tael₁ ((@primitive make-list 0))
                     (@begin1
                         ((@primitive list-push! 2) 1 tael₁)
                       (@begin1
                           ((@primitive list-push! 2) 2 tael₁)
                         (@begin1
                             ((@primitive list-push! 2) 3 tael₁)
                           tael₁)))))
                (@begin1
                    ((@primitive println 1)
                     (@let1 tael₁ ((@primitive make-list 0))
                       (@begin1
                           ((@primitive list-push! 2) 1 tael₁)
                         (@begin1
                             ((@primitive list-push! 2) 2 tael₁)
                           (@begin1
                               ((@primitive list-push! 2)
                                3
                                tael₁)
                             tael₁)))))
                  (@begin1
                      ((@primitive println 1)
                       (@let1 tael₁ ((@primitive make-list 0))
                         (@begin1
                             ((@primitive list-push! 2) 1 tael₁)
                           (@begin1
                               ((@primitive list-push! 2)
                                2
                                tael₁)
                             (@begin1
                                 ((@primitive list-push! 2)
                                  3
                                  tael₁)
                               tael₁)))))
                    (@begin1
                        ((@primitive println 1)
                         (@let1 tael₁ ((@primitive make-list 0))
                           (@begin1
                               ((@primitive list-push! 2)
                                'a
                                tael₁)
                             (@begin1
                                 ((@primitive list-push! 2)
                                  'b
                                  tael₁)
                               (@begin1
                                   ((@primitive list-push! 2)
                                    'c
                                    tael₁)
                                 tael₁)))))
                      ((@primitive println 1)
                       (@let1 tael₁ ((@primitive make-list 0))
                         (@begin1
                             ((@primitive list-push! 2) 'a tael₁)
                           (@begin1
                               ((@primitive list-push! 2)
                                'b
                                tael₁)
                             (@begin1
                                 ((@primitive list-push! 2)
                                  'c
                                  tael₁)
                               tael₁))))))))))))))))

;;; UnnestOperandPass

(define (main)
  (@let1 list₁ ((@primitive make-list 0))
    (@begin1 ((@primitive list-push! 2) 1 list₁)
      (@begin1 ((@primitive list-push! 2) 2 list₁)
        (@begin1 ((@primitive list-push! 2) 3 list₁)
          (@begin1 ((@primitive println 1) list₁)
            (@begin1
                (@let1 tael₁ ((@primitive make-list 0))
                  (@begin1 ((@primitive list-push! 2) 1 tael₁)
                    (@begin1 ((@primitive list-push! 2) 2 tael₁)
                      (@begin1
                          ((@primitive list-push! 2) 3 tael₁)
                        ((@primitive println 1) tael₁)))))
              (@begin1
                  (@let1 tael₁ ((@primitive make-list 0))
                    (@begin1 ((@primitive list-push! 2) 1 tael₁)
                      (@begin1
                          ((@primitive list-push! 2) 2 tael₁)
                        (@begin1
                            ((@primitive list-push! 2) 3 tael₁)
                          ((@primitive println 1) tael₁)))))
                (@begin1
                    (@let1 tael₁ ((@primitive make-list 0))
                      (@begin1
                          ((@primitive list-push! 2) 1 tael₁)
                        (@begin1
                            ((@primitive list-push! 2) 2 tael₁)
                          (@begin1
                              ((@primitive list-push! 2) 3 tael₁)
                            ((@primitive println 1) tael₁)))))
                  (@begin1
                      (@let1 tael₁ ((@primitive make-list 0))
                        (@begin1
                            ((@primitive list-push! 2) 1 tael₁)
                          (@begin1
                              ((@primitive list-push! 2) 2 tael₁)
                            (@begin1
                                ((@primitive list-push! 2)
                                 3
                                 tael₁)
                              ((@primitive println 1) tael₁)))))
                    (@begin1
                        (@let1 tael₁ ((@primitive make-list 0))
                          (@begin1
                              ((@primitive list-push! 2)
                               'a
                               tael₁)
                            (@begin1
                                ((@primitive list-push! 2)
                                 'b
                                 tael₁)
                              (@begin1
                                  ((@primitive list-push! 2)
                                   'c
                                   tael₁)
                                ((@primitive println 1) tael₁)))))
                      (@let1 tael₁ ((@primitive make-list 0))
                        (@begin1
                            ((@primitive list-push! 2) 'a tael₁)
                          (@begin1
                              ((@primitive list-push! 2)
                               'b
                               tael₁)
                            (@begin1
                                ((@primitive list-push! 2)
                                 'c
                                 tael₁)
                              ((@primitive println 1) tael₁))))))))))))))))

