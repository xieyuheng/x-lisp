;;; Input

(define (main)
  (= list (make-list))
  (list-push! 1 list)
  (list-push! 2 list)
  (list-push! 3 list)
  (assert-equal [1 2 3] list)
  (assert-equal [1 2 3] '(1 2 3))
  (assert-equal ['a 'b 'c] '(a b c))
  (assert-equal 3 (list-length [1 2 3]))
  (assert-equal 0 (list-length []))
  (assert (list-empty? [])))

;;; ShrinkPass

(define (main)
  (let ((list (make-list)))
    (begin
      (list-push! 1 list)
      (begin
        (list-push! 2 list)
        (begin
          (list-push! 3 list)
          (begin
            (assert-equal
              (let ((tael (make-list)))
                (begin
                  (list-push! 1 tael)
                  (begin
                    (list-push! 2 tael)
                    (begin (list-push! 3 tael) tael))))
              list)
            (begin
              (assert-equal
                (let ((tael (make-list)))
                  (begin
                    (list-push! 1 tael)
                    (begin
                      (list-push! 2 tael)
                      (begin (list-push! 3 tael) tael))))
                (let ((tael (make-list)))
                  (begin
                    (list-push! 1 tael)
                    (begin
                      (list-push! 2 tael)
                      (begin (list-push! 3 tael) tael)))))
              (begin
                (assert-equal
                  (let ((tael (make-list)))
                    (begin
                      (list-push! 'a tael)
                      (begin
                        (list-push! 'b tael)
                        (begin (list-push! 'c tael) tael))))
                  (let ((tael (make-list)))
                    (begin
                      (list-push! 'a tael)
                      (begin
                        (list-push! 'b tael)
                        (begin (list-push! 'c tael) tael)))))
                (begin
                  (assert-equal
                    3
                    (list-length
                     (let ((tael (make-list)))
                       (begin
                         (list-push! 1 tael)
                         (begin
                           (list-push! 2 tael)
                           (begin (list-push! 3 tael) tael))))))
                  (begin
                    (assert-equal
                      0
                      (list-length
                       (let ((tael (make-list))) tael)))
                    (assert
                      (list-empty?
                       (let ((tael (make-list))) tael)))))))))))))

;;; UniquifyPass

(define (main)
  (let ((list₁ (make-list)))
    (begin
      (list-push! 1 list₁)
      (begin
        (list-push! 2 list₁)
        (begin
          (list-push! 3 list₁)
          (begin
            (assert-equal
              (let ((tael₁ (make-list)))
                (begin
                  (list-push! 1 tael₁)
                  (begin
                    (list-push! 2 tael₁)
                    (begin (list-push! 3 tael₁) tael₁))))
              list₁)
            (begin
              (assert-equal
                (let ((tael₁ (make-list)))
                  (begin
                    (list-push! 1 tael₁)
                    (begin
                      (list-push! 2 tael₁)
                      (begin (list-push! 3 tael₁) tael₁))))
                (let ((tael₁ (make-list)))
                  (begin
                    (list-push! 1 tael₁)
                    (begin
                      (list-push! 2 tael₁)
                      (begin (list-push! 3 tael₁) tael₁)))))
              (begin
                (assert-equal
                  (let ((tael₁ (make-list)))
                    (begin
                      (list-push! 'a tael₁)
                      (begin
                        (list-push! 'b tael₁)
                        (begin (list-push! 'c tael₁) tael₁))))
                  (let ((tael₁ (make-list)))
                    (begin
                      (list-push! 'a tael₁)
                      (begin
                        (list-push! 'b tael₁)
                        (begin (list-push! 'c tael₁) tael₁)))))
                (begin
                  (assert-equal
                    3
                    (list-length
                     (let ((tael₁ (make-list)))
                       (begin
                         (list-push! 1 tael₁)
                         (begin
                           (list-push! 2 tael₁)
                           (begin (list-push! 3 tael₁) tael₁))))))
                  (begin
                    (assert-equal
                      0
                      (list-length
                       (let ((tael₁ (make-list))) tael₁)))
                    (assert
                      (list-empty?
                       (let ((tael₁ (make-list))) tael₁)))))))))))))

;;; RevealGlobalPass

(define (main)
  (let ((list₁ ((@primitive make-list 0))))
    (begin
      ((@primitive list-push! 2) 1 list₁)
      (begin
        ((@primitive list-push! 2) 2 list₁)
        (begin
          ((@primitive list-push! 2) 3 list₁)
          (begin
            ((@primitive assert-equal 2)
             (let ((tael₁ ((@primitive make-list 0))))
               (begin
                 ((@primitive list-push! 2) 1 tael₁)
                 (begin
                   ((@primitive list-push! 2) 2 tael₁)
                   (begin
                     ((@primitive list-push! 2) 3 tael₁)
                     tael₁))))
             list₁)
            (begin
              ((@primitive assert-equal 2)
               (let ((tael₁ ((@primitive make-list 0))))
                 (begin
                   ((@primitive list-push! 2) 1 tael₁)
                   (begin
                     ((@primitive list-push! 2) 2 tael₁)
                     (begin
                       ((@primitive list-push! 2) 3 tael₁)
                       tael₁))))
               (let ((tael₁ ((@primitive make-list 0))))
                 (begin
                   ((@primitive list-push! 2) 1 tael₁)
                   (begin
                     ((@primitive list-push! 2) 2 tael₁)
                     (begin
                       ((@primitive list-push! 2) 3 tael₁)
                       tael₁)))))
              (begin
                ((@primitive assert-equal 2)
                 (let ((tael₁ ((@primitive make-list 0))))
                   (begin
                     ((@primitive list-push! 2) 'a tael₁)
                     (begin
                       ((@primitive list-push! 2) 'b tael₁)
                       (begin
                         ((@primitive list-push! 2) 'c tael₁)
                         tael₁))))
                 (let ((tael₁ ((@primitive make-list 0))))
                   (begin
                     ((@primitive list-push! 2) 'a tael₁)
                     (begin
                       ((@primitive list-push! 2) 'b tael₁)
                       (begin
                         ((@primitive list-push! 2) 'c tael₁)
                         tael₁)))))
                (begin
                  ((@primitive assert-equal 2)
                   3
                   ((@primitive list-length 1)
                    (let ((tael₁ ((@primitive make-list 0))))
                      (begin
                        ((@primitive list-push! 2) 1 tael₁)
                        (begin
                          ((@primitive list-push! 2) 2 tael₁)
                          (begin
                            ((@primitive list-push! 2) 3 tael₁)
                            tael₁))))))
                  (begin
                    ((@primitive assert-equal 2)
                     0
                     ((@primitive list-length 1)
                      (let ((tael₁ ((@primitive make-list 0))))
                        tael₁)))
                    ((@primitive assert 1)
                     ((@primitive list-empty? 1)
                      (let ((tael₁ ((@primitive make-list 0))))
                        tael₁)))))))))))))

;;; LiftLambdaPass

(define (main)
  (let ((list₁ ((@primitive make-list 0))))
    (begin
      ((@primitive list-push! 2) 1 list₁)
      (begin
        ((@primitive list-push! 2) 2 list₁)
        (begin
          ((@primitive list-push! 2) 3 list₁)
          (begin
            ((@primitive assert-equal 2)
             (let ((tael₁ ((@primitive make-list 0))))
               (begin
                 ((@primitive list-push! 2) 1 tael₁)
                 (begin
                   ((@primitive list-push! 2) 2 tael₁)
                   (begin
                     ((@primitive list-push! 2) 3 tael₁)
                     tael₁))))
             list₁)
            (begin
              ((@primitive assert-equal 2)
               (let ((tael₁ ((@primitive make-list 0))))
                 (begin
                   ((@primitive list-push! 2) 1 tael₁)
                   (begin
                     ((@primitive list-push! 2) 2 tael₁)
                     (begin
                       ((@primitive list-push! 2) 3 tael₁)
                       tael₁))))
               (let ((tael₁ ((@primitive make-list 0))))
                 (begin
                   ((@primitive list-push! 2) 1 tael₁)
                   (begin
                     ((@primitive list-push! 2) 2 tael₁)
                     (begin
                       ((@primitive list-push! 2) 3 tael₁)
                       tael₁)))))
              (begin
                ((@primitive assert-equal 2)
                 (let ((tael₁ ((@primitive make-list 0))))
                   (begin
                     ((@primitive list-push! 2) 'a tael₁)
                     (begin
                       ((@primitive list-push! 2) 'b tael₁)
                       (begin
                         ((@primitive list-push! 2) 'c tael₁)
                         tael₁))))
                 (let ((tael₁ ((@primitive make-list 0))))
                   (begin
                     ((@primitive list-push! 2) 'a tael₁)
                     (begin
                       ((@primitive list-push! 2) 'b tael₁)
                       (begin
                         ((@primitive list-push! 2) 'c tael₁)
                         tael₁)))))
                (begin
                  ((@primitive assert-equal 2)
                   3
                   ((@primitive list-length 1)
                    (let ((tael₁ ((@primitive make-list 0))))
                      (begin
                        ((@primitive list-push! 2) 1 tael₁)
                        (begin
                          ((@primitive list-push! 2) 2 tael₁)
                          (begin
                            ((@primitive list-push! 2) 3 tael₁)
                            tael₁))))))
                  (begin
                    ((@primitive assert-equal 2)
                     0
                     ((@primitive list-length 1)
                      (let ((tael₁ ((@primitive make-list 0))))
                        tael₁)))
                    ((@primitive assert 1)
                     ((@primitive list-empty? 1)
                      (let ((tael₁ ((@primitive make-list 0))))
                        tael₁)))))))))))))

;;; UnnestOperandPass

(define (main)
  (let ((list₁ ((@primitive make-list 0))))
    (begin
      ((@primitive list-push! 2) 1 list₁)
      (begin
        ((@primitive list-push! 2) 2 list₁)
        (begin
          ((@primitive list-push! 2) 3 list₁)
          (begin
            (let ((tael₁ ((@primitive make-list 0))))
              (begin
                ((@primitive list-push! 2) 1 tael₁)
                (begin
                  ((@primitive list-push! 2) 2 tael₁)
                  (begin
                    ((@primitive list-push! 2) 3 tael₁)
                    ((@primitive assert-equal 2) tael₁ list₁)))))
            (begin
              (let ((tael₁ ((@primitive make-list 0))))
                (begin
                  ((@primitive list-push! 2) 1 tael₁)
                  (begin
                    ((@primitive list-push! 2) 2 tael₁)
                    (begin
                      ((@primitive list-push! 2) 3 tael₁)
                      (let ((tael₁ ((@primitive make-list 0))))
                        (begin
                          ((@primitive list-push! 2) 1 tael₁)
                          (begin
                            ((@primitive list-push! 2) 2 tael₁)
                            (begin
                              ((@primitive list-push! 2) 3 tael₁)
                              ((@primitive assert-equal 2)
                               tael₁
                               tael₁)))))))))
              (begin
                (let ((tael₁ ((@primitive make-list 0))))
                  (begin
                    ((@primitive list-push! 2) 'a tael₁)
                    (begin
                      ((@primitive list-push! 2) 'b tael₁)
                      (begin
                        ((@primitive list-push! 2) 'c tael₁)
                        (let
                            ((tael₁ ((@primitive make-list 0))))
                          (begin
                            ((@primitive list-push! 2) 'a tael₁)
                            (begin
                              ((@primitive list-push! 2)
                               'b
                               tael₁)
                              (begin
                                ((@primitive list-push! 2)
                                 'c
                                 tael₁)
                                ((@primitive assert-equal 2)
                                 tael₁
                                 tael₁)))))))))
                (begin
                  (let ((tael₁ ((@primitive make-list 0))))
                    (begin
                      ((@primitive list-push! 2) 1 tael₁)
                      (begin
                        ((@primitive list-push! 2) 2 tael₁)
                        (begin
                          ((@primitive list-push! 2) 3 tael₁)
                          (let
                              ((_₁ ((@primitive list-length 1)
                                    tael₁)))
                            ((@primitive assert-equal 2) 3 _₁))))))
                  (begin
                    (let ((tael₁ ((@primitive make-list 0))))
                      (let
                          ((_₂ ((@primitive list-length 1) tael₁)))
                        ((@primitive assert-equal 2) 0 _₂)))
                    (let ((tael₁ ((@primitive make-list 0))))
                      (let
                          ((_₃ ((@primitive list-empty? 1) tael₁)))
                        ((@primitive assert 1) _₃)))))))))))))

