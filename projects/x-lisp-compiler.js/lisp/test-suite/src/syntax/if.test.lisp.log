;;; Input

(define (main)
  (assert-equal (if #t 1 2) 1)
  (assert-equal (if #f 1 2) 2)
  (assert (and #t #t #t))
  (assert (not (and #t #t #f)))
  (assert (or #f #f #t))
  (assert (not (or #f #f #f))))

;;; ShrinkPass

(define (main)
  (@begin1 (assert-equal (if #t 1 2) 1)
    (@begin1 (assert-equal (if #f 1 2) 2)
      (@begin1 (assert (if #t (if #t #t #f) #f))
        (@begin1 (assert (not (if #t (if #t #f #f) #f)))
          (@begin1 (assert (if #f #t (if #f #t #t)))
            (assert (not (if #f #t (if #f #t #f))))))))))

;;; UniquifyPass

(define (main)
  (@begin1 (assert-equal (if #t 1 2) 1)
    (@begin1 (assert-equal (if #f 1 2) 2)
      (@begin1 (assert (if #t (if #t #t #f) #f))
        (@begin1 (assert (not (if #t (if #t #f #f) #f)))
          (@begin1 (assert (if #f #t (if #f #t #t)))
            (assert (not (if #f #t (if #f #t #f))))))))))

;;; RevealGlobalPass

(define (main)
  (@begin1 ((@primitive-function-ref assert-equal 2) (if #t 1 2) 1)
    (@begin1 ((@primitive-function-ref assert-equal 2) (if #f 1 2) 2)
      (@begin1 ((@primitive-function-ref assert 1) (if #t (if #t #t #f) #f))
        (@begin1
            ((@primitive-function-ref assert 1)
             ((@primitive-function-ref not 1) (if #t (if #t #f #f) #f)))
          (@begin1 ((@primitive-function-ref assert 1) (if #f #t (if #f #t #t)))
            ((@primitive-function-ref assert 1)
             ((@primitive-function-ref not 1) (if #f #t (if #f #t #f))))))))))

;;; LiftLambdaPass

(define (main)
  (@begin1 ((@primitive-function-ref assert-equal 2) (if #t 1 2) 1)
    (@begin1 ((@primitive-function-ref assert-equal 2) (if #f 1 2) 2)
      (@begin1 ((@primitive-function-ref assert 1) (if #t (if #t #t #f) #f))
        (@begin1
            ((@primitive-function-ref assert 1)
             ((@primitive-function-ref not 1) (if #t (if #t #f #f) #f)))
          (@begin1 ((@primitive-function-ref assert 1) (if #f #t (if #f #t #t)))
            ((@primitive-function-ref assert 1)
             ((@primitive-function-ref not 1) (if #f #t (if #f #t #f))))))))))

;;; UnnestOperandPass

(define (main)
  (@begin1
      (@let1 _₁ (if #t 1 2) ((@primitive-function-ref assert-equal 2) _₁ 1))
    (@begin1
        (@let1 _₂ (if #f 1 2) ((@primitive-function-ref assert-equal 2) _₂ 2))
      (@begin1
          (@let1 _₃ (if #t (if #t #t #f) #f)
            ((@primitive-function-ref assert 1) _₃))
        (@begin1
            (@let1 _₄ (if #t (if #t #f #f) #f)
              (@let1 _₅ ((@primitive-function-ref not 1) _₄)
                ((@primitive-function-ref assert 1) _₅)))
          (@begin1
              (@let1 _₆ (if #f #t (if #f #t #t))
                ((@primitive-function-ref assert 1) _₆))
            (@let1 _₇ (if #f #t (if #f #t #f))
              (@let1 _₈ ((@primitive-function-ref not 1) _₇)
                ((@primitive-function-ref assert 1) _₈)))))))))

