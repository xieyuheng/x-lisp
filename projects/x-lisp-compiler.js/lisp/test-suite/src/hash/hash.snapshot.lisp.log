;;; Input

(define (main)
  (println (@hash))
  (println (@hash 1 2))
  (println (@hash 1 3))
  (println (@hash 1 2 3 4)))

;;; ShrinkPass

(define (main)
  (@begin1 (println (@let1 hash (make-hash) hash))
    (@begin1
        (println (@let1 hash (make-hash) (@begin1 (hash-put! 1 2 hash) hash)))
      (@begin1
          (println (@let1 hash (make-hash) (@begin1 (hash-put! 1 3 hash) hash)))
        (println
         (@let1 hash (make-hash)
           (@begin1 (hash-put! 1 2 hash) (@begin1 (hash-put! 3 4 hash) hash))))))))

;;; UniquifyPass

(define (main)
  (@begin1 (println (@let1 hash₁ (make-hash) hash₁))
    (@begin1
        (println (@let1 hash₁ (make-hash) (@begin1 (hash-put! 1 2 hash₁) hash₁)))
      (@begin1
          (println
           (@let1 hash₁ (make-hash) (@begin1 (hash-put! 1 3 hash₁) hash₁)))
        (println
         (@let1 hash₁ (make-hash)
           (@begin1 (hash-put! 1 2 hash₁) (@begin1 (hash-put! 3 4 hash₁) hash₁))))))))

;;; RevealGlobalPass

(define (main)
  (@begin1
      ((@primitive-function-ref println 1)
       (@let1 hash₁ ((@primitive-function-ref make-hash 0)) hash₁))
    (@begin1
        ((@primitive-function-ref println 1)
         (@let1 hash₁ ((@primitive-function-ref make-hash 0))
           (@begin1 ((@primitive-function-ref hash-put! 3) 1 2 hash₁) hash₁)))
      (@begin1
          ((@primitive-function-ref println 1)
           (@let1 hash₁ ((@primitive-function-ref make-hash 0))
             (@begin1 ((@primitive-function-ref hash-put! 3) 1 3 hash₁) hash₁)))
        ((@primitive-function-ref println 1)
         (@let1 hash₁ ((@primitive-function-ref make-hash 0))
           (@begin1 ((@primitive-function-ref hash-put! 3) 1 2 hash₁)
             (@begin1 ((@primitive-function-ref hash-put! 3) 3 4 hash₁) hash₁))))))))

;;; LiftLambdaPass

(define (main)
  (@begin1
      ((@primitive-function-ref println 1)
       (@let1 hash₁ ((@primitive-function-ref make-hash 0)) hash₁))
    (@begin1
        ((@primitive-function-ref println 1)
         (@let1 hash₁ ((@primitive-function-ref make-hash 0))
           (@begin1 ((@primitive-function-ref hash-put! 3) 1 2 hash₁) hash₁)))
      (@begin1
          ((@primitive-function-ref println 1)
           (@let1 hash₁ ((@primitive-function-ref make-hash 0))
             (@begin1 ((@primitive-function-ref hash-put! 3) 1 3 hash₁) hash₁)))
        ((@primitive-function-ref println 1)
         (@let1 hash₁ ((@primitive-function-ref make-hash 0))
           (@begin1 ((@primitive-function-ref hash-put! 3) 1 2 hash₁)
             (@begin1 ((@primitive-function-ref hash-put! 3) 3 4 hash₁) hash₁))))))))

;;; UnnestOperandPass

(define (main)
  (@begin1
      (@let1 hash₁ ((@primitive-function-ref make-hash 0))
        ((@primitive-function-ref println 1) hash₁))
    (@begin1
        (@let1 hash₁ ((@primitive-function-ref make-hash 0))
          (@begin1 ((@primitive-function-ref hash-put! 3) 1 2 hash₁)
            ((@primitive-function-ref println 1) hash₁)))
      (@begin1
          (@let1 hash₁ ((@primitive-function-ref make-hash 0))
            (@begin1 ((@primitive-function-ref hash-put! 3) 1 3 hash₁)
              ((@primitive-function-ref println 1) hash₁)))
        (@let1 hash₁ ((@primitive-function-ref make-hash 0))
          (@begin1 ((@primitive-function-ref hash-put! 3) 1 2 hash₁)
            (@begin1 ((@primitive-function-ref hash-put! 3) 3 4 hash₁)
              ((@primitive-function-ref println 1) hash₁))))))))

