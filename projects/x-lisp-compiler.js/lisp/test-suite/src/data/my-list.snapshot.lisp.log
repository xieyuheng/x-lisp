;;; Input

(import-all "my-list")

(define (main)
  (println nil)
  (println (li 1 (li 2 (li 3 nil)))))

(define (my-list? E value)
  (or (nil? value)
      (and (li? value)
           (E (li-head value))
           ((my-list? E) (li-tail value)))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; ShrinkPass

(import-all "my-list")

(define (main)
  (println nil)
  (println (li 1 (li 2 (li 3 nil)))))

(define (my-list? E value)
  (or (nil? value)
      (and (li? value)
           (E (li-head value))
           ((my-list? E) (li-tail value)))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; UniquifyPass

(import-all "my-list")

(define (main)
  (println nil)
  (println (li 1 (li 2 (li 3 nil)))))

(define (my-list? E value)
  (or (nil? value)
      (and (li? value)
           (E (li-head value))
           ((my-list? E) (li-tail value)))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; RevealGlobalPass

(import-all "my-list")

(define (main)
  (println nil)
  (println (li 1 (li 2 (li 3 nil)))))

(define (my-list? E value)
  (or (nil? value)
      (and (li? value)
           (E (li-head value))
           ((my-list? E) (li-tail value)))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; LiftLambdaPass

(import-all "my-list")

(define (main)
  (println nil)
  (println (li 1 (li 2 (li 3 nil)))))

;;; UnnestOperandPass

(import-all "my-list")

(define (main)
  (begin (= _₁ nil) (println _₁))
  (= _₂ nil)
  (= _₃ (li 3 _₂))
  (= _₄ (li 2 _₃))
  (= _₅ (li 1 _₄))
  (println _₅))

