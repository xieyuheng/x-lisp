;;; Input

(import-all "my-list")

(define (main)
  (println nil)
  (println (li 1 (li 2 (li 3 nil)))))

;;; Loaded

(define (main)
  (println nil)
  (println (li 1 (li 2 (li 3 nil)))))

(define-datatype (my-list-t E)
  nil
  (li (head E) (tail (my-list-t E))))

(define nil #nil)

(define (li head tail) [#li head tail])

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; ShrinkPass

(define (main)
  (println nil)
  (println (li 1 (li 2 (li 3 nil)))))

(define-datatype (my-list-t E)
  nil
  (li (head E) (tail (my-list-t E))))

(define nil #nil)

(define (li head tail) [#li head tail])

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; UniquifyPass

(define (main)
  (println nil)
  (println (li 1 (li 2 (li 3 nil)))))

(define-datatype (my-list-t E)
  nil
  (li (head E) (tail (my-list-t E))))

(define nil #nil)

(define (li head tail) [#li head tail])

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; LiftLambdaPass

(define (main)
  (println nil)
  (println (li 1 (li 2 (li 3 nil)))))

;;; UnnestOperandPass

(define (main)
  (println nil)
  (= _₁ (li 3 nil))
  (= _₂ (li 2 _₁))
  (= _₃ (li 1 _₂))
  (println _₃))

