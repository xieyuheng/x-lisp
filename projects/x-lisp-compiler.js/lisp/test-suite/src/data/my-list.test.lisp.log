;;; Input

(import-all "my-list")

(define (main)
  (assert-equal nil #nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    [#li 1 [#li 2 [#li 3 #nil]]])
  (assert (nil? nil))
  (assert (li? (li 1 (li 2 (li 3 nil)))))
  (assert-not (li? nil))
  (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list) 1)
  (li-put-head! 111 list)
  (assert-equal (li-head list) 111)
  (assert-equal (li-tail list) (li 2 (li 3 nil)))
  (li-put-tail! nil list)
  (assert-equal (li-tail list) nil)
  (assert (my-list? int? nil))
  (assert (my-list? int? (li 1 (li 2 (li 3 nil)))))
  (assert (my-list? symbol? nil))
  (assert-not (my-list? symbol? (li 1 (li 2 (li 3 nil)))))
  (assert-not (my-list? int? 1))
  (assert-not (my-list? int? 'a))
  (assert-equal (li 1 nil) ((li 1) nil)))

(define (my-list? E value)
  (or (nil? value)
      (and (li? value)
           (E (li-head value))
           ((my-list? E) (li-tail value)))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; ShrinkPass

(import-all "my-list")

(define (main)
  (assert-equal nil #nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    (begin
      (= tael (make-list))
      (list-push! #li tael)
      (list-push! 1 tael)
      (list-push!
       (begin
         (= tael (make-list))
         (list-push! #li tael)
         (list-push! 2 tael)
         (list-push!
          (begin
            (= tael (make-list))
            (list-push! #li tael)
            (list-push! 3 tael)
            (list-push! #nil tael)
            tael)
          tael)
         tael)
       tael)
      tael))
  (assert (nil? nil))
  (assert (li? (li 1 (li 2 (li 3 nil)))))
  (assert-not (li? nil))
  (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list) 1)
  (li-put-head! 111 list)
  (assert-equal (li-head list) 111)
  (assert-equal (li-tail list) (li 2 (li 3 nil)))
  (li-put-tail! nil list)
  (assert-equal (li-tail list) nil)
  (assert (my-list? int? nil))
  (assert (my-list? int? (li 1 (li 2 (li 3 nil)))))
  (assert (my-list? symbol? nil))
  (assert-not (my-list? symbol? (li 1 (li 2 (li 3 nil)))))
  (assert-not (my-list? int? 1))
  (assert-not (my-list? int? 'a))
  (assert-equal (li 1 nil) ((li 1) nil)))

(define (my-list? E value)
  (or (nil? value)
      (and (li? value)
           (E (li-head value))
           ((my-list? E) (li-tail value)))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; UniquifyPass

(import-all "my-list")

(define (main)
  (assert-equal nil #nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    (begin
      (= tael₁ (make-list))
      (list-push! #li tael₁)
      (list-push! 1 tael₁)
      (list-push!
       (begin
         (= tael₂ (make-list))
         (list-push! #li tael₂)
         (list-push! 2 tael₂)
         (list-push!
          (begin
            (= tael₃ (make-list))
            (list-push! #li tael₃)
            (list-push! 3 tael₃)
            (list-push! #nil tael₃)
            tael₃)
          tael₂)
         tael₂)
       tael₁)
      tael₁))
  (assert (nil? nil))
  (assert (li? (li 1 (li 2 (li 3 nil)))))
  (assert-not (li? nil))
  (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list₁ (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list₁) 1)
  (li-put-head! 111 list₁)
  (assert-equal (li-head list₁) 111)
  (assert-equal (li-tail list₁) (li 2 (li 3 nil)))
  (li-put-tail! nil list₁)
  (assert-equal (li-tail list₁) nil)
  (assert (my-list? int? nil))
  (assert (my-list? int? (li 1 (li 2 (li 3 nil)))))
  (assert (my-list? symbol? nil))
  (assert-not (my-list? symbol? (li 1 (li 2 (li 3 nil)))))
  (assert-not (my-list? int? 1))
  (assert-not (my-list? int? 'a))
  (assert-equal (li 1 nil) ((li 1) nil)))

(define (my-list? E value)
  (or (nil? value)
      (and (li? value)
           (E (li-head value))
           ((my-list? E) (li-tail value)))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; RevealGlobalPass

(import-all "my-list")

(define (main)
  (assert-equal nil #nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    (begin
      (= tael₁ (make-list))
      (list-push! #li tael₁)
      (list-push! 1 tael₁)
      (list-push!
       (begin
         (= tael₂ (make-list))
         (list-push! #li tael₂)
         (list-push! 2 tael₂)
         (list-push!
          (begin
            (= tael₃ (make-list))
            (list-push! #li tael₃)
            (list-push! 3 tael₃)
            (list-push! #nil tael₃)
            tael₃)
          tael₂)
         tael₂)
       tael₁)
      tael₁))
  (assert (nil? nil))
  (assert (li? (li 1 (li 2 (li 3 nil)))))
  (assert-not (li? nil))
  (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list₁ (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list₁) 1)
  (li-put-head! 111 list₁)
  (assert-equal (li-head list₁) 111)
  (assert-equal (li-tail list₁) (li 2 (li 3 nil)))
  (li-put-tail! nil list₁)
  (assert-equal (li-tail list₁) nil)
  (assert (my-list? int? nil))
  (assert (my-list? int? (li 1 (li 2 (li 3 nil)))))
  (assert (my-list? symbol? nil))
  (assert-not (my-list? symbol? (li 1 (li 2 (li 3 nil)))))
  (assert-not (my-list? int? 1))
  (assert-not (my-list? int? 'a))
  (assert-equal (li 1 nil) ((li 1) nil)))

(define (my-list? E value)
  (or (nil? value)
      (and (li? value)
           (E (li-head value))
           ((my-list? E) (li-tail value)))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; LiftLambdaPass

(import-all "my-list")

(define (main)
  (assert-equal nil #nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    (begin
      (= tael₁ (make-list))
      (list-push! #li tael₁)
      (list-push! 1 tael₁)
      (list-push!
       (begin
         (= tael₂ (make-list))
         (list-push! #li tael₂)
         (list-push! 2 tael₂)
         (list-push!
          (begin
            (= tael₃ (make-list))
            (list-push! #li tael₃)
            (list-push! 3 tael₃)
            (list-push! #nil tael₃)
            tael₃)
          tael₂)
         tael₂)
       tael₁)
      tael₁))
  (assert (nil? nil))
  (assert (li? (li 1 (li 2 (li 3 nil)))))
  (assert-not (li? nil))
  (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list₁ (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list₁) 1)
  (li-put-head! 111 list₁)
  (assert-equal (li-head list₁) 111)
  (assert-equal (li-tail list₁) (li 2 (li 3 nil)))
  (li-put-tail! nil list₁)
  (assert-equal (li-tail list₁) nil)
  (assert (my-list? int? nil))
  (assert (my-list? int? (li 1 (li 2 (li 3 nil)))))
  (assert (my-list? symbol? nil))
  (assert-not (my-list? symbol? (li 1 (li 2 (li 3 nil)))))
  (assert-not (my-list? int? 1))
  (assert-not (my-list? int? 'a))
  (assert-equal (li 1 nil) ((li 1) nil)))

;;; UnnestOperandPass

(import-all "my-list")

(define (main)
  (begin (= _₁ nil) (assert-equal _₁ #nil))
  (begin
    (= _₂ nil)
    (= _₃ (li 3 _₂))
    (= _₄ (li 2 _₃))
    (= _₅ (li 1 _₄))
    (= tael₁ (make-list))
    (list-push! #li tael₁)
    (list-push! 1 tael₁)
    (begin
      (= tael₂ (make-list))
      (list-push! #li tael₂)
      (list-push! 2 tael₂)
      (begin
        (= tael₃ (make-list))
        (list-push! #li tael₃)
        (list-push! 3 tael₃)
        (list-push! #nil tael₃)
        (list-push! tael₃ tael₂))
      (list-push! tael₂ tael₁))
    (assert-equal _₅ tael₁))
  (begin (= _₆ nil) (= _₇ (nil? _₆)) (assert _₇))
  (begin
    (= _₈ nil)
    (= _₉ (li 3 _₈))
    (= _₁₀ (li 2 _₉))
    (= _₁₁ (li 1 _₁₀))
    (= _₁₂ (li? _₁₁))
    (assert _₁₂))
  (begin (= _₁₃ nil) (= _₁₄ (li? _₁₃)) (assert-not _₁₄))
  (begin
    (= _₁₅ nil)
    (= _₁₆ (li 3 _₁₅))
    (= _₁₇ (li 2 _₁₆))
    (= _₁₈ (li 1 _₁₇))
    (= _₁₉ (nil? _₁₈))
    (assert-not _₁₉))
  (begin
    (= _₂₀ nil)
    (= _₂₁ (li 1 _₂₀))
    (= _₂₂ (li-tail _₂₁))
    (= _₂₃ nil)
    (assert-equal _₂₂ _₂₃))
  (begin
    (= _₂₄ nil)
    (= _₂₅ (li 1 _₂₄))
    (= _₂₆ (li-head _₂₅))
    (assert-equal _₂₆ 1))
  (= list₁
     (begin
       (= _₂₇ nil)
       (= _₂₈ (li 3 _₂₇))
       (= _₂₉ (li 2 _₂₈))
       (li 1 _₂₉)))
  (begin (= _₃₀ (li-head list₁)) (assert-equal _₃₀ 1))
  (li-put-head! 111 list₁)
  (begin (= _₃₁ (li-head list₁)) (assert-equal _₃₁ 111))
  (begin
    (= _₃₂ (li-tail list₁))
    (= _₃₃ nil)
    (= _₃₄ (li 3 _₃₃))
    (= _₃₅ (li 2 _₃₄))
    (assert-equal _₃₂ _₃₅))
  (begin (= _₃₆ nil) (li-put-tail! _₃₆ list₁))
  (begin
    (= _₃₇ (li-tail list₁))
    (= _₃₈ nil)
    (assert-equal _₃₇ _₃₈))
  (begin
    (= _₃₉ nil)
    (= _₄₀ (my-list? int? _₃₉))
    (assert _₄₀))
  (begin
    (= _₄₁ nil)
    (= _₄₂ (li 3 _₄₁))
    (= _₄₃ (li 2 _₄₂))
    (= _₄₄ (li 1 _₄₃))
    (= _₄₅ (my-list? int? _₄₄))
    (assert _₄₅))
  (begin
    (= _₄₆ nil)
    (= _₄₇ (my-list? symbol? _₄₆))
    (assert _₄₇))
  (begin
    (= _₄₈ nil)
    (= _₄₉ (li 3 _₄₈))
    (= _₅₀ (li 2 _₄₉))
    (= _₅₁ (li 1 _₅₀))
    (= _₅₂ (my-list? symbol? _₅₁))
    (assert-not _₅₂))
  (begin (= _₅₃ (my-list? int? 1)) (assert-not _₅₃))
  (begin (= _₅₄ (my-list? int? 'a)) (assert-not _₅₄))
  (= _₅₅ nil)
  (= _₅₆ (li 1 _₅₅))
  (= _₅₇ (li 1))
  (= _₅₈ nil)
  (= _₅₉ (_₅₇ _₅₈))
  (assert-equal _₅₆ _₅₉))

