;;; Input

(import-all "my-list")

(define (main)
  (assert-equal nil #nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    [#li 1 [#li 2 [#li 3 #nil]]])
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list) 1)
  (li-put-head! 111 list)
  (assert-equal (li-head list) 111)
  (assert-equal (li-tail list) (li 2 (li 3 nil)))
  (li-put-tail! nil list)
  (assert-equal (li-tail list) nil)
  (assert-equal (li 1 nil) ((li 1) nil)))

;;; Loaded

(define (main)
  (assert-equal nil #nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    [#li 1 [#li 2 [#li 3 #nil]]])
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list) 1)
  (li-put-head! 111 list)
  (assert-equal (li-head list) 111)
  (assert-equal (li-tail list) (li 2 (li 3 nil)))
  (li-put-tail! nil list)
  (assert-equal (li-tail list) nil)
  (assert-equal (li 1 nil) ((li 1) nil)))

(define nil #nil)

(define (li head tail) [#li head tail])

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; ShrinkPass

(define (main)
  (assert-equal nil #nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    (begin
      (= tael (make-list))
      (list-push! #li tael)
      (list-push! 1 tael)
      (list-push!
       (begin
         (= tael (make-list))
         (list-push! #li tael)
         (list-push! 2 tael)
         (list-push!
          (begin
            (= tael (make-list))
            (list-push! #li tael)
            (list-push! 3 tael)
            (list-push! #nil tael)
            tael)
          tael)
         tael)
       tael)
      tael))
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list) 1)
  (li-put-head! 111 list)
  (assert-equal (li-head list) 111)
  (assert-equal (li-tail list) (li 2 (li 3 nil)))
  (li-put-tail! nil list)
  (assert-equal (li-tail list) nil)
  (assert-equal (li 1 nil) ((li 1) nil)))

(define nil #nil)

(define (li head tail) [#li head tail])

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; UniquifyPass

(define (main)
  (assert-equal nil #nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    (begin
      (= tael₁ (make-list))
      (list-push! #li tael₁)
      (list-push! 1 tael₁)
      (list-push!
       (begin
         (= tael₂ (make-list))
         (list-push! #li tael₂)
         (list-push! 2 tael₂)
         (list-push!
          (begin
            (= tael₃ (make-list))
            (list-push! #li tael₃)
            (list-push! 3 tael₃)
            (list-push! #nil tael₃)
            tael₃)
          tael₂)
         tael₂)
       tael₁)
      tael₁))
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list₁ (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list₁) 1)
  (li-put-head! 111 list₁)
  (assert-equal (li-head list₁) 111)
  (assert-equal (li-tail list₁) (li 2 (li 3 nil)))
  (li-put-tail! nil list₁)
  (assert-equal (li-tail list₁) nil)
  (assert-equal (li 1 nil) ((li 1) nil)))

(define nil #nil)

(define (li head tail) [#li head tail])

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; RevealGlobalPass

(define (main)
  (assert-equal nil #nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    (begin
      (= tael₁ (make-list))
      (list-push! #li tael₁)
      (list-push! 1 tael₁)
      (list-push!
       (begin
         (= tael₂ (make-list))
         (list-push! #li tael₂)
         (list-push! 2 tael₂)
         (list-push!
          (begin
            (= tael₃ (make-list))
            (list-push! #li tael₃)
            (list-push! 3 tael₃)
            (list-push! #nil tael₃)
            tael₃)
          tael₂)
         tael₂)
       tael₁)
      tael₁))
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list₁ (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list₁) 1)
  (li-put-head! 111 list₁)
  (assert-equal (li-head list₁) 111)
  (assert-equal (li-tail list₁) (li 2 (li 3 nil)))
  (li-put-tail! nil list₁)
  (assert-equal (li-tail list₁) nil)
  (assert-equal (li 1 nil) ((li 1) nil)))

(define nil #nil)

(define (li head tail) [#li head tail])

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; LiftLambdaPass

(define (main)
  (assert-equal nil #nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    (begin
      (= tael₁ (make-list))
      (list-push! #li tael₁)
      (list-push! 1 tael₁)
      (list-push!
       (begin
         (= tael₂ (make-list))
         (list-push! #li tael₂)
         (list-push! 2 tael₂)
         (list-push!
          (begin
            (= tael₃ (make-list))
            (list-push! #li tael₃)
            (list-push! 3 tael₃)
            (list-push! #nil tael₃)
            tael₃)
          tael₂)
         tael₂)
       tael₁)
      tael₁))
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list₁ (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list₁) 1)
  (li-put-head! 111 list₁)
  (assert-equal (li-head list₁) 111)
  (assert-equal (li-tail list₁) (li 2 (li 3 nil)))
  (li-put-tail! nil list₁)
  (assert-equal (li-tail list₁) nil)
  (assert-equal (li 1 nil) ((li 1) nil)))

;;; UnnestOperandPass

(define (main)
  (begin (= _₁ nil) (assert-equal _₁ #nil))
  (begin
    (= _₂ nil)
    (= _₃ (li 3 _₂))
    (= _₄ (li 2 _₃))
    (= _₅ (li 1 _₄))
    (= tael₁ (make-list))
    (list-push! #li tael₁)
    (list-push! 1 tael₁)
    (begin
      (= tael₂ (make-list))
      (list-push! #li tael₂)
      (list-push! 2 tael₂)
      (begin
        (= tael₃ (make-list))
        (list-push! #li tael₃)
        (list-push! 3 tael₃)
        (list-push! #nil tael₃)
        (list-push! tael₃ tael₂))
      (list-push! tael₂ tael₁))
    (assert-equal _₅ tael₁))
  (begin
    (= _₆ nil)
    (= _₇ (li 1 _₆))
    (= _₈ (li-tail _₇))
    (= _₉ nil)
    (assert-equal _₈ _₉))
  (begin
    (= _₁₀ nil)
    (= _₁₁ (li 1 _₁₀))
    (= _₁₂ (li-head _₁₁))
    (assert-equal _₁₂ 1))
  (= list₁
     (begin
       (= _₁₃ nil)
       (= _₁₄ (li 3 _₁₃))
       (= _₁₅ (li 2 _₁₄))
       (li 1 _₁₅)))
  (begin (= _₁₆ (li-head list₁)) (assert-equal _₁₆ 1))
  (li-put-head! 111 list₁)
  (begin (= _₁₇ (li-head list₁)) (assert-equal _₁₇ 111))
  (begin
    (= _₁₈ (li-tail list₁))
    (= _₁₉ nil)
    (= _₂₀ (li 3 _₁₉))
    (= _₂₁ (li 2 _₂₀))
    (assert-equal _₁₈ _₂₁))
  (begin (= _₂₂ nil) (li-put-tail! _₂₂ list₁))
  (begin
    (= _₂₃ (li-tail list₁))
    (= _₂₄ nil)
    (assert-equal _₂₃ _₂₄))
  (= _₂₅ nil)
  (= _₂₆ (li 1 _₂₅))
  (= _₂₇ (li 1))
  (= _₂₈ nil)
  (= _₂₉ (_₂₇ _₂₈))
  (assert-equal _₂₆ _₂₉))

