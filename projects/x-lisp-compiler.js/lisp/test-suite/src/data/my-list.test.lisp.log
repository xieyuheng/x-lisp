;;; Input

(import-all "my-list")

(define (main)
  (assert-equal nil nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list) 1)
  (li-put-head! 111 list)
  (assert-equal (li-head list) 111)
  (assert-equal (li-tail list) (li 2 (li 3 nil)))
  (li-put-tail! nil list)
  (assert-equal (li-tail list) nil))

(define nil #nil)

(define (li head tail) [#li head tail])

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; ShrinkPass

(import-all "my-list")

(define (main)
  (begin
    (assert-equal nil nil)
    (begin
      (assert-equal
        (li 1 (li 2 (li 3 nil)))
        (li 1 (li 2 (li 3 nil))))
      (begin
        (assert-equal (li-tail (li 1 nil)) nil)
        (begin
          (assert-equal (li-head (li 1 nil)) 1)
          (let ((list (li 1 (li 2 (li 3 nil)))))
            (begin
              (assert-equal (li-head list) 1)
              (begin
                (li-put-head! 111 list)
                (begin
                  (assert-equal (li-head list) 111)
                  (begin
                    (assert-equal
                      (li-tail list)
                      (li 2 (li 3 nil)))
                    (begin
                      (li-put-tail! nil list)
                      (assert-equal (li-tail list) nil))))))))))))

(define nil #nil)

(define (li head tail) [#li head tail])

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; UniquifyPass

(import-all "my-list")

(define (main)
  (begin
    (assert-equal nil nil)
    (begin
      (assert-equal
        (li 1 (li 2 (li 3 nil)))
        (li 1 (li 2 (li 3 nil))))
      (begin
        (assert-equal (li-tail (li 1 nil)) nil)
        (begin
          (assert-equal (li-head (li 1 nil)) 1)
          (let ((list₁ (li 1 (li 2 (li 3 nil)))))
            (begin
              (assert-equal (li-head list₁) 1)
              (begin
                (li-put-head! 111 list₁)
                (begin
                  (assert-equal (li-head list₁) 111)
                  (begin
                    (assert-equal
                      (li-tail list₁)
                      (li 2 (li 3 nil)))
                    (begin
                      (li-put-tail! nil list₁)
                      (assert-equal (li-tail list₁) nil))))))))))))

(define nil #nil)

(define (li head tail) [#li head tail])

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; RevealGlobalPass

(import-all "my-list")

(define (main)
  (begin
    (assert-equal nil nil)
    (begin
      (assert-equal
        (li 1 (li 2 (li 3 nil)))
        (li 1 (li 2 (li 3 nil))))
      (begin
        (assert-equal (li-tail (li 1 nil)) nil)
        (begin
          (assert-equal (li-head (li 1 nil)) 1)
          (let ((list₁ (li 1 (li 2 (li 3 nil)))))
            (begin
              (assert-equal (li-head list₁) 1)
              (begin
                (li-put-head! 111 list₁)
                (begin
                  (assert-equal (li-head list₁) 111)
                  (begin
                    (assert-equal
                      (li-tail list₁)
                      (li 2 (li 3 nil)))
                    (begin
                      (li-put-tail! nil list₁)
                      (assert-equal (li-tail list₁) nil))))))))))))

(define nil #nil)

(define (li head tail) [#li head tail])

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; LiftLambdaPass

(import-all "my-list")

(define (main)
  (begin
    (assert-equal nil nil)
    (begin
      (assert-equal
        (li 1 (li 2 (li 3 nil)))
        (li 1 (li 2 (li 3 nil))))
      (begin
        (assert-equal (li-tail (li 1 nil)) nil)
        (begin
          (assert-equal (li-head (li 1 nil)) 1)
          (let ((list₁ (li 1 (li 2 (li 3 nil)))))
            (begin
              (assert-equal (li-head list₁) 1)
              (begin
                (li-put-head! 111 list₁)
                (begin
                  (assert-equal (li-head list₁) 111)
                  (begin
                    (assert-equal
                      (li-tail list₁)
                      (li 2 (li 3 nil)))
                    (begin
                      (li-put-tail! nil list₁)
                      (assert-equal (li-tail list₁) nil))))))))))))

;;; UnnestOperandPass

(import-all "my-list")

(define (main)
  (begin
    (let ((_₁ nil)) (let ((_₂ nil)) (assert-equal _₁ _₂)))
    (begin
      (let ((_₃ nil))
        (let ((_₄ (li 3 _₃)))
          (let ((_₅ (li 2 _₄)))
            (let ((_₆ (li 1 _₅)))
              (let ((_₇ nil))
                (let ((_₈ (li 3 _₇)))
                  (let ((_₉ (li 2 _₈)))
                    (let ((_₁₀ (li 1 _₉)))
                      (assert-equal _₆ _₁₀)))))))))
      (begin
        (let ((_₁₁ nil))
          (let ((_₁₂ (li 1 _₁₁)))
            (let ((_₁₃ (li-tail _₁₂)))
              (let ((_₁₄ nil)) (assert-equal _₁₃ _₁₄)))))
        (begin
          (let ((_₁₅ nil))
            (let ((_₁₆ (li 1 _₁₅)))
              (let ((_₁₇ (li-head _₁₆)))
                (assert-equal _₁₇ 1))))
          (let
              ((list₁
                (let ((_₁₈ nil))
                  (let ((_₁₉ (li 3 _₁₈)))
                    (let ((_₂₀ (li 2 _₁₉))) (li 1 _₂₀))))))
            (begin
              (let ((_₂₁ (li-head list₁)))
                (assert-equal _₂₁ 1))
              (begin
                (li-put-head! 111 list₁)
                (begin
                  (let ((_₂₂ (li-head list₁)))
                    (assert-equal _₂₂ 111))
                  (begin
                    (let ((_₂₃ (li-tail list₁)))
                      (let ((_₂₄ nil))
                        (let ((_₂₅ (li 3 _₂₄)))
                          (let ((_₂₆ (li 2 _₂₅)))
                            (assert-equal _₂₃ _₂₆)))))
                    (begin
                      (let ((_₂₇ nil))
                        (li-put-tail! _₂₇ list₁))
                      (let ((_₂₈ (li-tail list₁)))
                        (let ((_₂₉ nil))
                          (assert-equal _₂₈ _₂₉))))))))))))))

