;;; Input

(import-all "my-list")

(define (main)
  (assert-equal nil #nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    [#li 1 [#li 2 [#li 3 #nil]]])
  (assert (nil? nil))
  (assert (li? (li 1 (li 2 (li 3 nil)))))
  (assert-not (li? nil))
  (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list) 1)
  (li-put-head! 111 list)
  (assert-equal (li-head list) 111)
  (assert-equal (li-tail list) (li 2 (li 3 nil)))
  (li-put-tail! nil list)
  (assert-equal (li-tail list) nil)
  (assert-equal (li 1 nil) ((li 1) nil)))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; ShrinkPass

(import-all "my-list")

(define (main)
  (begin
    (assert-equal nil #nil)
    (begin
      (assert-equal
        (li 1 (li 2 (li 3 nil)))
        (let ((tael (make-list)))
          (begin
            (list-push! #li tael)
            (begin
              (list-push! 1 tael)
              (begin
                (list-push!
                 (let ((tael (make-list)))
                   (begin
                     (list-push! #li tael)
                     (begin
                       (list-push! 2 tael)
                       (begin
                         (list-push!
                          (let ((tael (make-list)))
                            (begin
                              (list-push! #li tael)
                              (begin
                                (list-push! 3 tael)
                                (begin
                                  (list-push! #nil tael)
                                  tael))))
                          tael)
                         tael))))
                 tael)
                tael)))))
      (begin
        (assert (nil? nil))
        (begin
          (assert (li? (li 1 (li 2 (li 3 nil)))))
          (begin
            (assert-not (li? nil))
            (begin
              (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
              (begin
                (assert-equal (li-tail (li 1 nil)) nil)
                (begin
                  (assert-equal (li-head (li 1 nil)) 1)
                  (let ((list (li 1 (li 2 (li 3 nil)))))
                    (begin
                      (assert-equal (li-head list) 1)
                      (begin
                        (li-put-head! 111 list)
                        (begin
                          (assert-equal (li-head list) 111)
                          (begin
                            (assert-equal
                              (li-tail list)
                              (li 2 (li 3 nil)))
                            (begin
                              (li-put-tail! nil list)
                              (begin
                                (assert-equal
                                  (li-tail list)
                                  nil)
                                (assert-equal
                                  (li 1 nil)
                                  ((li 1) nil))))))))))))))))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; UniquifyPass

(import-all "my-list")

(define (main)
  (begin
    (assert-equal nil #nil)
    (begin
      (assert-equal
        (li 1 (li 2 (li 3 nil)))
        (let ((tael₁ (make-list)))
          (begin
            (list-push! #li tael₁)
            (begin
              (list-push! 1 tael₁)
              (begin
                (list-push!
                 (let ((tael₂ (make-list)))
                   (begin
                     (list-push! #li tael₂)
                     (begin
                       (list-push! 2 tael₂)
                       (begin
                         (list-push!
                          (let ((tael₃ (make-list)))
                            (begin
                              (list-push! #li tael₃)
                              (begin
                                (list-push! 3 tael₃)
                                (begin
                                  (list-push! #nil tael₃)
                                  tael₃))))
                          tael₂)
                         tael₂))))
                 tael₁)
                tael₁)))))
      (begin
        (assert (nil? nil))
        (begin
          (assert (li? (li 1 (li 2 (li 3 nil)))))
          (begin
            (assert-not (li? nil))
            (begin
              (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
              (begin
                (assert-equal (li-tail (li 1 nil)) nil)
                (begin
                  (assert-equal (li-head (li 1 nil)) 1)
                  (let ((list₁ (li 1 (li 2 (li 3 nil)))))
                    (begin
                      (assert-equal (li-head list₁) 1)
                      (begin
                        (li-put-head! 111 list₁)
                        (begin
                          (assert-equal (li-head list₁) 111)
                          (begin
                            (assert-equal
                              (li-tail list₁)
                              (li 2 (li 3 nil)))
                            (begin
                              (li-put-tail! nil list₁)
                              (begin
                                (assert-equal
                                  (li-tail list₁)
                                  nil)
                                (assert-equal
                                  (li 1 nil)
                                  ((li 1) nil))))))))))))))))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; RevealGlobalPass

(import-all "my-list")

(define (main)
  (begin
    (assert-equal nil #nil)
    (begin
      (assert-equal
        (li 1 (li 2 (li 3 nil)))
        (let ((tael₁ (make-list)))
          (begin
            (list-push! #li tael₁)
            (begin
              (list-push! 1 tael₁)
              (begin
                (list-push!
                 (let ((tael₂ (make-list)))
                   (begin
                     (list-push! #li tael₂)
                     (begin
                       (list-push! 2 tael₂)
                       (begin
                         (list-push!
                          (let ((tael₃ (make-list)))
                            (begin
                              (list-push! #li tael₃)
                              (begin
                                (list-push! 3 tael₃)
                                (begin
                                  (list-push! #nil tael₃)
                                  tael₃))))
                          tael₂)
                         tael₂))))
                 tael₁)
                tael₁)))))
      (begin
        (assert (nil? nil))
        (begin
          (assert (li? (li 1 (li 2 (li 3 nil)))))
          (begin
            (assert-not (li? nil))
            (begin
              (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
              (begin
                (assert-equal (li-tail (li 1 nil)) nil)
                (begin
                  (assert-equal (li-head (li 1 nil)) 1)
                  (let ((list₁ (li 1 (li 2 (li 3 nil)))))
                    (begin
                      (assert-equal (li-head list₁) 1)
                      (begin
                        (li-put-head! 111 list₁)
                        (begin
                          (assert-equal (li-head list₁) 111)
                          (begin
                            (assert-equal
                              (li-tail list₁)
                              (li 2 (li 3 nil)))
                            (begin
                              (li-put-tail! nil list₁)
                              (begin
                                (assert-equal
                                  (li-tail list₁)
                                  nil)
                                (assert-equal
                                  (li 1 nil)
                                  ((li 1) nil))))))))))))))))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; LiftLambdaPass

(import-all "my-list")

(define (main)
  (begin
    (assert-equal nil #nil)
    (begin
      (assert-equal
        (li 1 (li 2 (li 3 nil)))
        (let ((tael₁ (make-list)))
          (begin
            (list-push! #li tael₁)
            (begin
              (list-push! 1 tael₁)
              (begin
                (list-push!
                 (let ((tael₂ (make-list)))
                   (begin
                     (list-push! #li tael₂)
                     (begin
                       (list-push! 2 tael₂)
                       (begin
                         (list-push!
                          (let ((tael₃ (make-list)))
                            (begin
                              (list-push! #li tael₃)
                              (begin
                                (list-push! 3 tael₃)
                                (begin
                                  (list-push! #nil tael₃)
                                  tael₃))))
                          tael₂)
                         tael₂))))
                 tael₁)
                tael₁)))))
      (begin
        (assert (nil? nil))
        (begin
          (assert (li? (li 1 (li 2 (li 3 nil)))))
          (begin
            (assert-not (li? nil))
            (begin
              (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
              (begin
                (assert-equal (li-tail (li 1 nil)) nil)
                (begin
                  (assert-equal (li-head (li 1 nil)) 1)
                  (let ((list₁ (li 1 (li 2 (li 3 nil)))))
                    (begin
                      (assert-equal (li-head list₁) 1)
                      (begin
                        (li-put-head! 111 list₁)
                        (begin
                          (assert-equal (li-head list₁) 111)
                          (begin
                            (assert-equal
                              (li-tail list₁)
                              (li 2 (li 3 nil)))
                            (begin
                              (li-put-tail! nil list₁)
                              (begin
                                (assert-equal
                                  (li-tail list₁)
                                  nil)
                                (assert-equal
                                  (li 1 nil)
                                  ((li 1) nil))))))))))))))))))

;;; UnnestOperandPass

(import-all "my-list")

(define (main)
  (begin
    (let ((_₁ nil)) (assert-equal _₁ #nil))
    (begin
      (let ((_₂ nil))
        (let ((_₃ (li 3 _₂)))
          (let ((_₄ (li 2 _₃)))
            (let ((_₅ (li 1 _₄)))
              (let ((tael₁ (make-list)))
                (begin
                  (list-push! #li tael₁)
                  (begin
                    (list-push! 1 tael₁)
                    (begin
                      (let ((tael₂ (make-list)))
                        (begin
                          (list-push! #li tael₂)
                          (begin
                            (list-push! 2 tael₂)
                            (begin
                              (let ((tael₃ (make-list)))
                                (begin
                                  (list-push! #li tael₃)
                                  (begin
                                    (list-push! 3 tael₃)
                                    (begin
                                      (list-push! #nil tael₃)
                                      (list-push!
                                       tael₃
                                       tael₂)))))
                              (list-push! tael₂ tael₁)))))
                      (assert-equal _₅ tael₁)))))))))
      (begin
        (let ((_₆ nil)) (let ((_₇ (nil? _₆))) (assert _₇)))
        (begin
          (let ((_₈ nil))
            (let ((_₉ (li 3 _₈)))
              (let ((_₁₀ (li 2 _₉)))
                (let ((_₁₁ (li 1 _₁₀)))
                  (let ((_₁₂ (li? _₁₁))) (assert _₁₂))))))
          (begin
            (let ((_₁₃ nil))
              (let ((_₁₄ (li? _₁₃))) (assert-not _₁₄)))
            (begin
              (let ((_₁₅ nil))
                (let ((_₁₆ (li 3 _₁₅)))
                  (let ((_₁₇ (li 2 _₁₆)))
                    (let ((_₁₈ (li 1 _₁₇)))
                      (let ((_₁₉ (nil? _₁₈)))
                        (assert-not _₁₉))))))
              (begin
                (let ((_₂₀ nil))
                  (let ((_₂₁ (li 1 _₂₀)))
                    (let ((_₂₂ (li-tail _₂₁)))
                      (let ((_₂₃ nil))
                        (assert-equal _₂₂ _₂₃)))))
                (begin
                  (let ((_₂₄ nil))
                    (let ((_₂₅ (li 1 _₂₄)))
                      (let ((_₂₆ (li-head _₂₅)))
                        (assert-equal _₂₆ 1))))
                  (let
                      ((list₁
                        (let ((_₂₇ nil))
                          (let ((_₂₈ (li 3 _₂₇)))
                            (let ((_₂₉ (li 2 _₂₈)))
                              (li 1 _₂₉))))))
                    (begin
                      (let ((_₃₀ (li-head list₁)))
                        (assert-equal _₃₀ 1))
                      (begin
                        (li-put-head! 111 list₁)
                        (begin
                          (let ((_₃₁ (li-head list₁)))
                            (assert-equal _₃₁ 111))
                          (begin
                            (let ((_₃₂ (li-tail list₁)))
                              (let ((_₃₃ nil))
                                (let ((_₃₄ (li 3 _₃₃)))
                                  (let ((_₃₅ (li 2 _₃₄)))
                                    (assert-equal _₃₂ _₃₅)))))
                            (begin
                              (let ((_₃₆ nil))
                                (li-put-tail! _₃₆ list₁))
                              (begin
                                (let ((_₃₇ (li-tail list₁)))
                                  (let ((_₃₈ nil))
                                    (assert-equal _₃₇ _₃₈)))
                                (let ((_₃₉ nil))
                                  (let ((_₄₀ (li 1 _₃₉)))
                                    (let ((_₄₁ (li 1)))
                                      (let ((_₄₂ nil))
                                        (let
                                            ((_₄₃ (_₄₁ _₄₂)))
                                          (assert-equal
                                            _₄₀
                                            _₄₃))))))))))))))))))))))

