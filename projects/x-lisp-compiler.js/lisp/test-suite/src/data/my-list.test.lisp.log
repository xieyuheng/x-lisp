;;; Input

(import-all "my-list")

(define (main)
  (assert-equal nil #nil)
  (assert-equal
    (li 1 (li 2 (li 3 nil)))
    [#li 1 [#li 2 [#li 3 #nil]]])
  (assert (nil? nil))
  (assert (li? (li 1 (li 2 (li 3 nil)))))
  (assert-not (li? nil))
  (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
  (assert-equal (li-tail (li 1 nil)) nil)
  (assert-equal (li-head (li 1 nil)) 1)
  (= list (li 1 (li 2 (li 3 nil))))
  (assert-equal (li-head list) 1)
  (li-put-head! 111 list)
  (assert-equal (li-head list) 111)
  (assert-equal (li-tail list) (li 2 (li 3 nil)))
  (li-put-tail! nil list)
  (assert-equal (li-tail list) nil)
  (assert (my-list? int? nil))
  (assert (my-list? int? (li 1 (li 2 (li 3 nil)))))
  (assert (my-list? symbol? nil))
  (assert-not (my-list? symbol? (li 1 (li 2 (li 3 nil)))))
  (assert-not (my-list? int? 1))
  (assert-not (my-list? int? 'a))
  (assert-equal (li 1 nil) ((li 1) nil)))

(define (my-list? E value)
  (or (nil? value)
      (and (li? value)
           (E (li-head value))
           ((my-list? E) (li-tail value)))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; ShrinkPass

(import-all "my-list")

(define (main)
  (begin
    (assert-equal nil #nil)
    (assert-equal
      (li 1 (li 2 (li 3 nil)))
      (let ((tael (make-list)))
        (begin
          (list-push! #li tael)
          (list-push! 1 tael)
          (list-push!
           (let ((tael (make-list)))
             (begin
               (list-push! #li tael)
               (list-push! 2 tael)
               (list-push!
                (let ((tael (make-list)))
                  (begin
                    (list-push! #li tael)
                    (list-push! 3 tael)
                    (list-push! #nil tael)
                    tael))
                tael)
               tael))
           tael)
          tael)))
    (assert (nil? nil))
    (assert (li? (li 1 (li 2 (li 3 nil)))))
    (assert-not (li? nil))
    (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
    (assert-equal (li-tail (li 1 nil)) nil)
    (assert-equal (li-head (li 1 nil)) 1)
    (let ((list (li 1 (li 2 (li 3 nil)))))
      (begin
        (assert-equal (li-head list) 1)
        (li-put-head! 111 list)
        (assert-equal (li-head list) 111)
        (assert-equal (li-tail list) (li 2 (li 3 nil)))
        (li-put-tail! nil list)
        (assert-equal (li-tail list) nil)
        (assert (my-list? int? nil))
        (assert (my-list? int? (li 1 (li 2 (li 3 nil)))))
        (assert (my-list? symbol? nil))
        (assert-not
          (my-list? symbol? (li 1 (li 2 (li 3 nil)))))
        (assert-not (my-list? int? 1))
        (assert-not (my-list? int? 'a))
        (assert-equal (li 1 nil) ((li 1) nil))))))

(define (my-list? E value)
  (or (nil? value)
      (and (li? value)
           (E (li-head value))
           ((my-list? E) (li-tail value)))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; UniquifyPass

(import-all "my-list")

(define (main)
  (begin
    (assert-equal nil #nil)
    (assert-equal
      (li 1 (li 2 (li 3 nil)))
      (let ((tael₁ (make-list)))
        (begin
          (list-push! #li tael₁)
          (list-push! 1 tael₁)
          (list-push!
           (let ((tael₂ (make-list)))
             (begin
               (list-push! #li tael₂)
               (list-push! 2 tael₂)
               (list-push!
                (let ((tael₃ (make-list)))
                  (begin
                    (list-push! #li tael₃)
                    (list-push! 3 tael₃)
                    (list-push! #nil tael₃)
                    tael₃))
                tael₂)
               tael₂))
           tael₁)
          tael₁)))
    (assert (nil? nil))
    (assert (li? (li 1 (li 2 (li 3 nil)))))
    (assert-not (li? nil))
    (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
    (assert-equal (li-tail (li 1 nil)) nil)
    (assert-equal (li-head (li 1 nil)) 1)
    (let ((list₁ (li 1 (li 2 (li 3 nil)))))
      (begin
        (assert-equal (li-head list₁) 1)
        (li-put-head! 111 list₁)
        (assert-equal (li-head list₁) 111)
        (assert-equal (li-tail list₁) (li 2 (li 3 nil)))
        (li-put-tail! nil list₁)
        (assert-equal (li-tail list₁) nil)
        (assert (my-list? int? nil))
        (assert (my-list? int? (li 1 (li 2 (li 3 nil)))))
        (assert (my-list? symbol? nil))
        (assert-not
          (my-list? symbol? (li 1 (li 2 (li 3 nil)))))
        (assert-not (my-list? int? 1))
        (assert-not (my-list? int? 'a))
        (assert-equal (li 1 nil) ((li 1) nil))))))

(define (my-list? E value)
  (or (nil? value)
      (and (li? value)
           (E (li-head value))
           ((my-list? E) (li-tail value)))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; RevealGlobalPass

(import-all "my-list")

(define (main)
  (begin
    (assert-equal nil #nil)
    (assert-equal
      (li 1 (li 2 (li 3 nil)))
      (let ((tael₁ (make-list)))
        (begin
          (list-push! #li tael₁)
          (list-push! 1 tael₁)
          (list-push!
           (let ((tael₂ (make-list)))
             (begin
               (list-push! #li tael₂)
               (list-push! 2 tael₂)
               (list-push!
                (let ((tael₃ (make-list)))
                  (begin
                    (list-push! #li tael₃)
                    (list-push! 3 tael₃)
                    (list-push! #nil tael₃)
                    tael₃))
                tael₂)
               tael₂))
           tael₁)
          tael₁)))
    (assert (nil? nil))
    (assert (li? (li 1 (li 2 (li 3 nil)))))
    (assert-not (li? nil))
    (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
    (assert-equal (li-tail (li 1 nil)) nil)
    (assert-equal (li-head (li 1 nil)) 1)
    (let ((list₁ (li 1 (li 2 (li 3 nil)))))
      (begin
        (assert-equal (li-head list₁) 1)
        (li-put-head! 111 list₁)
        (assert-equal (li-head list₁) 111)
        (assert-equal (li-tail list₁) (li 2 (li 3 nil)))
        (li-put-tail! nil list₁)
        (assert-equal (li-tail list₁) nil)
        (assert (my-list? int? nil))
        (assert (my-list? int? (li 1 (li 2 (li 3 nil)))))
        (assert (my-list? symbol? nil))
        (assert-not
          (my-list? symbol? (li 1 (li 2 (li 3 nil)))))
        (assert-not (my-list? int? 1))
        (assert-not (my-list? int? 'a))
        (assert-equal (li 1 nil) ((li 1) nil))))))

(define (my-list? E value)
  (or (nil? value)
      (and (li? value)
           (E (li-head value))
           ((my-list? E) (li-tail value)))))

(define nil #nil)

(define (nil? value) (equal? value #nil))

(define (li head tail) [#li head tail])

(define (li? value)
  (and (any-list? value)
       (equal? (list-length value) 3)
       (equal? (list-head value) #li)))

(define (li-head target) (list-get 1 target))

(define (li-tail target) (list-get 2 target))

(define (li-put-head value target)
  (list-put 1 value target))

(define (li-put-tail value target)
  (list-put 2 value target))

(define (li-put-head! value target)
  (list-put! 1 value target))

(define (li-put-tail! value target)
  (list-put! 2 value target))

;;; LiftLambdaPass

(import-all "my-list")

(define (main)
  (begin
    (assert-equal nil #nil)
    (assert-equal
      (li 1 (li 2 (li 3 nil)))
      (let ((tael₁ (make-list)))
        (begin
          (list-push! #li tael₁)
          (list-push! 1 tael₁)
          (list-push!
           (let ((tael₂ (make-list)))
             (begin
               (list-push! #li tael₂)
               (list-push! 2 tael₂)
               (list-push!
                (let ((tael₃ (make-list)))
                  (begin
                    (list-push! #li tael₃)
                    (list-push! 3 tael₃)
                    (list-push! #nil tael₃)
                    tael₃))
                tael₂)
               tael₂))
           tael₁)
          tael₁)))
    (assert (nil? nil))
    (assert (li? (li 1 (li 2 (li 3 nil)))))
    (assert-not (li? nil))
    (assert-not (nil? (li 1 (li 2 (li 3 nil)))))
    (assert-equal (li-tail (li 1 nil)) nil)
    (assert-equal (li-head (li 1 nil)) 1)
    (let ((list₁ (li 1 (li 2 (li 3 nil)))))
      (begin
        (assert-equal (li-head list₁) 1)
        (li-put-head! 111 list₁)
        (assert-equal (li-head list₁) 111)
        (assert-equal (li-tail list₁) (li 2 (li 3 nil)))
        (li-put-tail! nil list₁)
        (assert-equal (li-tail list₁) nil)
        (assert (my-list? int? nil))
        (assert (my-list? int? (li 1 (li 2 (li 3 nil)))))
        (assert (my-list? symbol? nil))
        (assert-not
          (my-list? symbol? (li 1 (li 2 (li 3 nil)))))
        (assert-not (my-list? int? 1))
        (assert-not (my-list? int? 'a))
        (assert-equal (li 1 nil) ((li 1) nil))))))

;;; UnnestOperandPass

(import-all "my-list")

(define (main)
  (begin
    (let ((_₁ nil)) (assert-equal _₁ #nil))
    (let ((_₂ nil))
      (let ((_₃ (li 3 _₂)))
        (let ((_₄ (li 2 _₃)))
          (let ((_₅ (li 1 _₄)))
            (let ((tael₁ (make-list)))
              (begin
                (list-push! #li tael₁)
                (list-push! 1 tael₁)
                (let ((tael₂ (make-list)))
                  (begin
                    (list-push! #li tael₂)
                    (list-push! 2 tael₂)
                    (let ((tael₃ (make-list)))
                      (begin
                        (list-push! #li tael₃)
                        (list-push! 3 tael₃)
                        (list-push! #nil tael₃)
                        (list-push! tael₃ tael₂)))
                    (list-push! tael₂ tael₁)))
                (assert-equal _₅ tael₁)))))))
    (let ((_₆ nil)) (let ((_₇ (nil? _₆))) (assert _₇)))
    (let ((_₈ nil))
      (let ((_₉ (li 3 _₈)))
        (let ((_₁₀ (li 2 _₉)))
          (let ((_₁₁ (li 1 _₁₀)))
            (let ((_₁₂ (li? _₁₁))) (assert _₁₂))))))
    (let ((_₁₃ nil))
      (let ((_₁₄ (li? _₁₃))) (assert-not _₁₄)))
    (let ((_₁₅ nil))
      (let ((_₁₆ (li 3 _₁₅)))
        (let ((_₁₇ (li 2 _₁₆)))
          (let ((_₁₈ (li 1 _₁₇)))
            (let ((_₁₉ (nil? _₁₈))) (assert-not _₁₉))))))
    (let ((_₂₀ nil))
      (let ((_₂₁ (li 1 _₂₀)))
        (let ((_₂₂ (li-tail _₂₁)))
          (let ((_₂₃ nil)) (assert-equal _₂₂ _₂₃)))))
    (let ((_₂₄ nil))
      (let ((_₂₅ (li 1 _₂₄)))
        (let ((_₂₆ (li-head _₂₅))) (assert-equal _₂₆ 1))))
    (let
        ((list₁
          (let ((_₂₇ nil))
            (let ((_₂₈ (li 3 _₂₇)))
              (let ((_₂₉ (li 2 _₂₈))) (li 1 _₂₉))))))
      (begin
        (let ((_₃₀ (li-head list₁))) (assert-equal _₃₀ 1))
        (li-put-head! 111 list₁)
        (let ((_₃₁ (li-head list₁))) (assert-equal _₃₁ 111))
        (let ((_₃₂ (li-tail list₁)))
          (let ((_₃₃ nil))
            (let ((_₃₄ (li 3 _₃₃)))
              (let ((_₃₅ (li 2 _₃₄)))
                (assert-equal _₃₂ _₃₅)))))
        (let ((_₃₆ nil)) (li-put-tail! _₃₆ list₁))
        (let ((_₃₇ (li-tail list₁)))
          (let ((_₃₈ nil)) (assert-equal _₃₇ _₃₈)))
        (let ((_₃₉ nil))
          (let ((_₄₀ (my-list? int? _₃₉))) (assert _₄₀)))
        (let ((_₄₁ nil))
          (let ((_₄₂ (li 3 _₄₁)))
            (let ((_₄₃ (li 2 _₄₂)))
              (let ((_₄₄ (li 1 _₄₃)))
                (let ((_₄₅ (my-list? int? _₄₄)))
                  (assert _₄₅))))))
        (let ((_₄₆ nil))
          (let ((_₄₇ (my-list? symbol? _₄₆))) (assert _₄₇)))
        (let ((_₄₈ nil))
          (let ((_₄₉ (li 3 _₄₈)))
            (let ((_₅₀ (li 2 _₄₉)))
              (let ((_₅₁ (li 1 _₅₀)))
                (let ((_₅₂ (my-list? symbol? _₅₁)))
                  (assert-not _₅₂))))))
        (let ((_₅₃ (my-list? int? 1))) (assert-not _₅₃))
        (let ((_₅₄ (my-list? int? 'a))) (assert-not _₅₄))
        (let ((_₅₅ nil))
          (let ((_₅₆ (li 1 _₅₅)))
            (let ((_₅₇ (li 1)))
              (let ((_₅₈ nil))
                (let ((_₅₉ (_₅₇ _₅₈)))
                  (assert-equal _₅₆ _₅₉))))))))))

