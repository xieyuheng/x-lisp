;;; Input

(define (main)
  (println '(:x a :y b))
  (println [:x 'a :y 'b])
  (println [:x 'a :y 'b])
  (println [:x 'a :y 'b]))

;;; ShrinkPass

(define (main)
  (@begin1
      (println
       (@let1 tael (make-list)
         (@begin1 (record-put! 'x 'a tael)
           (@begin1 (record-put! 'y 'b tael) tael))))
    (@begin1
        (println
         (@let1 tael (make-list)
           (@begin1 (record-put! 'x 'a tael)
             (@begin1 (record-put! 'y 'b tael) tael))))
      (@begin1
          (println
           (@let1 tael (make-list)
             (@begin1 (record-put! 'x 'a tael)
               (@begin1 (record-put! 'y 'b tael) tael))))
        (println
         (@let1 tael (make-list)
           (@begin1 (record-put! 'x 'a tael)
             (@begin1 (record-put! 'y 'b tael) tael))))))))

;;; UniquifyPass

(define (main)
  (@begin1
      (println
       (@let1 tael₁ (make-list)
         (@begin1 (record-put! 'x 'a tael₁)
           (@begin1 (record-put! 'y 'b tael₁) tael₁))))
    (@begin1
        (println
         (@let1 tael₁ (make-list)
           (@begin1 (record-put! 'x 'a tael₁)
             (@begin1 (record-put! 'y 'b tael₁) tael₁))))
      (@begin1
          (println
           (@let1 tael₁ (make-list)
             (@begin1 (record-put! 'x 'a tael₁)
               (@begin1 (record-put! 'y 'b tael₁) tael₁))))
        (println
         (@let1 tael₁ (make-list)
           (@begin1 (record-put! 'x 'a tael₁)
             (@begin1 (record-put! 'y 'b tael₁) tael₁))))))))

;;; RevealGlobalPass

(define (main)
  (@begin1
      ((@primitive-function-ref println 1)
       (@let1 tael₁ ((@primitive-function-ref make-list 0))
         (@begin1
             ((@primitive-function-ref record-put! 3)
              'x
              'a
              tael₁)
           (@begin1
               ((@primitive-function-ref record-put! 3)
                'y
                'b
                tael₁)
             tael₁))))
    (@begin1
        ((@primitive-function-ref println 1)
         (@let1 tael₁
             ((@primitive-function-ref make-list 0))
           (@begin1
               ((@primitive-function-ref record-put! 3)
                'x
                'a
                tael₁)
             (@begin1
                 ((@primitive-function-ref record-put! 3)
                  'y
                  'b
                  tael₁)
               tael₁))))
      (@begin1
          ((@primitive-function-ref println 1)
           (@let1 tael₁
               ((@primitive-function-ref make-list 0))
             (@begin1
                 ((@primitive-function-ref record-put! 3)
                  'x
                  'a
                  tael₁)
               (@begin1
                   ((@primitive-function-ref record-put! 3)
                    'y
                    'b
                    tael₁)
                 tael₁))))
        ((@primitive-function-ref println 1)
         (@let1 tael₁
             ((@primitive-function-ref make-list 0))
           (@begin1
               ((@primitive-function-ref record-put! 3)
                'x
                'a
                tael₁)
             (@begin1
                 ((@primitive-function-ref record-put! 3)
                  'y
                  'b
                  tael₁)
               tael₁))))))))

;;; LiftLambdaPass

(define (main)
  (@begin1
      ((@primitive-function-ref println 1)
       (@let1 tael₁ ((@primitive-function-ref make-list 0))
         (@begin1
             ((@primitive-function-ref record-put! 3)
              'x
              'a
              tael₁)
           (@begin1
               ((@primitive-function-ref record-put! 3)
                'y
                'b
                tael₁)
             tael₁))))
    (@begin1
        ((@primitive-function-ref println 1)
         (@let1 tael₁
             ((@primitive-function-ref make-list 0))
           (@begin1
               ((@primitive-function-ref record-put! 3)
                'x
                'a
                tael₁)
             (@begin1
                 ((@primitive-function-ref record-put! 3)
                  'y
                  'b
                  tael₁)
               tael₁))))
      (@begin1
          ((@primitive-function-ref println 1)
           (@let1 tael₁
               ((@primitive-function-ref make-list 0))
             (@begin1
                 ((@primitive-function-ref record-put! 3)
                  'x
                  'a
                  tael₁)
               (@begin1
                   ((@primitive-function-ref record-put! 3)
                    'y
                    'b
                    tael₁)
                 tael₁))))
        ((@primitive-function-ref println 1)
         (@let1 tael₁
             ((@primitive-function-ref make-list 0))
           (@begin1
               ((@primitive-function-ref record-put! 3)
                'x
                'a
                tael₁)
             (@begin1
                 ((@primitive-function-ref record-put! 3)
                  'y
                  'b
                  tael₁)
               tael₁))))))))

