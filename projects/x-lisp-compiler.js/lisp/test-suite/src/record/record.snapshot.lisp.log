;;; Input

(define (main)
  (println '(:x a :y b))
  (println [:x 'a :y 'b])
  (println [:x 'a :y 'b])
  (println [:x 'a :y 'b]))

;;; ShrinkPass

(define (main)
  (begin
    (println
     (let ((tael (make-list)))
       (begin
         (record-put! 'x 'a tael)
         (begin (record-put! 'y 'b tael) tael))))
    (begin
      (println
       (let ((tael (make-list)))
         (begin
           (record-put! 'x 'a tael)
           (begin (record-put! 'y 'b tael) tael))))
      (begin
        (println
         (let ((tael (make-list)))
           (begin
             (record-put! 'x 'a tael)
             (begin (record-put! 'y 'b tael) tael))))
        (println
         (let ((tael (make-list)))
           (begin
             (record-put! 'x 'a tael)
             (begin (record-put! 'y 'b tael) tael))))))))

;;; UniquifyPass

(define (main)
  (begin
    (println
     (let ((tael₁ (make-list)))
       (begin
         (record-put! 'x 'a tael₁)
         (begin (record-put! 'y 'b tael₁) tael₁))))
    (begin
      (println
       (let ((tael₁ (make-list)))
         (begin
           (record-put! 'x 'a tael₁)
           (begin (record-put! 'y 'b tael₁) tael₁))))
      (begin
        (println
         (let ((tael₁ (make-list)))
           (begin
             (record-put! 'x 'a tael₁)
             (begin (record-put! 'y 'b tael₁) tael₁))))
        (println
         (let ((tael₁ (make-list)))
           (begin
             (record-put! 'x 'a tael₁)
             (begin (record-put! 'y 'b tael₁) tael₁))))))))

;;; RevealGlobalPass

(define (main)
  (begin
    ((@primitive println 1)
     (let ((tael₁ ((@primitive make-list 0))))
       (begin
         ((@primitive record-put! 3) 'x 'a tael₁)
         (begin ((@primitive record-put! 3) 'y 'b tael₁) tael₁))))
    (begin
      ((@primitive println 1)
       (let ((tael₁ ((@primitive make-list 0))))
         (begin
           ((@primitive record-put! 3) 'x 'a tael₁)
           (begin
             ((@primitive record-put! 3) 'y 'b tael₁)
             tael₁))))
      (begin
        ((@primitive println 1)
         (let ((tael₁ ((@primitive make-list 0))))
           (begin
             ((@primitive record-put! 3) 'x 'a tael₁)
             (begin
               ((@primitive record-put! 3) 'y 'b tael₁)
               tael₁))))
        ((@primitive println 1)
         (let ((tael₁ ((@primitive make-list 0))))
           (begin
             ((@primitive record-put! 3) 'x 'a tael₁)
             (begin
               ((@primitive record-put! 3) 'y 'b tael₁)
               tael₁))))))))

;;; LiftLambdaPass

(define (main)
  (begin
    ((@primitive println 1)
     (let ((tael₁ ((@primitive make-list 0))))
       (begin
         ((@primitive record-put! 3) 'x 'a tael₁)
         (begin ((@primitive record-put! 3) 'y 'b tael₁) tael₁))))
    (begin
      ((@primitive println 1)
       (let ((tael₁ ((@primitive make-list 0))))
         (begin
           ((@primitive record-put! 3) 'x 'a tael₁)
           (begin
             ((@primitive record-put! 3) 'y 'b tael₁)
             tael₁))))
      (begin
        ((@primitive println 1)
         (let ((tael₁ ((@primitive make-list 0))))
           (begin
             ((@primitive record-put! 3) 'x 'a tael₁)
             (begin
               ((@primitive record-put! 3) 'y 'b tael₁)
               tael₁))))
        ((@primitive println 1)
         (let ((tael₁ ((@primitive make-list 0))))
           (begin
             ((@primitive record-put! 3) 'x 'a tael₁)
             (begin
               ((@primitive record-put! 3) 'y 'b tael₁)
               tael₁))))))))

;;; UnnestOperandPass

(define (main)
  (begin
    (let ((tael₁ ((@primitive make-list 0))))
      (begin
        ((@primitive record-put! 3) 'x 'a tael₁)
        (begin
          ((@primitive record-put! 3) 'y 'b tael₁)
          ((@primitive println 1) tael₁))))
    (begin
      (let ((tael₁ ((@primitive make-list 0))))
        (begin
          ((@primitive record-put! 3) 'x 'a tael₁)
          (begin
            ((@primitive record-put! 3) 'y 'b tael₁)
            ((@primitive println 1) tael₁))))
      (begin
        (let ((tael₁ ((@primitive make-list 0))))
          (begin
            ((@primitive record-put! 3) 'x 'a tael₁)
            (begin
              ((@primitive record-put! 3) 'y 'b tael₁)
              ((@primitive println 1) tael₁))))
        (let ((tael₁ ((@primitive make-list 0))))
          (begin
            ((@primitive record-put! 3) 'x 'a tael₁)
            (begin
              ((@primitive record-put! 3) 'y 'b tael₁)
              ((@primitive println 1) tael₁))))))))

