;;; Input

(define (main) (assert-equal [:x 'a :y 'b] '(:x a :y b)))

;;; ShrinkPass

(define (main)
  (assert-equal
    (@let1 tael (make-list)
      (@begin1 (record-put! 'x 'a tael)
        (@begin1 (record-put! 'y 'b tael) tael)))
    (@let1 tael (make-list)
      (@begin1 (record-put! 'x 'a tael)
        (@begin1 (record-put! 'y 'b tael) tael)))))

;;; UniquifyPass

(define (main)
  (assert-equal
    (@let1 tael₁ (make-list)
      (@begin1 (record-put! 'x 'a tael₁)
        (@begin1 (record-put! 'y 'b tael₁) tael₁)))
    (@let1 tael₁ (make-list)
      (@begin1 (record-put! 'x 'a tael₁)
        (@begin1 (record-put! 'y 'b tael₁) tael₁)))))

;;; RevealGlobalPass

(define (main)
  (assert-equal
    (@let1 tael₁ ((@primitive-function-ref make-list 0))
      (@begin1
          ((@primitive-function-ref record-put! 3)
           'x
           'a
           tael₁)
        (@begin1
            ((@primitive-function-ref record-put! 3)
             'y
             'b
             tael₁)
          tael₁)))
    (@let1 tael₁ ((@primitive-function-ref make-list 0))
      (@begin1
          ((@primitive-function-ref record-put! 3)
           'x
           'a
           tael₁)
        (@begin1
            ((@primitive-function-ref record-put! 3)
             'y
             'b
             tael₁)
          tael₁)))))

;;; LiftLambdaPass

(define (main)
  (assert-equal
    (@let1 tael₁ ((@primitive-function-ref make-list 0))
      (@begin1
          ((@primitive-function-ref record-put! 3)
           'x
           'a
           tael₁)
        (@begin1
            ((@primitive-function-ref record-put! 3)
             'y
             'b
             tael₁)
          tael₁)))
    (@let1 tael₁ ((@primitive-function-ref make-list 0))
      (@begin1
          ((@primitive-function-ref record-put! 3)
           'x
           'a
           tael₁)
        (@begin1
            ((@primitive-function-ref record-put! 3)
             'y
             'b
             tael₁)
          tael₁)))))

;;; UnnestOperandPass

(define (main)
  (assert-equal
    (@let1 tael₁ ((@primitive-function-ref make-list 0))
      (@begin1
          ((@primitive-function-ref record-put! 3)
           'x
           'a
           tael₁)
        (@begin1
            ((@primitive-function-ref record-put! 3)
             'y
             'b
             tael₁)
          tael₁)))
    (@let1 tael₁ ((@primitive-function-ref make-list 0))
      (@begin1
          ((@primitive-function-ref record-put! 3)
           'x
           'a
           tael₁)
        (@begin1
            ((@primitive-function-ref record-put! 3)
             'y
             'b
             tael₁)
          tael₁)))))

