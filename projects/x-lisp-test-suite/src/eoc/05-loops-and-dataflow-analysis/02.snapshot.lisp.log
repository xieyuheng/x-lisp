;;; Input

(define (main)
  (println-non-void
   (begin
     (= x
        (begin
          (print 1)
          (newline)
          (print 2)
          (newline)
          (print 3)
          (newline)
          6))
     (begin
       (print 4)
       (newline)
       (print 5)
       (newline)
       (print 6)
       (newline)
       (iadd x x)))))

;;; ShrinkPass

(define (main)
  (println-non-void
   (@let1 x
       (@let1 _∅ (print 1)
         (@let1 _∅ (newline)
           (@let1 _∅ (print 2)
             (@let1 _∅ (newline)
               (@let1 _∅ (print 3) (@let1 _∅ (newline) 6))))))
     (@let1 _∅ (print 4)
       (@let1 _∅ (newline)
         (@let1 _∅ (print 5)
           (@let1 _∅ (newline)
             (@let1 _∅ (print 6)
               (@let1 _∅ (newline) ((iadd x) x))))))))))

;;; UniquifyPass

(define (main)
  (println-non-void
   (@let1 x₁
       (@let1 _∅₁ (print 1)
         (@let1 _∅₂ (newline)
           (@let1 _∅₃ (print 2)
             (@let1 _∅₄ (newline)
               (@let1 _∅₅ (print 3) (@let1 _∅₆ (newline) 6))))))
     (@let1 _∅₁ (print 4)
       (@let1 _∅₂ (newline)
         (@let1 _∅₃ (print 5)
           (@let1 _∅₄ (newline)
             (@let1 _∅₅ (print 6)
               (@let1 _∅₆ (newline) ((iadd x₁) x₁))))))))))

;;; RevealGlobalPass

(define (main)
  ((@primitive-function println-non-void 1)
   (@let1 x₁
       (@let1 _∅₁ ((@primitive-function print 1) 1)
         (@let1 _∅₂ ((@primitive-function newline 0))
           (@let1 _∅₃ ((@primitive-function print 1) 2)
             (@let1 _∅₄ ((@primitive-function newline 0))
               (@let1 _∅₅ ((@primitive-function print 1) 3)
                 (@let1 _∅₆
                     ((@primitive-function newline 0))
                   6))))))
     (@let1 _∅₁ ((@primitive-function print 1) 4)
       (@let1 _∅₂ ((@primitive-function newline 0))
         (@let1 _∅₃ ((@primitive-function print 1) 5)
           (@let1 _∅₄ ((@primitive-function newline 0))
             (@let1 _∅₅ ((@primitive-function print 1) 6)
               (@let1 _∅₆ ((@primitive-function newline 0))
                 (((@primitive-function iadd 2) x₁) x₁))))))))))

;;; LiftLambdaPass

(define (main)
  ((@primitive-function println-non-void 1)
   (@let1 x₁
       (@let1 _∅₁ ((@primitive-function print 1) 1)
         (@let1 _∅₂ ((@primitive-function newline 0))
           (@let1 _∅₃ ((@primitive-function print 1) 2)
             (@let1 _∅₄ ((@primitive-function newline 0))
               (@let1 _∅₅ ((@primitive-function print 1) 3)
                 (@let1 _∅₆
                     ((@primitive-function newline 0))
                   6))))))
     (@let1 _∅₁ ((@primitive-function print 1) 4)
       (@let1 _∅₂ ((@primitive-function newline 0))
         (@let1 _∅₃ ((@primitive-function print 1) 5)
           (@let1 _∅₄ ((@primitive-function newline 0))
             (@let1 _∅₅ ((@primitive-function print 1) 6)
               (@let1 _∅₆ ((@primitive-function newline 0))
                 (((@primitive-function iadd 2) x₁) x₁))))))))))

;;; UnnestOperandPass

(define (main)
  (@let1 _₁ (@primitive-function println-non-void 1)
    (@let1 x₁
        (@let1 _∅₁
            (@let1 _₂ (@primitive-function print 1)
              (@let1 _₃ 1 (_₂ _₃)))
          (@let1 _∅₂
              (@let1 _₄ (@primitive-function newline 0)
                (_₄))
            (@let1 _∅₃
                (@let1 _₅ (@primitive-function print 1)
                  (@let1 _₆ 2 (_₅ _₆)))
              (@let1 _∅₄
                  (@let1 _₇ (@primitive-function newline 0)
                    (_₇))
                (@let1 _∅₅
                    (@let1 _₈ (@primitive-function print 1)
                      (@let1 _₉ 3 (_₈ _₉)))
                  (@let1 _∅₆
                      (@let1 _₁₀
                          (@primitive-function newline 0)
                        (_₁₀))
                    (@let1 _₁₁ 6 _₁₁)))))))
      (@let1 _∅₁
          (@let1 _₁₂ (@primitive-function print 1)
            (@let1 _₁₃ 4 (_₁₂ _₁₃)))
        (@let1 _∅₂
            (@let1 _₁₄ (@primitive-function newline 0)
              (_₁₄))
          (@let1 _∅₃
              (@let1 _₁₅ (@primitive-function print 1)
                (@let1 _₁₆ 5 (_₁₅ _₁₆)))
            (@let1 _∅₄
                (@let1 _₁₇ (@primitive-function newline 0)
                  (_₁₇))
              (@let1 _∅₅
                  (@let1 _₁₈ (@primitive-function print 1)
                    (@let1 _₁₉ 6 (_₁₈ _₁₉)))
                (@let1 _∅₆
                    (@let1 _₂₀
                        (@primitive-function newline 0)
                      (_₂₀))
                  (@let1 _₂₁ (@primitive-function iadd 2)
                    (@let1 _₂₂ (_₂₁ x₁)
                      (@let1 _₂₃ (_₂₂ x₁) (_₁ _₂₃)))))))))))))

;;; ExplicateControlPass

(define-function main
  (block body
    (= _₁ (const (@primitive-function println-non-void 1)))
    (= _₂ (const (@primitive-function print 1)))
    (= _₃ (const 1))
    (= _∅₁ (apply _₂ _₃))
    (= _₄ (const (@primitive-function newline 0)))
    (= _∅₂ (apply-nullary _₄))
    (= _₅ (const (@primitive-function print 1)))
    (= _₆ (const 2))
    (= _∅₃ (apply _₅ _₆))
    (= _₇ (const (@primitive-function newline 0)))
    (= _∅₄ (apply-nullary _₇))
    (= _₈ (const (@primitive-function print 1)))
    (= _₉ (const 3))
    (= _∅₅ (apply _₈ _₉))
    (= _₁₀ (const (@primitive-function newline 0)))
    (= _∅₆ (apply-nullary _₁₀))
    (= _₁₁ (const 6))
    (= x₁ (call (@primitive-function identity 1) _₁₁))
    (= _₁₂ (const (@primitive-function print 1)))
    (= _₁₃ (const 4))
    (= _∅₁ (apply _₁₂ _₁₃))
    (= _₁₄ (const (@primitive-function newline 0)))
    (= _∅₂ (apply-nullary _₁₄))
    (= _₁₅ (const (@primitive-function print 1)))
    (= _₁₆ (const 5))
    (= _∅₃ (apply _₁₅ _₁₆))
    (= _₁₇ (const (@primitive-function newline 0)))
    (= _∅₄ (apply-nullary _₁₇))
    (= _₁₈ (const (@primitive-function print 1)))
    (= _₁₉ (const 6))
    (= _∅₅ (apply _₁₈ _₁₉))
    (= _₂₀ (const (@primitive-function newline 0)))
    (= _∅₆ (apply-nullary _₂₀))
    (= _₂₁ (const (@primitive-function iadd 2)))
    (= _₂₂ (apply _₂₁ x₁))
    (= _₂₃ (apply _₂₂ x₁))
    (= _↩ (apply _₁ _₂₃))
    (return _↩)))

;;; SelectInstructionPass

(export)

(define-code main
  (block body
    (leaq
     (label-deref (external-label x-println-non-void))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₂))
    (movq (imm 8) (var _₃))
    (movq (var _₂) (reg rdi))
    (movq (var _₃) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _∅₁))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₄))
    (movq (var _₄) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (var _∅₂))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₅))
    (movq (imm 16) (var _₆))
    (movq (var _₅) (reg rdi))
    (movq (var _₆) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _∅₃))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₇))
    (movq (var _₇) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (var _∅₄))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₈))
    (movq (imm 24) (var _₉))
    (movq (var _₈) (reg rdi))
    (movq (var _₉) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _∅₅))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁₀))
    (movq (var _₁₀) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (var _∅₆))
    (movq (imm 48) (var _₁₁))
    (movq (var _₁₁) (reg rdi))
    (callq-n (external-label x-identity) (arity 1))
    (movq (reg rax) (var x₁))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁₂))
    (movq (imm 32) (var _₁₃))
    (movq (var _₁₂) (reg rdi))
    (movq (var _₁₃) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _∅₁))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁₄))
    (movq (var _₁₄) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (var _∅₂))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁₅))
    (movq (imm 40) (var _₁₆))
    (movq (var _₁₅) (reg rdi))
    (movq (var _₁₆) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _∅₃))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁₇))
    (movq (var _₁₇) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (var _∅₄))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁₈))
    (movq (imm 48) (var _₁₉))
    (movq (var _₁₈) (reg rdi))
    (movq (var _₁₉) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _∅₅))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₂₀))
    (movq (var _₂₀) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (var _∅₆))
    (leaq (label-deref (external-label x-iadd)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₂₁))
    (movq (var _₂₁) (reg rdi))
    (movq (var x₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₂₂))
    (movq (var _₂₂) (reg rdi))
    (movq (var x₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₂₃))
    (movq (var _₁) (reg rdi))
    (movq (var _₂₃) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _↩))
    (movq (var _↩) (reg rax))
    (retq)))

;;; AssignHomePass

(export)

(define-code main
  (block body
    (leaq
     (label-deref (external-label x-println-non-void))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (imm 8) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -72) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (imm 16) (reg-deref (reg rbp) -120))
    (movq (reg-deref (reg rbp) -112) (reg rdi))
    (movq (reg-deref (reg rbp) -120) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (movq (reg-deref (reg rbp) -136) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -144))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -152))
    (movq (imm 24) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -152) (reg rdi))
    (movq (reg-deref (reg rbp) -160) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -168))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -176))
    (movq (reg-deref (reg rbp) -176) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -184))
    (movq (imm 48) (reg-deref (reg rbp) -192))
    (movq (reg-deref (reg rbp) -192) (reg rdi))
    (callq-n (external-label x-identity) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -200))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -208))
    (movq (imm 32) (reg-deref (reg rbp) -216))
    (movq (reg-deref (reg rbp) -208) (reg rdi))
    (movq (reg-deref (reg rbp) -216) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -224))
    (movq (reg-deref (reg rbp) -224) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -232))
    (movq (imm 40) (reg-deref (reg rbp) -240))
    (movq (reg-deref (reg rbp) -232) (reg rdi))
    (movq (reg-deref (reg rbp) -240) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -248))
    (movq (reg-deref (reg rbp) -248) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -144))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -256))
    (movq (imm 48) (reg-deref (reg rbp) -264))
    (movq (reg-deref (reg rbp) -256) (reg rdi))
    (movq (reg-deref (reg rbp) -264) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -168))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -272))
    (movq (reg-deref (reg rbp) -272) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -184))
    (leaq (label-deref (external-label x-iadd)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -280))
    (movq (reg-deref (reg rbp) -280) (reg rdi))
    (movq (reg-deref (reg rbp) -200) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -288))
    (movq (reg-deref (reg rbp) -288) (reg rdi))
    (movq (reg-deref (reg rbp) -200) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -296))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -296) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -304))
    (movq (reg-deref (reg rbp) -304) (reg rax))
    (retq)))

;;; PatchInstructionPass

(export)

(define-code main
  (block body
    (leaq
     (label-deref (external-label x-println-non-void))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (imm 8) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -72) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (imm 16) (reg-deref (reg rbp) -120))
    (movq (reg-deref (reg rbp) -112) (reg rdi))
    (movq (reg-deref (reg rbp) -120) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (movq (reg-deref (reg rbp) -136) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -144))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -152))
    (movq (imm 24) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -152) (reg rdi))
    (movq (reg-deref (reg rbp) -160) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -168))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -176))
    (movq (reg-deref (reg rbp) -176) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -184))
    (movq (imm 48) (reg-deref (reg rbp) -192))
    (movq (reg-deref (reg rbp) -192) (reg rdi))
    (callq-n (external-label x-identity) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -200))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -208))
    (movq (imm 32) (reg-deref (reg rbp) -216))
    (movq (reg-deref (reg rbp) -208) (reg rdi))
    (movq (reg-deref (reg rbp) -216) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -224))
    (movq (reg-deref (reg rbp) -224) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -232))
    (movq (imm 40) (reg-deref (reg rbp) -240))
    (movq (reg-deref (reg rbp) -232) (reg rdi))
    (movq (reg-deref (reg rbp) -240) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -248))
    (movq (reg-deref (reg rbp) -248) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -144))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -256))
    (movq (imm 48) (reg-deref (reg rbp) -264))
    (movq (reg-deref (reg rbp) -256) (reg rdi))
    (movq (reg-deref (reg rbp) -264) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -168))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -272))
    (movq (reg-deref (reg rbp) -272) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -184))
    (leaq (label-deref (external-label x-iadd)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -280))
    (movq (reg-deref (reg rbp) -280) (reg rdi))
    (movq (reg-deref (reg rbp) -200) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -288))
    (movq (reg-deref (reg rbp) -288) (reg rdi))
    (movq (reg-deref (reg rbp) -200) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -296))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -296) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -304))
    (movq (reg-deref (reg rbp) -304) (reg rax))
    (retq)))

;;; PrologAndEpilogPass

(export)

(define-code main
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 304) (reg rsp))
    (jmp (label body)))
  (block body
    (leaq
     (label-deref (external-label x-println-non-void))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (imm 8) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -72) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (imm 16) (reg-deref (reg rbp) -120))
    (movq (reg-deref (reg rbp) -112) (reg rdi))
    (movq (reg-deref (reg rbp) -120) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (movq (reg-deref (reg rbp) -136) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -144))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -152))
    (movq (imm 24) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -152) (reg rdi))
    (movq (reg-deref (reg rbp) -160) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -168))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -176))
    (movq (reg-deref (reg rbp) -176) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -184))
    (movq (imm 48) (reg-deref (reg rbp) -192))
    (movq (reg-deref (reg rbp) -192) (reg rdi))
    (callq-n (external-label x-identity) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -200))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -208))
    (movq (imm 32) (reg-deref (reg rbp) -216))
    (movq (reg-deref (reg rbp) -208) (reg rdi))
    (movq (reg-deref (reg rbp) -216) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -224))
    (movq (reg-deref (reg rbp) -224) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -232))
    (movq (imm 40) (reg-deref (reg rbp) -240))
    (movq (reg-deref (reg rbp) -232) (reg rdi))
    (movq (reg-deref (reg rbp) -240) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -248))
    (movq (reg-deref (reg rbp) -248) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -144))
    (leaq (label-deref (external-label x-print)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -256))
    (movq (imm 48) (reg-deref (reg rbp) -264))
    (movq (reg-deref (reg rbp) -256) (reg rdi))
    (movq (reg-deref (reg rbp) -264) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -168))
    (leaq (label-deref (external-label x-newline)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -272))
    (movq (reg-deref (reg rbp) -272) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -184))
    (leaq (label-deref (external-label x-iadd)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -280))
    (movq (reg-deref (reg rbp) -280) (reg rdi))
    (movq (reg-deref (reg rbp) -200) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -288))
    (movq (reg-deref (reg rbp) -288) (reg rdi))
    (movq (reg-deref (reg rbp) -200) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -296))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -296) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -304))
    (movq (reg-deref (reg rbp) -304) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 304) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

