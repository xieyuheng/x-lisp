;;; Input

(define (_main)
  (println-non-void
   (if
       (and (equal? (random-dice) 1)
            (equal? (random-dice) 2))
     0
     42)))

;;; ShrinkPass

(define (_main)
  (println-non-void
   (if
       (if ((equal? (random-dice)) 1)
         ((equal? (random-dice)) 2)
         #f)
     0
     42)))

;;; UniquifyPass

(define (_main)
  (println-non-void
   (if
       (if ((equal? (random-dice)) 1)
         ((equal? (random-dice)) 2)
         #f)
     0
     42)))

;;; RevealGlobalPass

(define (_main)
  ((@primitive-function println-non-void 1)
   (if
       (if
           (((@primitive-function equal? 2)
             ((@primitive-function random-dice 0)))
            1)
         (((@primitive-function equal? 2)
           ((@primitive-function random-dice 0)))
          2)
         #f)
     0
     42)))

;;; LiftLambdaPass

(define (_main)
  ((@primitive-function println-non-void 1)
   (if
       (if
           (((@primitive-function equal? 2)
             ((@primitive-function random-dice 0)))
            1)
         (((@primitive-function equal? 2)
           ((@primitive-function random-dice 0)))
          2)
         #f)
     0
     42)))

;;; UnnestOperandPass

(define (_main)
  (@let1 _₁ (@primitive-function println-non-void 1)
    (@let1 _₂
        (@let1 _₃
            (@let1 _₄ (@primitive-function equal? 2)
              (@let1 _₅ (@primitive-function random-dice 0)
                (@let1 _₆ (_₅)
                  (@let1 _₇ (_₄ _₆)
                    (@let1 _₈ 1
                      (@let1 _₉ (_₇ _₈)
                        (if _₉
                          (@let1 _₁₀
                              (@primitive-function equal? 2)
                            (@let1 _₁₁
                                (@primitive-function
                                 random-dice
                                 0)
                              (@let1 _₁₂ (_₁₁)
                                (@let1 _₁₃ (_₁₀ _₁₂)
                                  (@let1 _₁₄ 2 (_₁₃ _₁₄))))))
                          #f)))))))
          (if _₃ 0 42))
      (_₁ _₂))))

;;; ExplicateControlPass

(define-function _main
  (block body
    (= _₁ (literal (@primitive-function println-non-void 1)))
    (= _₄ (literal (@primitive-function equal? 2)))
    (= _₅ (literal (@primitive-function random-dice 0)))
    (= _₆ (apply-nullary _₅))
    (= _₇ (apply _₄ _₆))
    (= _₈ (literal 1))
    (= _₉ (apply _₇ _₈))
    (branch _₉ _main/then₅ _main/else₆))
  (block _main/let-body₁ (= _↩ (apply _₁ _₂)) (return _↩))
  (block _main/then₂
    (= _₂ (literal 0))
    (goto _main/let-body₁))
  (block _main/else₃
    (= _₂ (literal 42))
    (goto _main/let-body₁))
  (block _main/let-body₄
    (branch _₃ _main/then₂ _main/else₃))
  (block _main/then₅
    (= _₁₀ (literal (@primitive-function equal? 2)))
    (= _₁₁ (literal (@primitive-function random-dice 0)))
    (= _₁₂ (apply-nullary _₁₁))
    (= _₁₃ (apply _₁₀ _₁₂))
    (= _₁₄ (literal 2))
    (= _₃ (apply _₁₃ _₁₄))
    (goto _main/let-body₄))
  (block _main/else₆
    (= _₃ (literal #f))
    (goto _main/let-body₄)))

(define-variable _main©constant)

(define-setup _main©setup
  (block body
    (= function-address (literal (@address _main)))
    (= arity (literal 0))
    (= size (literal 0))
    (= curry
       (call
        (@primitive-function make-curry 3)
        function-address
        arity
        size))
    (store _main©constant curry)
    (return)))

;;; SelectInstructionPass

(export _setup _main)

(define-code _main
  (block body
    (movq
     (label-imm (external-label x-println-non-void))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁))
    (movq (label-imm (external-label x-equal?)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₄))
    (movq
     (label-imm (external-label x-random-dice))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₅))
    (movq (var _₅) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (var _₆))
    (movq (var _₄) (reg rdi))
    (movq (var _₆) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₇))
    (movq (imm 8) (var _₈))
    (movq (var _₇) (reg rdi))
    (movq (var _₈) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₉))
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (var _₉) (reg rax))
    (branch-if
     (cc e)
     (label _main/then₅)
     (label _main/else₆)))
  (block _main/let-body₁
    (movq (var _₁) (reg rdi))
    (movq (var _₂) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _↩))
    (movq (var _↩) (reg rax))
    (retq))
  (block _main/then₂
    (movq (imm 0) (var _₂))
    (jmp (label _main/let-body₁)))
  (block _main/else₃
    (movq (imm 336) (var _₂))
    (jmp (label _main/let-body₁)))
  (block _main/let-body₄
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (var _₃) (reg rax))
    (branch-if
     (cc e)
     (label _main/then₂)
     (label _main/else₃)))
  (block _main/then₅
    (movq (label-imm (external-label x-equal?)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁₀))
    (movq
     (label-imm (external-label x-random-dice))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁₁))
    (movq (var _₁₁) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (var _₁₂))
    (movq (var _₁₀) (reg rdi))
    (movq (var _₁₂) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₁₃))
    (movq (imm 16) (var _₁₄))
    (movq (var _₁₃) (reg rdi))
    (movq (var _₁₄) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₃))
    (jmp (label _main/let-body₄)))
  (block _main/else₆
    (movq (label-deref (external-label x-false)) (var _₃))
    (jmp (label _main/let-body₄))))

(define-space _main©constant 8)

(define-code _main©setup
  (block body
    (movq (label-imm (label _main)) (var function-address))
    (orq (imm 3) (var function-address))
    (movq (imm 0) (var arity))
    (movq (imm 0) (var size))
    (movq (var function-address) (reg rdi))
    (movq (var arity) (reg rsi))
    (movq (var size) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var curry))
    (movq (var curry) (label-deref (label _main©constant)))
    (retq)))

(define-code _setup
  (block body
    (callq-n (label _main©setup) (arity 0))
    (movq (reg rax) (var _))))

;;; AssignHomePass

(export _setup _main)

(define-code _main
  (block body
    (movq
     (label-imm (external-label x-println-non-void))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (movq (label-imm (external-label x-equal?)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq
     (label-imm (external-label x-random-dice))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -80) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -72) (reg rdi))
    (movq (reg-deref (reg rbp) -88) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (imm 8) (reg-deref (reg rbp) -104))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (movq (reg-deref (reg rbp) -104) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (reg-deref (reg rbp) -112) (reg rax))
    (branch-if
     (cc e)
     (label _main/then₅)
     (label _main/else₆)))
  (block _main/let-body₁
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -120) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (movq (reg-deref (reg rbp) -128) (reg rax))
    (retq))
  (block _main/then₂
    (movq (imm 0) (reg-deref (reg rbp) -120))
    (jmp (label _main/let-body₁)))
  (block _main/else₃
    (movq (imm 336) (reg-deref (reg rbp) -120))
    (jmp (label _main/let-body₁)))
  (block _main/let-body₄
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (reg-deref (reg rbp) -136) (reg rax))
    (branch-if
     (cc e)
     (label _main/then₂)
     (label _main/else₃)))
  (block _main/then₅
    (movq (label-imm (external-label x-equal?)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -144))
    (movq
     (label-imm (external-label x-random-dice))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -152))
    (movq (reg-deref (reg rbp) -152) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -144) (reg rdi))
    (movq (reg-deref (reg rbp) -160) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -168))
    (movq (imm 16) (reg-deref (reg rbp) -176))
    (movq (reg-deref (reg rbp) -168) (reg rdi))
    (movq (reg-deref (reg rbp) -176) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (jmp (label _main/let-body₄)))
  (block _main/else₆
    (movq
     (label-deref (external-label x-false))
     (reg-deref (reg rbp) -136))
    (jmp (label _main/let-body₄))))

(define-space _main©constant 8)

(define-code _main©setup
  (block body
    (movq
     (label-imm (label _main))
     (reg-deref (reg rbp) -64))
    (orq (imm 3) (reg-deref (reg rbp) -64))
    (movq (imm 0) (reg-deref (reg rbp) -72))
    (movq (imm 0) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (movq (reg-deref (reg rbp) -80) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq
     (reg-deref (reg rbp) -88)
     (label-deref (label _main©constant)))
    (retq)))

(define-code _setup
  (block body
    (callq-n (label _main©setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -64))))

;;; PatchInstructionPass

(export _setup _main)

(define-code _main
  (block body
    (movq
     (label-imm (external-label x-println-non-void))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (movq (label-imm (external-label x-equal?)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq
     (label-imm (external-label x-random-dice))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -80) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -72) (reg rdi))
    (movq (reg-deref (reg rbp) -88) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (imm 8) (reg-deref (reg rbp) -104))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (movq (reg-deref (reg rbp) -104) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (reg-deref (reg rbp) -112) (reg rax))
    (branch-if
     (cc e)
     (label _main/then₅)
     (label _main/else₆)))
  (block _main/let-body₁
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -120) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (movq (reg-deref (reg rbp) -128) (reg rax))
    (retq))
  (block _main/then₂
    (movq (imm 0) (reg-deref (reg rbp) -120))
    (jmp (label _main/let-body₁)))
  (block _main/else₃
    (movq (imm 336) (reg-deref (reg rbp) -120))
    (jmp (label _main/let-body₁)))
  (block _main/let-body₄
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (reg-deref (reg rbp) -136) (reg rax))
    (branch-if
     (cc e)
     (label _main/then₂)
     (label _main/else₃)))
  (block _main/then₅
    (movq (label-imm (external-label x-equal?)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -144))
    (movq
     (label-imm (external-label x-random-dice))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -152))
    (movq (reg-deref (reg rbp) -152) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -144) (reg rdi))
    (movq (reg-deref (reg rbp) -160) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -168))
    (movq (imm 16) (reg-deref (reg rbp) -176))
    (movq (reg-deref (reg rbp) -168) (reg rdi))
    (movq (reg-deref (reg rbp) -176) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (jmp (label _main/let-body₄)))
  (block _main/else₆
    (movq (label-deref (external-label x-false)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (jmp (label _main/let-body₄))))

(define-space _main©constant 8)

(define-code _main©setup
  (block body
    (movq
     (label-imm (label _main))
     (reg-deref (reg rbp) -64))
    (orq (imm 3) (reg-deref (reg rbp) -64))
    (movq (imm 0) (reg-deref (reg rbp) -72))
    (movq (imm 0) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (movq (reg-deref (reg rbp) -80) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rax))
    (movq (reg rax) (label-deref (label _main©constant)))
    (retq)))

(define-code _setup
  (block body
    (callq-n (label _main©setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -64))))

;;; PrologAndEpilogPass

(export _setup _main)

(define-code _main
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 176) (reg rsp))
    (jmp (label body)))
  (block body
    (movq
     (label-imm (external-label x-println-non-void))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (movq (label-imm (external-label x-equal?)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq
     (label-imm (external-label x-random-dice))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -80) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -72) (reg rdi))
    (movq (reg-deref (reg rbp) -88) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (imm 8) (reg-deref (reg rbp) -104))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (movq (reg-deref (reg rbp) -104) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (reg-deref (reg rbp) -112) (reg rax))
    (branch-if
     (cc e)
     (label _main/then₅)
     (label _main/else₆)))
  (block _main/let-body₁
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -120) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (movq (reg-deref (reg rbp) -128) (reg rax))
    (jmp (label epilog)))
  (block _main/then₂
    (movq (imm 0) (reg-deref (reg rbp) -120))
    (jmp (label _main/let-body₁)))
  (block _main/else₃
    (movq (imm 336) (reg-deref (reg rbp) -120))
    (jmp (label _main/let-body₁)))
  (block _main/let-body₄
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (reg-deref (reg rbp) -136) (reg rax))
    (branch-if
     (cc e)
     (label _main/then₂)
     (label _main/else₃)))
  (block _main/then₅
    (movq (label-imm (external-label x-equal?)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -144))
    (movq
     (label-imm (external-label x-random-dice))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -152))
    (movq (reg-deref (reg rbp) -152) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -144) (reg rdi))
    (movq (reg-deref (reg rbp) -160) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -168))
    (movq (imm 16) (reg-deref (reg rbp) -176))
    (movq (reg-deref (reg rbp) -168) (reg rdi))
    (movq (reg-deref (reg rbp) -176) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (jmp (label _main/let-body₄)))
  (block _main/else₆
    (movq (label-deref (external-label x-false)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (jmp (label _main/let-body₄)))
  (block epilog
    (addq (imm 176) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-space _main©constant 8)

(define-code _main©setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 88) (reg rsp))
    (jmp (label body)))
  (block body
    (movq
     (label-imm (label _main))
     (reg-deref (reg rbp) -64))
    (orq (imm 3) (reg-deref (reg rbp) -64))
    (movq (imm 0) (reg-deref (reg rbp) -72))
    (movq (imm 0) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (movq (reg-deref (reg rbp) -80) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rax))
    (movq (reg rax) (label-deref (label _main©constant)))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 88) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code _setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 64) (reg rsp))
    (jmp (label body)))
  (block body
    (callq-n (label _main©setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -64)))
  (block epilog
    (addq (imm 64) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

