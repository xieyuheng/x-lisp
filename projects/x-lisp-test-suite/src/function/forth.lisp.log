;;; Input

(define (swap f x y) (f y x))

(define (drop f) (lambda (dropped) (lambda (x) (f x))))

(define (dup f) (lambda (x) (f x x)))

(define (identity x) x)

(define (_main)
  (println-non-void
   (begin (= f identity) (= g (dup identity)) (g f f))))

;;; ShrinkPass

(define (swap f x y) ((f y) x))

(define (drop f) (lambda (dropped) (lambda (x) (f x))))

(define (dup f) (lambda (x) ((f x) x)))

(define (identity x) x)

(define (_main)
  (println-non-void
   (@let1 f identity (@let1 g (dup identity) ((g f) f)))))

;;; UniquifyPass

(define (swap f x y) ((f y) x))

(define (drop f) (lambda (dropped₁) (lambda (x₁) (f x₁))))

(define (dup f) (lambda (x₁) ((f x₁) x₁)))

(define (identity x) x)

(define (_main)
  (println-non-void
   (@let1 f₁ identity
     (@let1 g₁ (dup identity) ((g₁ f₁) f₁)))))

;;; RevealGlobalPass

(define (swap f x y) ((f y) x))

(define (drop f) (lambda (dropped₁) (lambda (x₁) (f x₁))))

(define (dup f) (lambda (x₁) ((f x₁) x₁)))

(define (identity x) x)

(define (_main)
  ((@primitive-function println-non-void 1)
   (@let1 f₁ (@primitive-function identity 1)
     (@let1 g₁
         ((@function dup 1) (@primitive-function identity 1))
       ((g₁ f₁) f₁)))))

;;; LiftLambdaPass

(define (swap f x y) ((f y) x))

(define (drop f)
  ((((@primitive-function curry-put! 3) 0) f)
   ((((@primitive-function make-curry 3)
      (@function drop/λ₁ 2))
     2)
    1)))

(define (drop/λ₁ f dropped₁)
  ((((@primitive-function curry-put! 3) 0) f)
   ((((@primitive-function make-curry 3)
      (@function drop/λ₁/λ₁ 2))
     2)
    1)))

(define (drop/λ₁/λ₁ f x₁) (f x₁))

(define (dup f)
  ((((@primitive-function curry-put! 3) 0) f)
   ((((@primitive-function make-curry 3)
      (@function dup/λ₁ 2))
     2)
    1)))

(define (dup/λ₁ f x₁) ((f x₁) x₁))

(define (identity x) x)

(define (_main)
  ((@primitive-function println-non-void 1)
   (@let1 f₁ (@primitive-function identity 1)
     (@let1 g₁
         ((@function dup 1) (@primitive-function identity 1))
       ((g₁ f₁) f₁)))))

;;; UnnestOperandPass

(define (swap f x y) (@let1 _₁ (f y) (_₁ x)))

(define (drop f)
  (@let1 _₁ (@primitive-function curry-put! 3)
    (@let1 _₂ 0
      (@let1 _₃ (_₁ _₂)
        (@let1 _₄ (_₃ f)
          (@let1 _₅ (@primitive-function make-curry 3)
            (@let1 _₆ (@function drop/λ₁ 2)
              (@let1 _₇ (_₅ _₆)
                (@let1 _₈ 2
                  (@let1 _₉ (_₇ _₈)
                    (@let1 _₁₀ 1
                      (@let1 _₁₁ (_₉ _₁₀) (_₄ _₁₁)))))))))))))

(define (drop/λ₁ f dropped₁)
  (@let1 _₁ (@primitive-function curry-put! 3)
    (@let1 _₂ 0
      (@let1 _₃ (_₁ _₂)
        (@let1 _₄ (_₃ f)
          (@let1 _₅ (@primitive-function make-curry 3)
            (@let1 _₆ (@function drop/λ₁/λ₁ 2)
              (@let1 _₇ (_₅ _₆)
                (@let1 _₈ 2
                  (@let1 _₉ (_₇ _₈)
                    (@let1 _₁₀ 1
                      (@let1 _₁₁ (_₉ _₁₀) (_₄ _₁₁)))))))))))))

(define (drop/λ₁/λ₁ f x₁) (f x₁))

(define (dup f)
  (@let1 _₁ (@primitive-function curry-put! 3)
    (@let1 _₂ 0
      (@let1 _₃ (_₁ _₂)
        (@let1 _₄ (_₃ f)
          (@let1 _₅ (@primitive-function make-curry 3)
            (@let1 _₆ (@function dup/λ₁ 2)
              (@let1 _₇ (_₅ _₆)
                (@let1 _₈ 2
                  (@let1 _₉ (_₇ _₈)
                    (@let1 _₁₀ 1
                      (@let1 _₁₁ (_₉ _₁₀) (_₄ _₁₁)))))))))))))

(define (dup/λ₁ f x₁) (@let1 _₁ (f x₁) (_₁ x₁)))

(define (identity x) x)

(define (_main)
  (@let1 _₁ (@primitive-function println-non-void 1)
    (@let1 f₁ (@let1 _₂ (@primitive-function identity 1) _₂)
      (@let1 g₁
          (@let1 _₃ (@function dup 1)
            (@let1 _₄ (@primitive-function identity 1)
              (_₃ _₄)))
        (@let1 _₅ (g₁ f₁) (@let1 _₆ (_₅ f₁) (_₁ _₆)))))))

;;; ExplicateControlPass

(define-function identity
  (block body (= x (argument 0)) (return x)))

(define-function swap
  (block body
    (= f (argument 0))
    (= x (argument 1))
    (= y (argument 2))
    (= _₁ (apply f y))
    (= _↩ (apply _₁ x))
    (return _↩)))

(define-function drop
  (block body
    (= f (argument 0))
    (= _₁ (literal (@primitive-function curry-put! 3)))
    (= _₂ (literal 0))
    (= _₃ (apply _₁ _₂))
    (= _₄ (apply _₃ f))
    (= _₅ (literal (@primitive-function make-curry 3)))
    (= _₆ (literal (@function drop/λ₁ 2)))
    (= _₇ (apply _₅ _₆))
    (= _₈ (literal 2))
    (= _₉ (apply _₇ _₈))
    (= _₁₀ (literal 1))
    (= _₁₁ (apply _₉ _₁₀))
    (= _↩ (apply _₄ _₁₁))
    (return _↩)))

(define-function drop/λ₁
  (block body
    (= f (argument 0))
    (= dropped₁ (argument 1))
    (= _₁ (literal (@primitive-function curry-put! 3)))
    (= _₂ (literal 0))
    (= _₃ (apply _₁ _₂))
    (= _₄ (apply _₃ f))
    (= _₅ (literal (@primitive-function make-curry 3)))
    (= _₆ (literal (@function drop/λ₁/λ₁ 2)))
    (= _₇ (apply _₅ _₆))
    (= _₈ (literal 2))
    (= _₉ (apply _₇ _₈))
    (= _₁₀ (literal 1))
    (= _₁₁ (apply _₉ _₁₀))
    (= _↩ (apply _₄ _₁₁))
    (return _↩)))

(define-function drop/λ₁/λ₁
  (block body
    (= f (argument 0))
    (= x₁ (argument 1))
    (= _↩ (apply f x₁))
    (return _↩)))

(define-function dup
  (block body
    (= f (argument 0))
    (= _₁ (literal (@primitive-function curry-put! 3)))
    (= _₂ (literal 0))
    (= _₃ (apply _₁ _₂))
    (= _₄ (apply _₃ f))
    (= _₅ (literal (@primitive-function make-curry 3)))
    (= _₆ (literal (@function dup/λ₁ 2)))
    (= _₇ (apply _₅ _₆))
    (= _₈ (literal 2))
    (= _₉ (apply _₇ _₈))
    (= _₁₀ (literal 1))
    (= _₁₁ (apply _₉ _₁₀))
    (= _↩ (apply _₄ _₁₁))
    (return _↩)))

(define-function dup/λ₁
  (block body
    (= f (argument 0))
    (= x₁ (argument 1))
    (= _₁ (apply f x₁))
    (= _↩ (apply _₁ x₁))
    (return _↩)))

(define-function _main
  (block body
    (= _₁ (literal (@primitive-function println-non-void 1)))
    (= _₂ (literal (@primitive-function identity 1)))
    (= f₁ (identity _₂))
    (= _₃ (literal (@function dup 1)))
    (= _₄ (literal (@primitive-function identity 1)))
    (= g₁ (apply _₃ _₄))
    (= _₅ (apply g₁ f₁))
    (= _₆ (apply _₅ f₁))
    (= _↩ (apply _₁ _₆))
    (return _↩)))

;;; SelectInstructionPass

(export _setup _main)

(define-code identity
  (block body
    (movq (reg rdi) (var x))
    (movq (var x) (reg rax))
    (retq)))

(define-code swap
  (block body
    (movq (reg rdi) (var f))
    (movq (reg rsi) (var x))
    (movq (reg rdx) (var y))
    (movq (var f) (reg rdi))
    (movq (var y) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₁))
    (movq (var _₁) (reg rdi))
    (movq (var x) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _↩))
    (movq (var _↩) (reg rax))
    (retq)))

(define-code drop
  (block body
    (movq (reg rdi) (var f))
    (leaq
     (label-deref (external-label x-curry-put!))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁))
    (movq (imm 0) (var _₂))
    (movq (var _₁) (reg rdi))
    (movq (var _₂) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₃))
    (movq (var _₃) (reg rdi))
    (movq (var f) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₄))
    (leaq
     (label-deref (external-label x-make-curry))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₅))
    (leaq (label-deref (label drop/λ₁)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₆))
    (movq (var _₅) (reg rdi))
    (movq (var _₆) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₇))
    (movq (imm 16) (var _₈))
    (movq (var _₇) (reg rdi))
    (movq (var _₈) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₉))
    (movq (imm 8) (var _₁₀))
    (movq (var _₉) (reg rdi))
    (movq (var _₁₀) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₁₁))
    (movq (var _₄) (reg rdi))
    (movq (var _₁₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _↩))
    (movq (var _↩) (reg rax))
    (retq)))

(define-code drop/λ₁
  (block body
    (movq (reg rdi) (var f))
    (movq (reg rsi) (var dropped₁))
    (leaq
     (label-deref (external-label x-curry-put!))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁))
    (movq (imm 0) (var _₂))
    (movq (var _₁) (reg rdi))
    (movq (var _₂) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₃))
    (movq (var _₃) (reg rdi))
    (movq (var f) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₄))
    (leaq
     (label-deref (external-label x-make-curry))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₅))
    (leaq (label-deref (label drop/λ₁/λ₁)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₆))
    (movq (var _₅) (reg rdi))
    (movq (var _₆) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₇))
    (movq (imm 16) (var _₈))
    (movq (var _₇) (reg rdi))
    (movq (var _₈) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₉))
    (movq (imm 8) (var _₁₀))
    (movq (var _₉) (reg rdi))
    (movq (var _₁₀) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₁₁))
    (movq (var _₄) (reg rdi))
    (movq (var _₁₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _↩))
    (movq (var _↩) (reg rax))
    (retq)))

(define-code drop/λ₁/λ₁
  (block body
    (movq (reg rdi) (var f))
    (movq (reg rsi) (var x₁))
    (movq (var f) (reg rdi))
    (movq (var x₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _↩))
    (movq (var _↩) (reg rax))
    (retq)))

(define-code dup
  (block body
    (movq (reg rdi) (var f))
    (leaq
     (label-deref (external-label x-curry-put!))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁))
    (movq (imm 0) (var _₂))
    (movq (var _₁) (reg rdi))
    (movq (var _₂) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₃))
    (movq (var _₃) (reg rdi))
    (movq (var f) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₄))
    (leaq
     (label-deref (external-label x-make-curry))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₅))
    (leaq (label-deref (label dup/λ₁)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₆))
    (movq (var _₅) (reg rdi))
    (movq (var _₆) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₇))
    (movq (imm 16) (var _₈))
    (movq (var _₇) (reg rdi))
    (movq (var _₈) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₉))
    (movq (imm 8) (var _₁₀))
    (movq (var _₉) (reg rdi))
    (movq (var _₁₀) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₁₁))
    (movq (var _₄) (reg rdi))
    (movq (var _₁₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _↩))
    (movq (var _↩) (reg rax))
    (retq)))

(define-code dup/λ₁
  (block body
    (movq (reg rdi) (var f))
    (movq (reg rsi) (var x₁))
    (movq (var f) (reg rdi))
    (movq (var x₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₁))
    (movq (var _₁) (reg rdi))
    (movq (var x₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _↩))
    (movq (var _↩) (reg rax))
    (retq)))

(define-code _main
  (block body
    (leaq
     (label-deref (external-label x-println-non-void))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁))
    (leaq
     (label-deref (external-label x-identity))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₂))
    (movq (var _₂) (var f₁))
    (leaq (label-deref (label dup)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₃))
    (leaq
     (label-deref (external-label x-identity))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₄))
    (movq (var _₃) (reg rdi))
    (movq (var _₄) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var g₁))
    (movq (var g₁) (reg rdi))
    (movq (var f₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₅))
    (movq (var _₅) (reg rdi))
    (movq (var f₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₆))
    (movq (var _₁) (reg rdi))
    (movq (var _₆) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _↩))
    (movq (var _↩) (reg rax))
    (retq)))

(define-code _setup (block body))

;;; AssignHomePass

(export _setup _main)

(define-code identity
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg-deref (reg rbp) -64) (reg rax))
    (retq)))

(define-code swap
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg rsi) (reg-deref (reg rbp) -72))
    (movq (reg rdx) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -96) (reg rax))
    (retq)))

(define-code drop
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (leaq
     (label-deref (external-label x-curry-put!))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (imm 0) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -72) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rdi))
    (movq (reg-deref (reg rbp) -64) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (leaq
     (label-deref (external-label x-make-curry))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq (label-deref (label drop/λ₁)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (reg-deref (reg rbp) -104) (reg rdi))
    (movq (reg-deref (reg rbp) -112) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -120))
    (movq (imm 16) (reg-deref (reg rbp) -128))
    (movq (reg-deref (reg rbp) -120) (reg rdi))
    (movq (reg-deref (reg rbp) -128) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (movq (imm 8) (reg-deref (reg rbp) -144))
    (movq (reg-deref (reg rbp) -136) (reg rdi))
    (movq (reg-deref (reg rbp) -144) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -152))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (movq (reg-deref (reg rbp) -152) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -160) (reg rax))
    (retq)))

(define-code drop/λ₁
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg rsi) (reg-deref (reg rbp) -72))
    (leaq
     (label-deref (external-label x-curry-put!))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (imm 0) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -80) (reg rdi))
    (movq (reg-deref (reg rbp) -88) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (movq (reg-deref (reg rbp) -64) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq
     (label-deref (external-label x-make-curry))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (leaq (label-deref (label drop/λ₁/λ₁)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -120))
    (movq (reg-deref (reg rbp) -112) (reg rdi))
    (movq (reg-deref (reg rbp) -120) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (movq (imm 16) (reg-deref (reg rbp) -136))
    (movq (reg-deref (reg rbp) -128) (reg rdi))
    (movq (reg-deref (reg rbp) -136) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -144))
    (movq (imm 8) (reg-deref (reg rbp) -152))
    (movq (reg-deref (reg rbp) -144) (reg rdi))
    (movq (reg-deref (reg rbp) -152) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -104) (reg rdi))
    (movq (reg-deref (reg rbp) -160) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -168))
    (movq (reg-deref (reg rbp) -168) (reg rax))
    (retq)))

(define-code drop/λ₁/λ₁
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg rsi) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -80) (reg rax))
    (retq)))

(define-code dup
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (leaq
     (label-deref (external-label x-curry-put!))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (imm 0) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -72) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rdi))
    (movq (reg-deref (reg rbp) -64) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (leaq
     (label-deref (external-label x-make-curry))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq (label-deref (label dup/λ₁)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (reg-deref (reg rbp) -104) (reg rdi))
    (movq (reg-deref (reg rbp) -112) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -120))
    (movq (imm 16) (reg-deref (reg rbp) -128))
    (movq (reg-deref (reg rbp) -120) (reg rdi))
    (movq (reg-deref (reg rbp) -128) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (movq (imm 8) (reg-deref (reg rbp) -144))
    (movq (reg-deref (reg rbp) -136) (reg rdi))
    (movq (reg-deref (reg rbp) -144) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -152))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (movq (reg-deref (reg rbp) -152) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -160) (reg rax))
    (retq)))

(define-code dup/λ₁
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg rsi) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -80) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rax))
    (retq)))

(define-code _main
  (block body
    (leaq
     (label-deref (external-label x-println-non-void))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (leaq
     (label-deref (external-label x-identity))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq
     (reg-deref (reg rbp) -72)
     (reg-deref (reg rbp) -80))
    (leaq (label-deref (label dup)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (leaq
     (label-deref (external-label x-identity))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -88) (reg rdi))
    (movq (reg-deref (reg rbp) -96) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (movq (reg-deref (reg rbp) -104) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (reg-deref (reg rbp) -112) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -120))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -120) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (movq (reg-deref (reg rbp) -128) (reg rax))
    (retq)))

(define-code _setup (block body))

;;; PatchInstructionPass

(export _setup _main)

(define-code identity
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg-deref (reg rbp) -64) (reg rax))
    (retq)))

(define-code swap
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg rsi) (reg-deref (reg rbp) -72))
    (movq (reg rdx) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -96) (reg rax))
    (retq)))

(define-code drop
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (leaq
     (label-deref (external-label x-curry-put!))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (imm 0) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -72) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rdi))
    (movq (reg-deref (reg rbp) -64) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (leaq
     (label-deref (external-label x-make-curry))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq (label-deref (label drop/λ₁)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (reg-deref (reg rbp) -104) (reg rdi))
    (movq (reg-deref (reg rbp) -112) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -120))
    (movq (imm 16) (reg-deref (reg rbp) -128))
    (movq (reg-deref (reg rbp) -120) (reg rdi))
    (movq (reg-deref (reg rbp) -128) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (movq (imm 8) (reg-deref (reg rbp) -144))
    (movq (reg-deref (reg rbp) -136) (reg rdi))
    (movq (reg-deref (reg rbp) -144) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -152))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (movq (reg-deref (reg rbp) -152) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -160) (reg rax))
    (retq)))

(define-code drop/λ₁
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg rsi) (reg-deref (reg rbp) -72))
    (leaq
     (label-deref (external-label x-curry-put!))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (imm 0) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -80) (reg rdi))
    (movq (reg-deref (reg rbp) -88) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (movq (reg-deref (reg rbp) -64) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq
     (label-deref (external-label x-make-curry))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (leaq (label-deref (label drop/λ₁/λ₁)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -120))
    (movq (reg-deref (reg rbp) -112) (reg rdi))
    (movq (reg-deref (reg rbp) -120) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (movq (imm 16) (reg-deref (reg rbp) -136))
    (movq (reg-deref (reg rbp) -128) (reg rdi))
    (movq (reg-deref (reg rbp) -136) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -144))
    (movq (imm 8) (reg-deref (reg rbp) -152))
    (movq (reg-deref (reg rbp) -144) (reg rdi))
    (movq (reg-deref (reg rbp) -152) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -104) (reg rdi))
    (movq (reg-deref (reg rbp) -160) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -168))
    (movq (reg-deref (reg rbp) -168) (reg rax))
    (retq)))

(define-code drop/λ₁/λ₁
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg rsi) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -80) (reg rax))
    (retq)))

(define-code dup
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (leaq
     (label-deref (external-label x-curry-put!))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (imm 0) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -72) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rdi))
    (movq (reg-deref (reg rbp) -64) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (leaq
     (label-deref (external-label x-make-curry))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq (label-deref (label dup/λ₁)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (reg-deref (reg rbp) -104) (reg rdi))
    (movq (reg-deref (reg rbp) -112) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -120))
    (movq (imm 16) (reg-deref (reg rbp) -128))
    (movq (reg-deref (reg rbp) -120) (reg rdi))
    (movq (reg-deref (reg rbp) -128) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (movq (imm 8) (reg-deref (reg rbp) -144))
    (movq (reg-deref (reg rbp) -136) (reg rdi))
    (movq (reg-deref (reg rbp) -144) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -152))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (movq (reg-deref (reg rbp) -152) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -160) (reg rax))
    (retq)))

(define-code dup/λ₁
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg rsi) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -80) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rax))
    (retq)))

(define-code _main
  (block body
    (leaq
     (label-deref (external-label x-println-non-void))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (leaq
     (label-deref (external-label x-identity))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -72) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (leaq (label-deref (label dup)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (leaq
     (label-deref (external-label x-identity))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -88) (reg rdi))
    (movq (reg-deref (reg rbp) -96) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (movq (reg-deref (reg rbp) -104) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (reg-deref (reg rbp) -112) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -120))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -120) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (movq (reg-deref (reg rbp) -128) (reg rax))
    (retq)))

(define-code _setup (block body))

;;; PrologAndEpilogPass

(export _setup _main)

(define-code identity
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 64) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg-deref (reg rbp) -64) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 64) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code swap
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 96) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg rsi) (reg-deref (reg rbp) -72))
    (movq (reg rdx) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -96) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 96) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code drop
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 160) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (leaq
     (label-deref (external-label x-curry-put!))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (imm 0) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -72) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rdi))
    (movq (reg-deref (reg rbp) -64) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (leaq
     (label-deref (external-label x-make-curry))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq (label-deref (label drop/λ₁)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (reg-deref (reg rbp) -104) (reg rdi))
    (movq (reg-deref (reg rbp) -112) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -120))
    (movq (imm 16) (reg-deref (reg rbp) -128))
    (movq (reg-deref (reg rbp) -120) (reg rdi))
    (movq (reg-deref (reg rbp) -128) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (movq (imm 8) (reg-deref (reg rbp) -144))
    (movq (reg-deref (reg rbp) -136) (reg rdi))
    (movq (reg-deref (reg rbp) -144) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -152))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (movq (reg-deref (reg rbp) -152) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -160) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 160) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code drop/λ₁
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 168) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg rsi) (reg-deref (reg rbp) -72))
    (leaq
     (label-deref (external-label x-curry-put!))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (imm 0) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -80) (reg rdi))
    (movq (reg-deref (reg rbp) -88) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (movq (reg-deref (reg rbp) -64) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq
     (label-deref (external-label x-make-curry))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (leaq (label-deref (label drop/λ₁/λ₁)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -120))
    (movq (reg-deref (reg rbp) -112) (reg rdi))
    (movq (reg-deref (reg rbp) -120) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (movq (imm 16) (reg-deref (reg rbp) -136))
    (movq (reg-deref (reg rbp) -128) (reg rdi))
    (movq (reg-deref (reg rbp) -136) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -144))
    (movq (imm 8) (reg-deref (reg rbp) -152))
    (movq (reg-deref (reg rbp) -144) (reg rdi))
    (movq (reg-deref (reg rbp) -152) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -104) (reg rdi))
    (movq (reg-deref (reg rbp) -160) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -168))
    (movq (reg-deref (reg rbp) -168) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 168) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code drop/λ₁/λ₁
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 80) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg rsi) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -80) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 80) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code dup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 160) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (leaq
     (label-deref (external-label x-curry-put!))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (imm 0) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -72) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rdi))
    (movq (reg-deref (reg rbp) -64) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (leaq
     (label-deref (external-label x-make-curry))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 24) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (leaq (label-deref (label dup/λ₁)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 16) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (reg-deref (reg rbp) -104) (reg rdi))
    (movq (reg-deref (reg rbp) -112) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -120))
    (movq (imm 16) (reg-deref (reg rbp) -128))
    (movq (reg-deref (reg rbp) -120) (reg rdi))
    (movq (reg-deref (reg rbp) -128) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -136))
    (movq (imm 8) (reg-deref (reg rbp) -144))
    (movq (reg-deref (reg rbp) -136) (reg rdi))
    (movq (reg-deref (reg rbp) -144) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -152))
    (movq (reg-deref (reg rbp) -96) (reg rdi))
    (movq (reg-deref (reg rbp) -152) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -160))
    (movq (reg-deref (reg rbp) -160) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 160) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code dup/λ₁
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 88) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (reg rdi) (reg-deref (reg rbp) -64))
    (movq (reg rsi) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -80) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 88) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code _main
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 128) (reg rsp))
    (jmp (label body)))
  (block body
    (leaq
     (label-deref (external-label x-println-non-void))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (leaq
     (label-deref (external-label x-identity))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -72) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (leaq (label-deref (label dup)) (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (leaq
     (label-deref (external-label x-identity))
     (reg rdi))
    (orq (imm 3) (reg rdi))
    (movq (imm 8) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -88) (reg rdi))
    (movq (reg-deref (reg rbp) -96) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -104))
    (movq (reg-deref (reg rbp) -104) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -112))
    (movq (reg-deref (reg rbp) -112) (reg rdi))
    (movq (reg-deref (reg rbp) -80) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -120))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -120) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -128))
    (movq (reg-deref (reg rbp) -128) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 128) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code _setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 56) (reg rsp))
    (jmp (label body)))
  (block body)
  (block epilog
    (addq (imm 56) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

