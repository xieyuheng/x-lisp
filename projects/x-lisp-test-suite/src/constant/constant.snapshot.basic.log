;;; Input

(define (main)
  (println-non-void (define-variable one))
  (println-non-void (define-variable _one/flag #f))
  (println-non-void
   (define-function
    _one/get
    (block
     guard
     (= flag (load _one/flag))
     (branch flag cached init))
    (block cached (= result (load one)) (return result))
    (block
     init
     (= result (call (@function _one/function 0)))
     (store one result)
     (= true (const #t))
     (store _one/flag true)
     (return result))))
  (println-non-void
   (define-function
    _one/function
    (block body (= _↩ (const 1)) (return _↩))))
  (println-non-void (define-variable two))
  (println-non-void (define-variable _two/flag #f))
  (println-non-void
   (define-function
    _two/get
    (block
     guard
     (= flag (load _two/flag))
     (branch flag cached init))
    (block cached (= result (load two)) (return result))
    (block
     init
     (= result (call (@function _two/function 0)))
     (store two result)
     (= true (const #t))
     (store _two/flag true)
     (return result))))
  (println-non-void
   (define-function
    _two/function
    (block
     body
     (= _₁ (const (@primitive-function iadd 2)))
     (= _₂ (const 1))
     (= _₃ (apply _₁ _₂))
     (= _₄ (call (@function _one/get 0)))
     (= _↩ (apply _₃ _₄))
     (return _↩))))
  (println-non-void (define-variable three))
  (println-non-void (define-variable _three/flag #f))
  (println-non-void
   (define-function
    _three/get
    (block
     guard
     (= flag (load _three/flag))
     (branch flag cached init))
    (block cached (= result (load three)) (return result))
    (block
     init
     (= result (call (@function _three/function 0)))
     (store three result)
     (= true (const #t))
     (store _three/flag true)
     (return result))))
  (println-non-void
   (define-function
    _three/function
    (block
     body
     (= _₁ (const (@primitive-function iadd 2)))
     (= _₂ (const 1))
     (= _₃ (apply _₁ _₂))
     (= _₄ (call (@function _two/get 0)))
     (= _↩ (apply _₃ _₄))
     (return _↩))))
  (println-non-void
   (define-function
    main
    (block
     body
     (= _₁ (const (@primitive-function println-non-void 1)))
     (= _₂ (call (@function _three/get 0)))
     (= _↩ (apply _₁ _₂))
     (return _↩)))))

