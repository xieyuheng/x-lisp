(define-variable one)

(define-variable _one/flag)

(define-setup _one/flag-setup
  (block body
    (= false (literal #f))
    (store _one/flag false)
    (return)))

(define-function _one/get
  (block body
    (= flag (load _one/flag))
    (branch flag cached init))
  (block cached (= result (load one)) (return result))
  (block init
    (= result (call (@function _one/init-function 0)))
    (store one result)
    (= true (literal #t))
    (store _one/flag true)
    (return result)))

(define-function _one/init-function
  (block body (= _↩ (literal 1)) (return _↩)))

(define-variable two)

(define-variable _two/flag)

(define-setup _two/flag-setup
  (block body
    (= false (literal #f))
    (store _two/flag false)
    (return)))

(define-function _two/get
  (block body
    (= flag (load _two/flag))
    (branch flag cached init))
  (block cached (= result (load two)) (return result))
  (block init
    (= result (call (@function _two/init-function 0)))
    (store two result)
    (= true (literal #t))
    (store _two/flag true)
    (return result)))

(define-function _two/init-function
  (block body
    (= _₁ (literal (@primitive-function iadd 2)))
    (= _₂ (literal 1))
    (= _₃ (apply _₁ _₂))
    (= _₄ (call (@function _one/get 0)))
    (= _↩ (apply _₃ _₄))
    (return _↩)))

(define-variable three)

(define-variable _three/flag)

(define-setup _three/flag-setup
  (block body
    (= false (literal #f))
    (store _three/flag false)
    (return)))

(define-function _three/get
  (block body
    (= flag (load _three/flag))
    (branch flag cached init))
  (block cached (= result (load three)) (return result))
  (block init
    (= result (call (@function _three/init-function 0)))
    (store three result)
    (= true (literal #t))
    (store _three/flag true)
    (return result)))

(define-function _three/init-function
  (block body
    (= _₁ (literal (@primitive-function iadd 2)))
    (= _₂ (literal 1))
    (= _₃ (apply _₁ _₂))
    (= _₄ (call (@function _two/get 0)))
    (= _↩ (apply _₃ _₄))
    (return _↩)))

(define-function _main
  (block body
    (= _₁ (literal (@primitive-function println-non-void 1)))
    (= _₂ (call (@function _three/get 0)))
    (= _↩ (apply _₁ _₂))
    (return _↩)))

(define-variable __main/constant)

(define-setup __main/setup
  (block body
    (= function-address (literal (@address _main)))
    (= arity (literal 0))
    (= size (literal 0))
    (= curry
       (call
        (@primitive-function make-curry 3)
        function-address
        arity
        size))
    (store __main/constant curry)
    (return)))
