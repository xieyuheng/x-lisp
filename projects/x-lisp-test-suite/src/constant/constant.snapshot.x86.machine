(export _setup _main)

(define-space one 8)

(define-space one©flag 8)

(define-code one©flag-setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 64) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (label-deref (external-label x-false)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (movq (reg-deref (reg rbp) -64) (reg rax))
    (movq (reg rax) (label-deref (label one©flag)))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 64) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code one©get
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 80) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (label-deref (label one©flag)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (reg-deref (reg rbp) -64) (reg rax))
    (branch-if (cc e) (label cached) (label init)))
  (block cached
    (movq (label-deref (label one)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -72) (reg rax))
    (jmp (label epilog)))
  (block init
    (callq-n (label one©init-function) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -72) (reg rax))
    (movq (reg rax) (label-deref (label one)))
    (movq (label-deref (external-label x-true)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -80) (reg rax))
    (movq (reg rax) (label-deref (label one©flag)))
    (movq (reg-deref (reg rbp) -72) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 80) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code one©init-function
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 64) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (imm 8) (reg-deref (reg rbp) -64))
    (movq (reg-deref (reg rbp) -64) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 64) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-space two 8)

(define-space two©flag 8)

(define-code two©flag-setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 64) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (label-deref (external-label x-false)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (movq (reg-deref (reg rbp) -64) (reg rax))
    (movq (reg rax) (label-deref (label two©flag)))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 64) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code two©get
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 80) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (label-deref (label two©flag)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (reg-deref (reg rbp) -64) (reg rax))
    (branch-if (cc e) (label cached) (label init)))
  (block cached
    (movq (label-deref (label two)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -72) (reg rax))
    (jmp (label epilog)))
  (block init
    (callq-n (label two©init-function) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -72) (reg rax))
    (movq (reg rax) (label-deref (label two)))
    (movq (label-deref (external-label x-true)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -80) (reg rax))
    (movq (reg rax) (label-deref (label two©flag)))
    (movq (reg-deref (reg rbp) -72) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 80) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code two©init-function
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 96) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (label-deref (label iadd©constant)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (movq (imm 8) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (callq-n (label one©get) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -80) (reg rdi))
    (movq (reg-deref (reg rbp) -88) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -96) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 96) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-space three 8)

(define-space three©flag 8)

(define-code three©flag-setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 64) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (label-deref (external-label x-false)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (movq (reg-deref (reg rbp) -64) (reg rax))
    (movq (reg rax) (label-deref (label three©flag)))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 64) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code three©get
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 80) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (label-deref (label three©flag)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (reg-deref (reg rbp) -64) (reg rax))
    (branch-if (cc e) (label cached) (label init)))
  (block cached
    (movq (label-deref (label three)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -72) (reg rax))
    (jmp (label epilog)))
  (block init
    (callq-n (label three©init-function) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -72) (reg rax))
    (movq (reg rax) (label-deref (label three)))
    (movq (label-deref (external-label x-true)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -80) (reg rax))
    (movq (reg rax) (label-deref (label three©flag)))
    (movq (reg-deref (reg rbp) -72) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 80) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code three©init-function
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 96) (reg rsp))
    (jmp (label body)))
  (block body
    (movq (label-deref (label iadd©constant)) (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (movq (imm 8) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (callq-n (label two©get) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -80) (reg rdi))
    (movq (reg-deref (reg rbp) -88) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -96))
    (movq (reg-deref (reg rbp) -96) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 96) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code _main
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 80) (reg rsp))
    (jmp (label body)))
  (block body
    (movq
     (label-deref (label println-non-void©constant))
     (reg rax))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (callq-n (label three©get) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -72))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -80) (reg rax))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 80) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-data _main©metadata
  (pointer _main©metadata/name)
  (int 0)
  (int 0))

(define-data _main©metadata/name (string "_main"))

(define-space _main©constant 8)

(define-code _main©setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 88) (reg rsp))
    (jmp (label body)))
  (block body
    (movq
     (label-imm (label _main))
     (reg-deref (reg rbp) -64))
    (orq (imm 3) (reg-deref (reg rbp) -64))
    (movq (imm 0) (reg-deref (reg rbp) -72))
    (movq (imm 0) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (movq (reg-deref (reg rbp) -80) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rax))
    (movq (reg rax) (label-deref (label _main©constant)))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 88) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-data println-non-void©metadata
  (pointer println-non-void©metadata/name)
  (int 1)
  (int 1))

(define-data println-non-void©metadata/name
  (string "println-non-void"))

(define-space println-non-void©constant 8)

(define-code println-non-void©setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 88) (reg rsp))
    (jmp (label body)))
  (block body
    (movq
     (label-imm (external-label x-println-non-void))
     (reg-deref (reg rbp) -64))
    (orq (imm 3) (reg-deref (reg rbp) -64))
    (movq (imm 8) (reg-deref (reg rbp) -72))
    (movq (imm 0) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (movq (reg-deref (reg rbp) -80) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rax))
    (movq
     (reg rax)
     (label-deref (label println-non-void©constant)))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 88) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-data iadd©metadata
  (pointer iadd©metadata/name)
  (int 2)
  (int 1))

(define-data iadd©metadata/name (string "iadd"))

(define-space iadd©constant 8)

(define-code iadd©setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 88) (reg rsp))
    (jmp (label body)))
  (block body
    (movq
     (label-imm (external-label x-iadd))
     (reg-deref (reg rbp) -64))
    (orq (imm 3) (reg-deref (reg rbp) -64))
    (movq (imm 16) (reg-deref (reg rbp) -72))
    (movq (imm 0) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (movq (reg-deref (reg rbp) -80) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rax))
    (movq (reg rax) (label-deref (label iadd©constant)))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 88) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-data make-curry©metadata
  (pointer make-curry©metadata/name)
  (int 3)
  (int 1))

(define-data make-curry©metadata/name (string "make-curry"))

(define-space make-curry©constant 8)

(define-code make-curry©setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 88) (reg rsp))
    (jmp (label body)))
  (block body
    (movq
     (label-imm (external-label x-make-curry))
     (reg-deref (reg rbp) -64))
    (orq (imm 3) (reg-deref (reg rbp) -64))
    (movq (imm 24) (reg-deref (reg rbp) -72))
    (movq (imm 0) (reg-deref (reg rbp) -80))
    (movq (reg-deref (reg rbp) -64) (reg rdi))
    (movq (reg-deref (reg rbp) -72) (reg rsi))
    (movq (reg-deref (reg rbp) -80) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (reg-deref (reg rbp) -88))
    (movq (reg-deref (reg rbp) -88) (reg rax))
    (movq
     (reg rax)
     (label-deref (label make-curry©constant)))
    (jmp (label epilog)))
  (block epilog
    (addq (imm 88) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))

(define-code _setup
  (block prolog
    (pushq (reg rbp))
    (movq (reg rsp) (reg rbp))
    (pushq (reg rsp))
    (pushq (reg rbp))
    (pushq (reg rbx))
    (pushq (reg r12))
    (pushq (reg r13))
    (pushq (reg r14))
    (pushq (reg r15))
    (subq (imm 64) (reg rsp))
    (jmp (label body)))
  (block body
    (callq-n (label one©flag-setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (callq-n (label two©flag-setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (callq-n (label three©flag-setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (callq-n (label _main©setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (callq-n (label println-non-void©setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (callq-n (label iadd©setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -64))
    (callq-n (label make-curry©setup) (arity 0))
    (movq (reg rax) (reg-deref (reg rbp) -64)))
  (block epilog
    (addq (imm 64) (reg rsp))
    (popq (reg r15))
    (popq (reg r14))
    (popq (reg r13))
    (popq (reg r12))
    (popq (reg rbx))
    (popq (reg rbp))
    (popq (reg rsp))
    (popq (reg rbp))
    (retq)))
