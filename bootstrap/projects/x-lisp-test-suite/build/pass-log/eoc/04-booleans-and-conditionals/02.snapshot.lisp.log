;;; Input

(define (main)
  (println-non-void
   (begin
     (= x (random-dice))
     (= y (random-dice))
     (iadd
      (if (if (int-less? x 1) (equal? x 0) (equal? x 2))
        (iadd y 2)
        (iadd y 10))
      (if (if (int-less? x 1) (equal? x 0) (equal? x 2))
        (iadd y 2)
        (iadd y 10))))))

;;; ShrinkPass

(define (main)
  (println-non-void
   (@let1 x (random-dice)
     (@let1 y (random-dice)
       ((iadd
         (if
             (if ((int-less? x) 1)
               ((equal? x) 0)
               ((equal? x) 2))
           ((iadd y) 2)
           ((iadd y) 10)))
        (if
            (if ((int-less? x) 1)
              ((equal? x) 0)
              ((equal? x) 2))
          ((iadd y) 2)
          ((iadd y) 10)))))))

;;; UniquifyPass

(define (main)
  (println-non-void
   (@let1 x₁ (random-dice)
     (@let1 y₁ (random-dice)
       ((iadd
         (if
             (if ((int-less? x₁) 1)
               ((equal? x₁) 0)
               ((equal? x₁) 2))
           ((iadd y₁) 2)
           ((iadd y₁) 10)))
        (if
            (if ((int-less? x₁) 1)
              ((equal? x₁) 0)
              ((equal? x₁) 2))
          ((iadd y₁) 2)
          ((iadd y₁) 10)))))))

;;; RevealFunctionPass

(define (main)
  ((@primitive-function println-non-void 1)
   (@let1 x₁ ((@primitive-function random-dice 0))
     (@let1 y₁ ((@primitive-function random-dice 0))
       (((@primitive-function iadd 2)
         (if
             (if (((@primitive-function int-less? 2) x₁) 1)
               (((@primitive-function equal? 2) x₁) 0)
               (((@primitive-function equal? 2) x₁) 2))
           (((@primitive-function iadd 2) y₁) 2)
           (((@primitive-function iadd 2) y₁) 10)))
        (if
            (if (((@primitive-function int-less? 2) x₁) 1)
              (((@primitive-function equal? 2) x₁) 0)
              (((@primitive-function equal? 2) x₁) 2))
          (((@primitive-function iadd 2) y₁) 2)
          (((@primitive-function iadd 2) y₁) 10)))))))

;;; LiftLambdaPass

(define (main)
  ((@primitive-function println-non-void 1)
   (@let1 x₁ ((@primitive-function random-dice 0))
     (@let1 y₁ ((@primitive-function random-dice 0))
       (((@primitive-function iadd 2)
         (if
             (if (((@primitive-function int-less? 2) x₁) 1)
               (((@primitive-function equal? 2) x₁) 0)
               (((@primitive-function equal? 2) x₁) 2))
           (((@primitive-function iadd 2) y₁) 2)
           (((@primitive-function iadd 2) y₁) 10)))
        (if
            (if (((@primitive-function int-less? 2) x₁) 1)
              (((@primitive-function equal? 2) x₁) 0)
              (((@primitive-function equal? 2) x₁) 2))
          (((@primitive-function iadd 2) y₁) 2)
          (((@primitive-function iadd 2) y₁) 10)))))))

;;; UnnestOperandPass

(define (main)
  (@let1 _₁ (@primitive-function println-non-void 1)
    (@let1 x₁
        (@let1 _₂ (@primitive-function random-dice 0) (_₂))
      (@let1 y₁
          (@let1 _₃ (@primitive-function random-dice 0)
            (_₃))
        (@let1 _₄ (@primitive-function iadd 2)
          (@let1 _₅
              (@let1 _₆
                  (@let1 _₇
                      (@primitive-function int-less? 2)
                    (@let1 _₈ (_₇ x₁)
                      (@let1 _₉ 1
                        (@let1 _₁₀ (_₈ _₉)
                          (if _₁₀
                            (@let1 _₁₁
                                (@primitive-function
                                 equal?
                                 2)
                              (@let1 _₁₂ (_₁₁ x₁)
                                (@let1 _₁₃ 0 (_₁₂ _₁₃))))
                            (@let1 _₁₄
                                (@primitive-function
                                 equal?
                                 2)
                              (@let1 _₁₅ (_₁₄ x₁)
                                (@let1 _₁₆ 2 (_₁₅ _₁₆)))))))))
                (if _₆
                  (@let1 _₁₇ (@primitive-function iadd 2)
                    (@let1 _₁₈ (_₁₇ y₁)
                      (@let1 _₁₉ 2 (_₁₈ _₁₉))))
                  (@let1 _₂₀ (@primitive-function iadd 2)
                    (@let1 _₂₁ (_₂₀ y₁)
                      (@let1 _₂₂ 10 (_₂₁ _₂₂))))))
            (@let1 _₂₃ (_₄ _₅)
              (@let1 _₂₄
                  (@let1 _₂₅
                      (@let1 _₂₆
                          (@primitive-function int-less? 2)
                        (@let1 _₂₇ (_₂₆ x₁)
                          (@let1 _₂₈ 1
                            (@let1 _₂₉ (_₂₇ _₂₈)
                              (if _₂₉
                                (@let1 _₃₀
                                    (@primitive-function
                                     equal?
                                     2)
                                  (@let1 _₃₁ (_₃₀ x₁)
                                    (@let1 _₃₂ 0 (_₃₁ _₃₂))))
                                (@let1 _₃₃
                                    (@primitive-function
                                     equal?
                                     2)
                                  (@let1 _₃₄ (_₃₃ x₁)
                                    (@let1 _₃₅ 2 (_₃₄ _₃₅)))))))))
                    (if _₂₅
                      (@let1 _₃₆
                          (@primitive-function iadd 2)
                        (@let1 _₃₇ (_₃₆ y₁)
                          (@let1 _₃₈ 2 (_₃₇ _₃₈))))
                      (@let1 _₃₉
                          (@primitive-function iadd 2)
                        (@let1 _₄₀ (_₃₉ y₁)
                          (@let1 _₄₁ 10 (_₄₀ _₄₁))))))
                (@let1 _₄₂ (_₂₃ _₂₄) (_₁ _₄₂))))))))))

;;; ExplicateControlPass

(define-function main
  (block entry
    (= _₁ (const (@primitive-function println-non-void 1)))
    (= _₂ (const (@primitive-function random-dice 0)))
    (= x₁ (nullary-apply _₂))
    (= _₃ (const (@primitive-function random-dice 0)))
    (= y₁ (nullary-apply _₃))
    (= _₄ (const (@primitive-function iadd 2)))
    (= _₇ (const (@primitive-function int-less? 2)))
    (= _₈ (apply _₇ x₁))
    (= _₉ (const 1))
    (= _₁₀ (apply _₈ _₉))
    (branch _₁₀ main/then₁₁ main/else₁₂))
  (block main/let-body₁
    (= _₄₂ (apply _₂₃ _₂₄))
    (= _↩ (apply _₁ _₄₂))
    (return _↩))
  (block main/then₂
    (= _₃₆ (const (@primitive-function iadd 2)))
    (= _₃₇ (apply _₃₆ y₁))
    (= _₃₈ (const 2))
    (= _₂₄ (apply _₃₇ _₃₈))
    (goto main/let-body₁))
  (block main/else₃
    (= _₃₉ (const (@primitive-function iadd 2)))
    (= _₄₀ (apply _₃₉ y₁))
    (= _₄₁ (const 10))
    (= _₂₄ (apply _₄₀ _₄₁))
    (goto main/let-body₁))
  (block main/let-body₄ (branch _₂₅ main/then₂ main/else₃))
  (block main/then₅
    (= _₃₀ (const (@primitive-function equal? 2)))
    (= _₃₁ (apply _₃₀ x₁))
    (= _₃₂ (const 0))
    (= _₂₅ (apply _₃₁ _₃₂))
    (goto main/let-body₄))
  (block main/else₆
    (= _₃₃ (const (@primitive-function equal? 2)))
    (= _₃₄ (apply _₃₃ x₁))
    (= _₃₅ (const 2))
    (= _₂₅ (apply _₃₄ _₃₅))
    (goto main/let-body₄))
  (block main/let-body₇
    (= _₂₃ (apply _₄ _₅))
    (= _₂₆ (const (@primitive-function int-less? 2)))
    (= _₂₇ (apply _₂₆ x₁))
    (= _₂₈ (const 1))
    (= _₂₉ (apply _₂₇ _₂₈))
    (branch _₂₉ main/then₅ main/else₆))
  (block main/then₈
    (= _₁₇ (const (@primitive-function iadd 2)))
    (= _₁₈ (apply _₁₇ y₁))
    (= _₁₉ (const 2))
    (= _₅ (apply _₁₈ _₁₉))
    (goto main/let-body₇))
  (block main/else₉
    (= _₂₀ (const (@primitive-function iadd 2)))
    (= _₂₁ (apply _₂₀ y₁))
    (= _₂₂ (const 10))
    (= _₅ (apply _₂₁ _₂₂))
    (goto main/let-body₇))
  (block main/let-body₁₀ (branch _₆ main/then₈ main/else₉))
  (block main/then₁₁
    (= _₁₁ (const (@primitive-function equal? 2)))
    (= _₁₂ (apply _₁₁ x₁))
    (= _₁₃ (const 0))
    (= _₆ (apply _₁₂ _₁₃))
    (goto main/let-body₁₀))
  (block main/else₁₂
    (= _₁₄ (const (@primitive-function equal? 2)))
    (= _₁₅ (apply _₁₄ x₁))
    (= _₁₆ (const 2))
    (= _₆ (apply _₁₅ _₁₆))
    (goto main/let-body₁₀)))

;;; SelectInstructionPass

(export)

(define-code main
  (block entry
    (leaq
     (label-deref (external-label x-println-non-void))
     (reg rdi))
    (movq (imm 1) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁))
    (leaq
     (label-deref (external-label x-random-dice))
     (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₂))
    (movq (var _₂) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (var x₁))
    (leaq
     (label-deref (external-label x-random-dice))
     (reg rdi))
    (movq (imm 0) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₃))
    (movq (var _₃) (reg rdi))
    (callq-n (external-label x-apply-nullary) (arity 1))
    (movq (reg rax) (var y₁))
    (leaq (label-deref (external-label x-iadd)) (reg rdi))
    (movq (imm 2) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₄))
    (leaq
     (label-deref (external-label x-int-less?))
     (reg rdi))
    (movq (imm 2) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₇))
    (movq (var _₇) (reg rdi))
    (movq (var x₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₈))
    (movq (imm 1) (var _₉))
    (movq (var _₈) (reg rdi))
    (movq (var _₉) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₁₀))
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (var _₁₀) (reg rax))
    (branch-if
     (cc e)
     (label main/then₁₁)
     (label main/else₁₂)))
  (block main/let-body₁
    (movq (var _₂₃) (reg rdi))
    (movq (var _₂₄) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₄₂))
    (movq (var _₁) (reg rdi))
    (movq (var _₄₂) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _↩))
    (movq (var _↩) (reg rax))
    (retq))
  (block main/then₂
    (leaq (label-deref (external-label x-iadd)) (reg rdi))
    (movq (imm 2) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₃₆))
    (movq (var _₃₆) (reg rdi))
    (movq (var y₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₃₇))
    (movq (imm 2) (var _₃₈))
    (movq (var _₃₇) (reg rdi))
    (movq (var _₃₈) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₂₄))
    (jmp (label main/let-body₁)))
  (block main/else₃
    (leaq (label-deref (external-label x-iadd)) (reg rdi))
    (movq (imm 2) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₃₉))
    (movq (var _₃₉) (reg rdi))
    (movq (var y₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₄₀))
    (movq (imm 10) (var _₄₁))
    (movq (var _₄₀) (reg rdi))
    (movq (var _₄₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₂₄))
    (jmp (label main/let-body₁)))
  (block main/let-body₄
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (var _₂₅) (reg rax))
    (branch-if (cc e) (label main/then₂) (label main/else₃)))
  (block main/then₅
    (leaq (label-deref (external-label x-equal?)) (reg rdi))
    (movq (imm 2) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₃₀))
    (movq (var _₃₀) (reg rdi))
    (movq (var x₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₃₁))
    (movq (imm 0) (var _₃₂))
    (movq (var _₃₁) (reg rdi))
    (movq (var _₃₂) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₂₅))
    (jmp (label main/let-body₄)))
  (block main/else₆
    (leaq (label-deref (external-label x-equal?)) (reg rdi))
    (movq (imm 2) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₃₃))
    (movq (var _₃₃) (reg rdi))
    (movq (var x₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₃₄))
    (movq (imm 2) (var _₃₅))
    (movq (var _₃₄) (reg rdi))
    (movq (var _₃₅) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₂₅))
    (jmp (label main/let-body₄)))
  (block main/let-body₇
    (movq (var _₄) (reg rdi))
    (movq (var _₅) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₂₃))
    (leaq
     (label-deref (external-label x-int-less?))
     (reg rdi))
    (movq (imm 2) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₂₆))
    (movq (var _₂₆) (reg rdi))
    (movq (var x₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₂₇))
    (movq (imm 1) (var _₂₈))
    (movq (var _₂₇) (reg rdi))
    (movq (var _₂₈) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₂₉))
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (var _₂₉) (reg rax))
    (branch-if (cc e) (label main/then₅) (label main/else₆)))
  (block main/then₈
    (leaq (label-deref (external-label x-iadd)) (reg rdi))
    (movq (imm 2) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁₇))
    (movq (var _₁₇) (reg rdi))
    (movq (var y₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₁₈))
    (movq (imm 2) (var _₁₉))
    (movq (var _₁₈) (reg rdi))
    (movq (var _₁₉) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₅))
    (jmp (label main/let-body₇)))
  (block main/else₉
    (leaq (label-deref (external-label x-iadd)) (reg rdi))
    (movq (imm 2) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₂₀))
    (movq (var _₂₀) (reg rdi))
    (movq (var y₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₂₁))
    (movq (imm 10) (var _₂₂))
    (movq (var _₂₁) (reg rdi))
    (movq (var _₂₂) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₅))
    (jmp (label main/let-body₇)))
  (block main/let-body₁₀
    (movq (label-deref (external-label x-true)) (reg rax))
    (cmpq (var _₆) (reg rax))
    (branch-if (cc e) (label main/then₈) (label main/else₉)))
  (block main/then₁₁
    (leaq (label-deref (external-label x-equal?)) (reg rdi))
    (movq (imm 2) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁₁))
    (movq (var _₁₁) (reg rdi))
    (movq (var x₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₁₂))
    (movq (imm 0) (var _₁₃))
    (movq (var _₁₂) (reg rdi))
    (movq (var _₁₃) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₆))
    (jmp (label main/let-body₁₀)))
  (block main/else₁₂
    (leaq (label-deref (external-label x-equal?)) (reg rdi))
    (movq (imm 2) (reg rsi))
    (movq (imm 0) (reg rdx))
    (callq-n (external-label x-make-curry) (arity 3))
    (movq (reg rax) (var _₁₄))
    (movq (var _₁₄) (reg rdi))
    (movq (var x₁) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₁₅))
    (movq (imm 2) (var _₁₆))
    (movq (var _₁₅) (reg rdi))
    (movq (var _₁₆) (reg rsi))
    (callq-n (external-label x-apply-unary) (arity 2))
    (movq (reg rax) (var _₆))
    (jmp (label main/let-body₁₀))))

